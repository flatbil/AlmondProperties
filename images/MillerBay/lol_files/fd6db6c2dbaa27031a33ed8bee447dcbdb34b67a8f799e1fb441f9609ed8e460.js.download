!function(t){var i={};function r(e){if(i[e])return i[e].exports;var a=i[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=i,r.d=function(e,a,t){r.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:t})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(a,e){if(1&e&&(a=r(a)),8&e)return a;if(4&e&&"object"==typeof a&&a&&a.__esModule)return a;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:a}),2&e&&"string"!=typeof a)for(var i in a)r.d(t,i,function(e){return a[e]}.bind(null,i));return t},r.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(a,"a",a),a},r.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},r.p="",r(r.s=21)}([function(e,a){e.exports=Roblox},function(e,a){e.exports=angular},function(e,a,t){"use strict";var i=t(0),r=t(1),s=t.n(r),n=["robloxApp","monospaced.elastic","modal","ui.bootstrap.popover","toast","thumbnails"],o="voiceChat",l="contacts";try{s.a.module(o),n.push(o)}catch(e){}try{s.a.module(l),n.push(l)}catch(e){}var c=s.a.module("chat",n).config(["msdElasticConfig","languageResourceProvider",function(e,a){e.append="\n",i.Lang.ChatResources&&a.setLanguageKeysFromFile(i.Lang.ChatResources)}]);a.a=c},,,,,,,function(e,a){e.exports=Lightstep},function(e,a){function s(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function n(e){return e.split("/").pop().replace(".html","")}var t={importFilesUnderPath:function(e){e.keys().forEach(e)},templateCacheGenerator:function(e,a,i,r){return e.module(a,[]).run(["$templateCache",function(t){i&&i.keys().forEach(function(e){var a=s(n(e));t.put(a,i(e))}),r&&r.keys().forEach(function(e){var a=s(n(e));t.put(a,function(e){return e.replace(/<\/?script[^>]*>/gi,"")}(r(e)))})}])}};e.exports=t},,,,,,,function(e,a){e.exports=jQuery},,,,function(e,a,t){"use strict";t.r(a);var i=t(1),r=t.n(i),s=t(10),n=(t(22),t(2));Object(s.importFilesUnderPath)(t(23)),Object(s.importFilesUnderPath)(t(31)),Object(s.importFilesUnderPath)(t(63)),Object(s.importFilesUnderPath)(t(76));var o=t(98),l=Object(s.templateCacheGenerator)(r.a,"chatAppTemplates",o);r.a.element(function(){r.a.bootstrap("#chat-container",[n.a.name,l.name])})},function(e,a,t){},function(e,a,t){var i={"./apiParamsInitialization.js":24,"./gameParameters.js":25,"./httpResponse.js":26,"./messageHelper.js":27,"./notificationType.js":28,"./notificationsName.js":29,"./resources.js":30};function r(e){var a=s(e);return t(a)}function s(e){var a=i[e];if(a+1)return a;var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}r.keys=function(){return Object.keys(i)},r.resolve=s,(e.exports=r).id=23},function(e,a,t){"use strict";t.r(a);var i=t(0),r=t(2),s={chatApiParams:{pageNumberOfUnreadConversations:1,pageSizeOfUnreadConversations:30,pageNumberOfConversations:1,pageSizeOfConversations:30,pageSizeOfDisplayMessages:1,pageSizeOfUnreadMessages:30,pageSizeOfGetMessages:30,startIndexOfFriendList:0,pageSizeOfFriendList:50,loadMoreUnreadConversations:!1,loadMoreConversations:!1,loadMoreFriends:!1},dialogParams:{loadMoreMessages:!0,sendingMessage:!1,sendMessageHasError:!1,loadMoreFriends:!1,startIndexOfFriendList:0,pageSizeOfFriendList:50,pageSizeOfGetMessages:30,smallestPageSizeOfGetMessages:3},gameUrls:{multiGetPlaceDetails:"/v1/games/multiget-place-details",GetGamesSorts:"/v1/games/sorts?model.gameSortsContext=ChatSorts",GetGamesList:"/v1/games/list",getGamesByUniverseIds:i.EnvironmentUrls?"".concat(i.EnvironmentUrls.gamesApi,"/v1/games"):"/v1/games",multiGetPlayabilityStatus:i.EnvironmentUrls?"".concat(i.EnvironmentUrls.gamesApi,"/v1/games/multiget-playability-status"):"/v1/games/multiget-playability-status"},chatUrls:{setConversationUniverse:"/v2/set-conversation-universe",resetConversationUniverse:"/v2/reset-conversation-universe",getConversations:"/v2/get-conversations"},apiSets:{multiGetAvatarHeadshots:{url:i.EnvironmentUrls?"".concat(i.EnvironmentUrls.thumbnailsApi,"/v1/users/avatar-headshot?size=48x48&format=png"):"/v1/users/avatar-headshot?size=48x48&format=png",retryable:!0,withCredentials:!0},multiGetContacts:{url:i.EnvironmentUrls?"".concat(i.EnvironmentUrls.contactsApi,"/v1/user/get-tags"):"/v1/user/get-tags",retryable:!0,withCredentials:!0},multiGetPresence:{url:i.EnvironmentUrls?"".concat(i.EnvironmentUrls.presenceApi,"/v1/presence/users"):"/v1/presence/users",retryable:!0,withCredentials:!0},getMetaData:{url:i.EnvironmentUrls?"".concat(i.EnvironmentUrls.chatApi,"/v2/metadata"):"/v2/metadata",retryable:!1,withCredentials:!0},getContactsMetadata:{url:i.EnvironmentUrls?"".concat(i.EnvironmentUrls.contactsApi,"/v1/contacts/metadata"):"/v1/contacts/metadata",retryable:!0,withCredentials:!0}}};r.a.constant("apiParamsInitialization",s),a.default=s},function(e,a,t){"use strict";t.r(a);var i={reasonProhibitedMessage:{None:"None",Playable:"Playable",AnonymousAccessProhibited:"AnonymousAccessProhibited",AssetUnapproved:"AssetUnapproved",IncorrectAssetType:"IncorrectAssetType",IncorrectAssetConfiguration:"IncorrectAssetConfiguration",PlaceHasNoUniverse:"PlaceHasNoUniverse",UniverseDoesNotHaveARootPlace:"This game has no root place.",UniverseRootPlaceIsNotAPlace:"UniverseRootPlaceIsNotAPlace",UniverseRootPlaceIsNotActive:"UniverseRootPlaceIsNotActive",InsufficientPermissionCopylocked:"InsufficientPermissionCopylocked",InsufficientPermissionFriendsOnly:"This game is friends only.",InsufficientPermissionGroupOnly:"Group members only.",InsufficientPermissionOwnerOnly:"InsufficientPermissionOwnerOnly",InsufficientPermissionMembershipLevel:"InsufficientPermissionMembershipLevel",InsufficientPermissionRoleSet:"InsufficientPermissionRoleSet",PermissionDenied:"PermissionDenied",RequiredValueNotSet:"RequiredValueNotSet",AssetUnavailable:"AssetUnavailable",DeviceRestricted:"DeviceRestricted",UnderReview:"This game is under moderation review.",PurchaseRequired:"PurchaseRequired",AccountRestricted:"AccountRestricted"},sortNames:{myRecent:"MyRecent"},maxRowsOfMyRecentGames:1,gameIconMultiGetLimit:30,gameUrl:"/games/{placeId}/robloxgame"};t(2).a.constant("gameParameters",i),a.default=i},function(e,a,t){"use strict";t.r(a);var i={sendMessageErrorCode:{textTooLong:"TextTooLong"}};t(2).a.constant("httpResponse",i),a.default=i},function(e,a,t){"use strict";t.r(a);var i=t(2),r={linkCardTypes:{gameCard:"gameCard",catalogItemCard:"catalogItemCard",libraryItemCard:"libraryItemCard"},messageRegexs:{gameCard:new RegExp(/\/games\/(\d+)/)},gameCardRegexs:{privateServerLinkCode:new RegExp(/privateServerLinkCode=(\S+)/)},urlRegex:new RegExp(/(https?:\/\/(?:www\.|(?!www)|(?:web\.))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|web\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www)|(?:web\.))[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9]\.[^\s]{2,})/),onlyNewLineRegex:new RegExp(/^[\r|\n|\s]+$/),removeNewLineRegex:new RegExp(/^\n+|\n+$/g),emojiRegex:new RegExp(/\u200D|\uFE0F|(?:[\xA9\xAE\u2122\u23E9-\u23EF\u23F3\u23F8-\u23FA\u24C2\u25B6\u2600-\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDE51\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F\uDE80-\uDEFF]|\uD83E[\uDD00-\uDDFF])/g),zwjRegex:new RegExp(/\u200D/),emojiRepRegex:new RegExp(/\uFE0F/),senderTypes:{user:"User",system:"System"},messageTypes:{plainText:{name:"PlainText"},link:{name:"Link"},eventBased:{name:"EventBased",setConversationUniverse:"SetConversationUniverse"}}};i.a.constant("messageHelper",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i={newMessage:"NewMessage",newMessageBySelf:"NewMessageBySelf",newConversation:"NewConversation",addedToConversation:"AddedToConversation",removedFromConversation:"RemovedFromConversation",participantAdded:"ParticipantAdded",participantLeft:"ParticipantLeft",friendshipDestroyed:"FriendshipDestroyed",friendshipCreated:"FriendshipCreated",presenceOffline:"UserOffline",presenceOnline:"UserOnline",presenceChanged:"PresenceChanged",conversationTitleModerated:"ConversationTitleModerated",chatEnabled:"ChatEnabled",chatDisabled:"ChatDisabled",conversationTitleChanged:"ConversationTitleChanged",participantTyping:"ParticipantTyping",conversationUniverseChanged:"ConversationUniverseChanged"};t(2).a.constant("notificationType",i),a.default=i},function(e,a,t){"use strict";t.r(a);var i={ChatNotifications:"ChatNotifications",FriendshipNotifications:"FriendshipNotifications",PresenceNotifications:"PresenceNotifications",ChatPrivacySettingNotifications:"ChatPrivacySettingNotifications",PresenceBulkNotifications:"PresenceBulkNotifications",VoiceNotifications:"VoiceNotifications"};t(2).a.constant("notificationsName",i),a.default=i},function(e,a,t){"use strict";t.r(a);var i=t(0),r=t(2),s={templates:{chatBaseTemplate:"chat-base",chatBarTemplate:"chat-bar",abuseReportTemplate:"chat-abuse-report",dialogTemplate:"chat-dialog",groupDialogTemplate:"chat-group-dialog",dialogMinimizeTemplate:"dialog-minimize",chatPlaceholderTemplate:"chat-placeholder",confirmNegativeActionTemplate:"confirm-negative-action",userConversationInfoTemplate:"user-conversation-info",selectFriendsTemplate:"select-friends",createChatGroupTemplate:"create-chat-group",conversationTitleTemplate:"conversation-title",conversationTitleEditorTemplate:"conversation-title-editor",detailsTemplate:"details",addFriendsTemplate:"add-friends",aliasTemplate:"alias",toastTemplate:"toast",linkCard:"link-card",gamesList:"games-list",dialogHeader:"dialog-header",systemMessage:"system-message",displayMessage:"display-message",chatAvatarHeadshot:"chat-avatar-headshot",chatGameIcon:"chat-game-icon"},eventStreamParams:{actions:{click:"click",hover:"hover",render:"render"},properties:{},clickPlayFromLinkCardInChat:"clickBtnFromLinkCardInChat",clickLinkCardInChat:"clickLinkCardInChat",clickPlayButtonInPlayTogether:"clickPlayButtonInPlayTogether",clickJoinButtonInPlayTogether:"clickJoinButtonInPlayTogether",clickBuyButtonInPlayTogether:"clickBuyButtonInPlayTogether",clickViewDetailsButtonInPlayTogether:"clickViewDetailsButtonInPlayTogether",openGameListInPlayTogether:"openGameListInPlayTogether",pinGameInPlayTogether:"pinGameInPlayTogether",unpinGameInPlayTogether:"unpinGameInPlayTogether",pinGameInLinkCard:"pinGameInLinkCard",unpinGameInLinkCard:"unpinGameInLinkCard",loadGameLinkCardInChat:"loadGameLinkCardInChat",context:{gamePlayFromLinkCard:"PlayGameFromLinkCard",gamePlayFromPlayTogether:"PlayGameFromPlayTogether"}},urlParamNames:{startConversationWithUserId:"startConversationWithUserId",conversationId:"conversationId"},events:{openGameList:"openGameList"},hoverPopoverParams:{isOpen:!1,triggerSelector:"",hoverPopoverSelector:""},performanceMeasurements:{messageSend:"MessageSend",messageReceive:"MessageReceive"},chatDataLSNamePrefix:i.CurrentUser?"Roblox.Chat.".concat(i.CurrentUser.userId):"Roblox.Chat"};r.a.constant("resources",s),a.default=s},function(e,a,t){var i={"./abuseReportDirective.js":32,"./addFriendsDirective.js":33,"./backBtnDirective.js":34,"./chatAvatarHeadshotDirective.js":35,"./chatBarDirective.js":36,"./chatBaseDirective.js":37,"./chatGameIconDirective.js":38,"./chatPlaceholderDirective.js":39,"./confirmNegativeActionDirective.js":40,"./confirmRemoveMemberDirective.js":41,"./conversationTitleDirective.js":42,"./conversationTitleEditorDirective.js":43,"./detailsDirective.js":44,"./detailsScrollbarDirective.js":45,"./dialogDirective.js":46,"./dialogHeaderDirective.js":47,"./dialogLazyLoadDirective.js":48,"./dialogMinimizeDirective.js":49,"./displayMessageDirective.js":50,"./friendsLazyLoadDirective.js":51,"./groupSelectDirective.js":52,"./lazyLoadDirective.js":53,"./linkCardDirective.js":54,"./minimizeItemDirective.js":55,"./removeFocusDirective.js":56,"./repeatDoneDirective.js":57,"./selectFriendsDirective.js":58,"./selectFriendsResizeDirective.js":59,"./systemMessageDirective.js":60,"./togglePopoverDirective.js":61,"./userConversationInfoDirective.js":62};function r(e){var a=s(e);return t(a)}function s(e){var a=i[e];if(a+1)return a;var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}r.keys=function(){return Object.keys(i)},r.resolve=s,(e.exports=r).id=31},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){return{restrict:"A",templateUrl:e.templates.abuseReportTemplate}}r.$inject=["resources"],i.a.directive("abuseReport",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){return{restrict:"A",replace:!0,templateUrl:e.templates.addFriendsTemplate}}r.$inject=["resources"],i.a.directive("addFriends",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){return{restrict:"A",scope:!0,link:function(a,e,t){e.bind("click touchstart",function(e){e.preventDefault(),a.closeDialog(a.dialogData.layoutId)})}}}r.$inject=["$log"],i.a.directive("backBtn",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){return{restrict:"A",scope:{userId:"@",className:"@",layoutLibrary:"="},templateUrl:e.templates.chatAvatarHeadshot}}r.$inject=["resources"],i.a.directive("chatAvatarHeadshot",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){return{restrict:"A",scope:!0,replace:!0,templateUrl:e.templates.chatBarTemplate}}r.$inject=["resources"],i.a.directive("chatBar",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){return{restrict:"A",scope:!0,replace:!0,templateUrl:e.templates.chatBaseTemplate}}r.$inject=["resources"],i.a.directive("chatBase",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){return{restrict:"A",scope:{universeId:"@",className:"@",layoutLibrary:"="},templateUrl:e.templates.chatGameIcon}}r.$inject=["resources"],i.a.directive("chatGameIcon",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){return{restrict:"A",scope:!0,templateUrl:e.templates.chatPlaceholderTemplate}}r.$inject=["resources"],i.a.directive("chatPlaceholder",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){return{restrict:"A",scope:{chatLibrary:"=",dialogLayout:"=",confirmCallback:"&"},templateUrl:e.templates.confirmNegativeActionTemplate}}r.$inject=["resources"],i.a.directive("confirmNegativeAction",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){return{restrict:"A",scope:{dialogLayout:"=",confirmCallback:"&"},templateUrl:e.templates.confirmNegativeActionTemplate}}r.$inject=["resources"],i.a.directive("confirmRemoveMember",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){return{restrict:"A",replace:!0,templateUrl:e.templates.conversationTitleTemplate}}r.$inject=["resources"],i.a.directive("conversationTitle",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){return{restrict:"A",replace:!0,templateUrl:e.templates.conversationTitleEditorTemplate}}r.$inject=["resources"],i.a.directive("conversationTitleEditor",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){return{restrict:"A",replace:!0,scope:!0,templateUrl:e.templates.detailsTemplate}}r.$inject=["resources"],i.a.directive("details",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){return{restrict:"A",scope:!0,link:function(e,a,t){a.mCustomScrollbar({autoExpandScrollbar:!1,scrollInertia:5,contentTouchScroll:1,mouseWheel:{preventDefault:!0},advanced:{autoScrollOnFocus:!1}})}}}r.$inject=["$log"],i.a.directive("detailsScrollbar",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(1),I=t.n(i),r=t(2);function T(a){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{},i=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.forEach(function(e){s(a,e,t[e])})}return a}function s(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function n(u,c,d,p,y,h,i,m,v,f,b,L){return{restrict:"A",scope:{dialogData:"=",chatLibrary:"=",chatUser:"=",closeDialog:"&",sendInvite:"&"},link:function(g,n,e){function o(){g.isOverLoaded(),g.dialogData.currentUserId=g.currentUserId;var e=v.templates.dialogTemplate,a=v.templates.groupDialogTemplate,t=v.templates.createChatGroupTemplate;switch(g.dialogData.dialogType){case y.dialogType.CHAT:var i;I.a.forEach(g.dialogData.userIds,function(e){e!==g.chatLibrary.userId&&(i=e)}),g.dialogLayout.title=g.chatLibrary.friendsDict[i]?g.chatLibrary.friendsDict[i].name:g.dialogData.title,g.dialogLayout.templateUrl=e,g.dialogLayout.scrollbarElm=y.getScrollBarSelector(g.dialogData,y.scrollBarType.MESSAGE),g.dialogData.name=g.chatLibrary.friendsDict[i]?g.chatLibrary.friendsDict[i].name:g.dialogData.title,g.dialogData.nameLink=g.chatLibrary.friendsDict[i]?g.chatLibrary.friendsDict[i].profileUrl:"";break;case y.dialogType.GROUPCHAT:g.dialogLayout.templateUrl=a,g.dialogLayout.limitMemberDisplay=r,g.dialogLayout.scrollbarElm=y.getScrollBarSelector(g.dialogData,y.scrollBarType.MESSAGE),g.dialogData.name=g.dialogData.title;break;case y.dialogType.NEWGROUPCHAT:g.dialogLayout.title=g.dialogData.title,g.dialogLayout.templateUrl=t}g.updateDialogStyle()}function l(){(g.dialogLayout.IsdialogContainerVisible||n.find(".dialog-container"))&&(g.dialogLayout.IsdialogContainerVisible=!1,n.empty());var e=I.a.element(d.get(g.dialogLayout.templateUrl));!function(){var e;g.chatLibrary&&g.chatLibrary.dialogScopeLib[g.dialogData.id]&&(e=g.chatLibrary.dialogScopeLib[g.dialogData.id]),g.$$childHead&&null!=g.$$childHead&&g.$$childHead.timeStamp===e&&g.$$childHead.$destroy()}();var a=g.$new(),t=Date.now();g.chatLibrary&&(g.chatLibrary.dialogScopeLib[g.dialogData.id]=t),a.timeStamp=t;var i=c(e);n.append(e),i(a)}var r=y.dialogLayout.limitMemberDisplay,a=0;g.saveIntoDialogsLayout=function(){var e=g.dialogData.layoutId;g.dialogLayout&&g.dialogLayout.layoutId===e&&(g.chatLibrary.dialogsLayout[e]=g.dialogLayout,h.updateStorage(h.storageDictionary.dialogsLayout,g.chatLibrary.dialogsLayout,g.chatLibrary.cookieOption))};function s(e){var a=I.a.isDefined(g.dialogData.userIds)?g.dialogData.userIds.indexOf(e):-1,t=I.a.isDefined(g.dialogData.selectedUserIds)?g.dialogData.selectedUserIds.indexOf(e):-1;return a<0&&t<0}function t(){g.dialogLibrary=i.getLocalStorage(g.chatLibrary.dialogLocalStorageName)?i.getLocalStorage(g.chatLibrary.dialogLocalStorageName):{}}g.updateDialogStyle=function(){y.updateDialogStyle(g.dialogData,g.dialogLayout,g.chatLibrary)},g.updateFriends=function(e){var a=[];if(e){var t=y.sortFriendList(g.chatLibrary,e);t&&(t.forEach(function(e){s(e.id)&&a.push(e.id),g.chatLibrary.friendsDict[e.id]||(g.chatLibrary.friendsDict[e.id]=e)}),g.dialogData.friendIds=a)}else{var i=g.chatLibrary.friendIds.slice();I.a.forEach(i,function(e){s(e)&&a.push(e)}),g.dialogData.friendIds=a}},g.isOverLoaded=function(){I.a.isUndefined(g.dialogData.selectedUserIds)&&(g.dialogData.selectedUserIds=[],g.dialogData.selectedUsersDict={}),g.dialogData.dialogType!==y.dialogType.FRIEND&&(g.dialogData.dialogType===y.dialogType.NEWGROUPCHAT?g.dialogData.numberOfSelected=g.dialogData.selectedUserIds.length:g.dialogData.dialogType===y.dialogType.CHAT?g.dialogData.numberOfSelected=g.dialogData.userIds.length+g.dialogData.selectedUserIds.length:g.dialogData.numberOfSelected=g.dialogData.userIds.length+g.dialogData.selectedUserIds.length-1,g.dialogLayout.isMembersOverloaded=g.dialogData.numberOfSelected>=g.chatLibrary.quotaOfGroupChatMembers)},g.dialogData.selectedUserIds=[],g.dialogData.selectedUsersDict={},g.selectFriends=function(e){var a=g.dialogData.selectedUserIds.indexOf(e);a<0&&!g.dialogLayout.isMembersOverloaded?(g.dialogData.selectedUserIds.push(e),g.dialogData.selectedUsersDict[e]=I.a.copy(g.chatLibrary.friendsDict[e])):-1<a&&(g.dialogData.selectedUserIds.splice(a,1),delete g.dialogData.selectedUsersDict[e]),g.dialogData.searchTerm="",g.isOverLoaded()},g.isNumberOfMemberOverloaded=function(){var e=g.dialogData.selectedUserIds?g.dialogData.selectedUserIds.length:0,a=0;return g.dialogData.userIds&&(a=g.dialogData.dialogType===y.dialogType.CHAT?g.dialogData.userIds.length:g.dialogData.userIds.length-1),e+a>=g.chatLibrary.quotaOfGroupChatMembers&&(g.dialogLayout.isMembersOverloaded=!0,!g.dialogLayout.details.isEnabled&&g.dialogData.dialogType!==y.dialogType.NEWGROUPCHAT||(g.toastLayout.isNeeded=!0,g.toastLayout.text||(g.toastLayout.text=g.dialogLayout.memberDisplay.toastText(g.chatLibrary.quotaOfGroupChatMembers))),!0)},g.toggleFriendSelection=function(e,a){a&&a.preventDefault();var t=g.dialogData.selectedUserIds.indexOf(e);t<0&&!g.isNumberOfMemberOverloaded()?(g.dialogData.selectedUserIds.push(e),g.dialogData.selectedUsersDict[e]=I.a.copy(g.chatLibrary.friendsDict[e]),g.dialogData.selectedUsersDict[e].isSelected=!0):-1<t&&(g.dialogData.selectedUserIds.splice(t,1),delete g.dialogData.selectedUsersDict[e]),g.dialogData.searchTerm="",g.isOverLoaded()},g.toggleDialogContainer=function(){g.dialogLayout.collapsed=!g.dialogLayout.collapsed,g.toggleDialogFocusStatus(!g.dialogLayout.collapsed),g.saveIntoDialogsLayout(),y.updateDialogsPosition(g.chatLibrary)},g.toggleDialogFocusStatus=function(e){e&&(y.updateFocusedDialog(g.chatLibrary,g.dialogData.layoutId),m.markMessagesAsRead(g.dialogData,g.chatLibrary.shouldRespectConversationHasUnreadMessageToMarkAsRead)),(g.dialogLayout.hasFocus=e)&&g.dialogLayout.active&&g.markInactive();var a=e&&!function(){var e="";return I.a.isDefined(window.getSelection)?e=window.getSelection().toString():I.a.isDefined(window.document.selection)&&"Text"===window.document.selection.type&&(e=window.document.selection.createRange().text),0<e.length}()&&!g.dialogLayout.collapsed&&!g.dialogLayout.renameEditor.isEnabled;return g.dialogLayout.focusMeEnabled=a,g.saveIntoDialogsLayout(),!1},g.getTitle=function(e){var a,t,i=g.dialogData.chatMessages;if(i&&0<i.length){var r=i[0].senderTargetId;if(!r)return!1;t=g.chatLibrary.friendsDict[r].name}else t=g.dialogData.initiator.name;a=p("formatString")(y.chatLayout.defaultTitleForMessage,{userName:t}),g.title=a},g.changeTitle=function(){u.document.title=a%2==0?g.title:g.chatLibrary.currentTabTitle,a++},g.markInactive=function(){g.dialogLayout.active&&(g.dialogLayout.active=!1,t(),g.dialogLibrary&&g.dialogLibrary[g.dialogData.layoutId]&&g.dialogLibrary[g.dialogData.layoutId].active&&(L.debug(" --------------- markInactive -------------- set into local storage"),I.a.isUndefined(g.dialogLibrary[g.dialogData.layoutId])&&(g.dialogLibrary[g.dialogData.layoutId]={}),g.dialogLibrary[g.dialogData.layoutId].active=!1,g.dialogLibrary[g.dialogData.layoutId].played=!1,i.setLocalStorage(g.chatLibrary.dialogLocalStorageName,g.dialogLibrary)))},g.markActive=function(e){t(),I.a.isUndefined(g.dialogLibrary[g.dialogData.layoutId])&&(g.dialogLibrary[g.dialogData.layoutId]={}),g.dialogLibrary[g.dialogData.layoutId].active=!0,g.dialogLibrary[g.dialogData.layoutId].played=!1,i.setLocalStorage(g.chatLibrary.dialogLocalStorageName,g.dialogLibrary),g.dialogLayout.collapsed||g.chatLibrary.chatLayout.focusedLayoutId!==g.dialogData.layoutId?(g.dialogLayout.active=!0,g.dialogLayout.focusMeEnabled&&(g.dialogLayout.focusMeEnabled=!1)):m.markMessagesAsRead(g.dialogData)},g.handleLocalStorage=function(e){e.key===g.chatLibrary.dialogLocalStorageName&&(t(),g.dialogLayout.active&&g.dialogLibrary&&g.dialogLibrary[g.dialogData.layoutId]&&!g.dialogLibrary[g.dialogData.layoutId].active&&g.markInactive())},g.checkNewGenerationDialogStatus=function(){g.dialogData.isRenameEditorNeeded&&(g.dialogLayout.focusMeEnabled&&(g.dialogLayout.focusMeEnabled=!1),g.dialogData.isRenameEditorNeeded=!1,g.dialogLayout.renameEditor.isEnabled=!0,g.dialogLayout.renameEditor.hasFocus=!0)},g.getRecentGames=function(){g.chatLibrary.isGetRecentGamesCalled||(g.chatLibrary.isGetRecentGamesCalled||(g.chatLibrary.isGetRecentGamesCalled=!0),f.getRecentGame().then(function(e){if(e&&0<e.length){var a=e[0],t=a.placeId,i={};i[t]=a,f.buildPlacesLibrary(g.chatLibrary,i),g.chatLibrary.placesLibrary[a.placeId].buttonLayoutForMe=T({},b.playButtons.play),g.chatLibrary.myRecentPlaceId=t;a.universeId}}))},g.search=function(e){var a=g.dialogData.searchTerm;if(!a)return!0;var t=e.name,i=e.contact,r=a.toLowerCase();return-1!==t.toLowerCase().indexOf(r)||i&&-1!==i.toLowerCase().indexOf(r)},g.dialogData.friendIds=g.chatLibrary.friendIds?g.chatLibrary.friendIds.slice():[],g.dialogMessages=[],g.dialogType=T({},y.dialogType),g.memberStatus=T({},y.memberStatus),g.dialogBannerTypes=T({},y.dialogBannerTypes),g.dialogLayout=I.a.isDefined(g.chatLibrary.dialogsLayout[g.dialogData.layoutId])?g.chatLibrary.dialogsLayout[g.dialogData.layoutId]:I.a.copy(y.dialogLayout),g.dialogLayout.layoutId=g.dialogData.layoutId,g.toastLayout={isEnabled:g.dialogLayout.isMembersOverloaded,timeout:g.dialogLayout.memberDisplay.timeoutToast},g.dialogLayout.defaultStyle={},g.isOverLoaded(),g.$watch(function(){return g.chatLibrary.dialogDict},function(e,a){if(I.a.isDefined(e)&&I.a.isDefined(e[g.dialogData.layoutId])){var t=g.dialogData.layoutId,i=g.chatLibrary,r=i.dialogIdList.indexOf(t),s=e[t];if(!a[t]||s.isUpdated){switch(I.a.isDefined(g.chatLibrary.dialogsLayout[g.dialogData.layoutId])?g.dialogLayout=g.chatLibrary.dialogsLayout[g.dialogData.layoutId]:I.a.isUndefined(g.dialogLayout)?g.dialogLayout=I.a.copy(y.dialogLayout):s.updateStatus===y.dialogStatus.INIT&&g.dialogLayout&&(g.dialogLayout.renameEditor=T({},y.dialogLayout.renameEditor)),s.isUpdated=!1,s.updateStatus){case y.dialogStatus.REPLACE:-1<r&&(g.dialogLayout.collapsed&&(g.dialogLayout.collapsed=!1),s.updateStatus=y.dialogStatus.INIT,g.toggleDialogFocusStatus(!0));case y.dialogStatus.INIT:-1<r&&(g.dialogLayout.focusMeEnabled===s.autoOpen&&(g.dialogLayout.focusMeEnabled=!s.autoOpen,s.autoOpen||m.markMessagesAsRead(g.dialogData)),g.checkNewGenerationDialogStatus(),o(),l());break;case y.dialogStatus.MINIMIZE:o(),g.chatLibrary.minimizedDialogIdList.indexOf(t)<0&&(g.chatLibrary.minimizedDialogIdList.push(t),g.chatLibrary.minimizedDialogData[t]=g.dialogData),n.empty();break;case y.dialogStatus.REFRESH:o(),s.updateStatus=y.dialogStatus.INIT}0===r&&g.getRecentGames()}h.updateStorage(h.storageDictionary.dialogIdList,g.chatLibrary.dialogIdList,g.chatLibrary.cookieOption),h.updateStorage(h.storageDictionary.dialogDict,g.chatLibrary.dialogDict,g.chatLibrary.cookieOption),g.saveIntoDialogsLayout(),-1<r&&(function(e){var a=g.dialogData.layoutId,t="#".concat(a),i=g.chatLibrary.chatLayout,r=I.a.element(document.querySelector(t)).find(".dialog-container"),s=i.widthOfChat,n=i.widthOfDialog+i.spaceOfDialog,o=e.indexOf(a),l=g.chatLibrary,c=+s+y.calculateRightPosition(l,o)+i.spaceOfDialog;if(u.innerWidth<c+n){var d=+i.defaultChatZIndex+1;r.css("z-index",d)}else{d=+i.defaultChatZIndex+o;y.updateDialogsPosition(l),r.css("z-index",d)}r.addClass("dialog-visible")}(i.dialogIdList),s.markAsActive&&(g.markActive(s.activeType),s.markAsActive=!1))}},!0),g.$on("Roblox.Chat.MarkDialogInactive",function(e,a){a.layoutId===g.dialogData.layoutId&&g.markInactive()}),i.listenLocalStorage(g.handleLocalStorage)}}}n.$inject=["$window","$compile","$templateCache","$filter","chatUtility","chatClientStorageUtilityService","localStorageService","messageService","resources","gameService","gameLayout","$log"],r.a.directive("dialog",n),a.default=n},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){return{restrict:"A",replace:!0,scope:!0,templateUrl:e.templates.dialogHeader}}r.$inject=["resources"],i.a.directive("dialogHeader",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(i,e,r,s,n){return{restrict:"A",scope:!0,link:function(t,e,a){t.callbackScrollToBottom=function(){t.updateDialog()},t.callbackLazyLoad=function(){if(!t.dialogParams.loadMoreMessages||!t.dialogLayout.IsdialogContainerVisible)return!1;t.dialogLayout.isChatLoading=!0;var e=t.dialogData.chatMessages.length;i.getMessages(t.dialogData.id,t.dialogData.chatMessages[e-1].id,t.dialogParams.pageSizeOfGetMessages).then(function(e){if(t.dialogLayout.isChatLoading=!1,e){if(0<e.length){t.dialogLayout.scrollToBottom=!1,r.preProcessMessages(t.chatLibrary,t.dialogData,e);for(var a=0;a<e.length;a++)r.buildFallbackTimeStamp(e[a],t.dialogData),r.setFallbackClusterMaster(t.dialogData,e[a]);s.fetchDataForLinkCard(e,t.chatLibrary)}e.length<t.dialogParams.pageSizeOfGetMessages&&(t.dialogParams.loadMoreMessages=!1)}else t.dialogParams.loadMoreMessages=!1,r.processMessages(t.chatLibrary,t.dialogData,e,t.chatLibrary.friendsDict),s.fetchDataForLinkCard(e,t.chatLibrary)},function(){t.dialogLayout.isChatLoading=!1,n.debug("---error from get getMessages in dialogLazyLoadDirective.js---")})};e.mCustomScrollbar({autoExpandScrollbar:!1,scrollInertia:5,contentTouchScroll:1,mouseWheel:{preventDefault:!0},callbacks:{onInit:function(){n.debug("---- onInit callback ---- Scrollbars updated"),t.dialogLayout.scrollToBottom=!0},onUpdate:function(){n.debug("---- onUpdate callback ---- Scrollbars updated"+t.dialogLayout.scrollToBottom),t.dialogLayout.scrollToBottom?e.mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}):t.dialogLayout.scrollToBottom=!0,e.hasClass("mCS_no_scrollbar")&&t.updateDialog()},onTotalScroll:t.callbackScrollToBottom,onTotalScrollOffset:60,onTotalScrollBack:t.callbackLazyLoad}})}}}r.$inject=["chatService","chatUtility","messageService","gameService","$log"],i.a.directive("dialogLazyLoad",r),a.default=r},function(e,a,t){"use strict";t.r(a);t(0);var i=t(1),o=t.n(i),r=t(2);function s(s,e,n){return{restrict:"A",scope:{chatLibrary:"="},templateUrl:e.templates.dialogMinimizeTemplate,link:function(i,r,e){function t(){var e=i.chatLibrary.chatLayout,a=i.chatLibrary.dialogIdList.length,t=+e.widthOfChat+s.calculateRightPosition(i.chatLibrary,a)+e.spaceOfDialog;r.css("right",t)}i.dialogType=s.dialogType,i.hasMinimizedDialogs=!1,i.layoutIdHasClicked=!1,i.openDialog=function(e){n.debug(" -------------------openDialog------------------ "+e);var a=i.chatLibrary.dialogIdList.pop();i.chatLibrary.dialogDict[a].isUpdated=!0,i.chatLibrary.dialogDict[a].updateStatus=s.dialogStatus.MINIMIZE,i.chatLibrary.dialogIdList.push(e),i.chatLibrary.dialogDict[e].isUpdated=!0,i.chatLibrary.dialogDict[e].updateStatus=s.dialogStatus.REPLACE;var t=i.chatLibrary.minimizedDialogIdList.indexOf(e);-1<t&&(i.chatLibrary.minimizedDialogIdList.splice(t,1),delete i.chatLibrary.minimizedDialogData[e])},i.remove=function(e){var a=i.chatLibrary.minimizedDialogIdList.indexOf(e);-1<a&&(i.chatLibrary.minimizedDialogIdList.splice(a,1),delete i.chatLibrary.minimizedDialogData[e],delete i.chatLibrary.dialogDict[e])},Roblox.BootstrapWidgets.SetupPopover("top",{selector:"#dialogs-minimize"},"#dialogs-minimize-container"),i.$watch(function(){return i.chatLibrary.minimizedDialogIdList},function(e,a){o.a.isUndefined(e)||e==a||(n.debug("------ watch minimizedDialogIdList ----- "),0<e.length?(i.hasMinimizedDialogs||(i.hasMinimizedDialogs=!0),t()):0===e.length&&(i.hasMinimizedDialogs=!1))},!0),i.$watch(function(){return i.chatLibrary.chatLayout.areDialogsUpdated},function(e,a){e&&e!==a&&(i.$evalAsync(function(){i.chatLibrary.chatLayout.areDialogsUpdated=!1}),t())},!0)}}}s.$inject=["chatUtility","resources","$log"],r.a.directive("dialogMinimize",s),a.default=s},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e,i){return{restrict:"A",replace:!0,scope:!0,templateUrl:e.templates.displayMessage,link:function(e,a,t){e.initializeDisplayMessage=function(){e.messageHelper=i,e.displayMessage=e.chatUser.displayMessage},e.initializeDisplayMessage()}}}r.$inject=["resources","messageHelper"],i.a.directive("displayMessage",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){return{restrict:"A",scope:!0,link:function(e,a,t){function i(){if(!e.dialogParams.loadMoreFriends)return!1;e.dialogLayout.isChatLoading=!0}a.mCustomScrollbar({autoExpandScrollbar:!1,scrollInertia:5,contentTouchScroll:1,mouseWheel:{preventDefault:!0},callbacks:{onTotalScroll:i,onOverflowYNone:i}})}}}r.$inject=["$log"],i.a.directive("friendsLazyLoad",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(1),d=t.n(i),r=t(2);function s(e){return{restrict:"A",link:function(l,e,a){var c=l.chatLibrary.layout.topBarHeight;l.$watch(function(){return e.innerHeight()},function(e,a){if(e&&e!==a){var t,i,r="#".concat(l.dialogData.layoutId," .dialog-container"),s="#".concat(l.dialogData.layoutId," ").concat(l.friendsScrollbarElm),n=d.a.element(r),o=d.a.element(s);i=c+e,t=n.height()-i,o.css("height",t),o.mCustomScrollbar("update")}},!0)}}}s.$inject=["$log"],r.a.directive("groupSelect",s),a.default=s},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(t,s,n,o,l,c,d,g){return{restrict:"A",scope:!0,link:function(i,e,a){function r(){d.initializeFriends(i.chatLibrary,i.getFriendsInfo),i.chatLibrary.chatLayout.isChatLoading=!1,i.chatApiParams.loadMoreFriends=!1}i.callbackLazyLoad=function(){if(!i.chatApiParams||i.chatLibrary.chatLayout.errorMaskEnable||!i.chatApiParams.loadMoreConversations&&!i.chatApiParams.loadMoreFriends)return!1;i.chatLibrary.chatLayout.isChatLoading=!0,i.chatApiParams.loadMoreConversations&&t.getUserConversations(i.chatApiParams.pageNumberOfConversations,i.chatApiParams.pageSizeOfConversations,i.chatLibrary.friendsDict).then(function(e){var a,t=i.chatLibrary.friendsDict;return a=l.getUserIdsNotInFriendsDict(e,t),i.chatLibrary.chatLayout.isChatLoading=!1,e&&0<e.length?(i.buildChatUserListByConversations(e),i.chatApiParams.pageNumberOfConversations++,s.updateScrollbar(s.chatLayout.scrollbarClassName),e.length<i.chatApiParams.pageSizeOfConversations&&(i.chatApiParams.loadMoreConversations=!1,i.chatApiParams.loadMoreFriends=!0,i.chatApiParams.pageNumberOfConversations=1,r())):(i.chatApiParams.loadMoreConversations=!1,i.chatApiParams.loadMoreFriends=!0,i.chatApiParams.pageNumberOfConversations=1,r()),g.getUserContacts(a,t),c.getUserInfo(a,t)},function(){i.chatLibrary.chatLayout.isChatLoading=!1,n.debug("---error from get Conversations in lazyLoadDirective.js---")}),i.chatApiParams.loadMoreFriends&&r()},i.callbackScrollStart=function(){i.$broadcast("Roblox.Chat.ConversationListScroll"),o.triggerHandler("HoverPopover.EnableClose")},e.mCustomScrollbar({autoExpandScrollbar:!1,scrollInertia:5,contentTouchScroll:1,mouseWheel:{preventDefault:!0},callbacks:{onTotalScrollOffset:100,onTotalScroll:i.callbackLazyLoad,onOverflowYNone:i.callbackLazyLoad,onScrollStart:i.callbackScrollStart}})}}}r.$inject=["chatService","chatUtility","$log","$document","conversationsUtility","usersService","chatFriendsService","contactsService"],i.a.directive("lazyLoad",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){return{restrict:"A",scope:!0,replace:!0,templateUrl:e.templates.linkCard}}r.$inject=["resources"],i.a.directive("linkCard",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(1),r=t.n(i),s=t(2);function n(e){return{restrict:"A",scope:!0,link:function(e,a,t){r.a.element("#dialogs-minimize").on("click touchstart",".popover-content #"+e.dialogLayoutId+" .minimize-title",function(){e.$apply(e.openDialog(e.dialogLayoutId))});r.a.element("#dialogs-minimize").on("click touchstart",".popover-content #"+e.dialogLayoutId+" .minimize-close",function(){e.$apply(e.remove(e.dialogLayoutId))})}}}n.$inject=["$log"],s.a.directive("minimizeItem",n),a.default=n},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){return{restrict:"A",scope:!0,link:function(a,e,t){e.bind("click touchstart",function(e){e.preventDefault(),a.sendMessage()})}}}r.$inject=["$log"],i.a.directive("removeFocus",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(i,r){return{link:function(e,a,t){i.buildScrollbar(r.gameListScrollListSelector)}}}r.$inject=["chatUtility","playTogetherLayout"],i.a.directive("repeatDone",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(1),s=t.n(i),r=t(2);function n(r,e){return{restrict:"A",replace:!0,templateUrl:e.templates.selectFriendsTemplate,link:function(e,a,t){function i(){if(s.a.isUndefined(e.dialogData)||s.a.isUndefined(e.dialogData.selectedUserIds))return!1;e.dialogData.dialogType===r.dialogType.NEWGROUPCHAT?e.dialogLayout.inviteBtnDisabled=e.dialogData.selectedUserIds.length<2:e.dialogLayout.inviteBtnDisabled=0===e.dialogData.selectedUserIds.length}i(),e.$watch(function(){return e.dialogData&&e.dialogData.selectedUserIds},function(){i()},!0)}}}n.$inject=["chatUtility","resources"],r.a.directive("selectFriends",n),a.default=n},function(e,a,t){"use strict";t.r(a);var i=t(1),g=t.n(i),r=t(2);function s(d,e){return{restrict:"A",link:function(l,e,a){var c=l.chatLibrary.layout.topBarHeight;l.$watch(function(){return e.innerHeight()},function(e,a){if(e&&e!==a){var t,i="#"+l.dialogData.layoutId+" .dialog-container",r="#"+l.dialogData.layoutId+" "+l.friendsScrollbarElm,s=g.a.element(i),n=g.a.element(r),o=c+l.chatLibrary.layout.detailsActionHeight+e;l.dialogData.dialogType===d.dialogType.NEWGROUPCHAT&&(o+=l.chatLibrary.layout.detailsInputHeight),t=s.height()-o,n.css("height",t),n.mCustomScrollbar("update")}},!0)}}}s.$inject=["chatUtility","$log"],r.a.directive("selectFriendsResize",s),a.default=s},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e,i){return{restrict:"A",replace:!0,scope:!0,templateUrl:e.templates.systemMessage,link:function(e,a,t){e.messageHelper=i}}}r.$inject=["resources","messageHelper"],i.a.directive("systemMessage",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(1),y=t.n(i),r=t(2);function s(e,p){return{restrict:"A",replace:!0,scope:!0,link:function(t,e,a){var i=t.dialogLayout.togglePopoverParams,r=i.dialogSelector,s=i.triggerSelector,n=i.pinIconClassName,o=i.dialogTriggerClassSelector,l=i.isExclusiveClickSelector?i.isExclusiveClickSelector:"is-exclusive-click";function c(){p.on("click",function(e){e.stopPropagation();var a=y.a.element(e.target);d(a)||function(e){var a=y.a.element(r);return a.find(e)&&0<a.find(e).length}(a)||function(e){var a=!1;!function(e){return e.hasClass(n)}(e)||(a=t.dialogData.playTogetherIds&&0<t.dialogData.playTogetherIds.length||t.dialogData.pinGame);!function(e){var a=y.a.element(o);return a.is(e)||a.find(e)&&0<a.find(e).length}(e)||(a=!0);e.hasClass(l)&&(a=!0);return a}(a)||(t.dialogLayout.togglePopoverParams.isOpen=!1)})}function d(e){var a=y.a.element(s);return a.is(e)||a.find(e)&&0<a.find(e).length}e.on("click",function(e){d(y.a.element(e.target))&&(t.dialogLayout.togglePopoverParams.isOpen=!t.dialogLayout.togglePopoverParams.isOpen)});var g=t.$watch(function(){return t.dialogData.playTogetherIds},function(e,a){e!==a&&e&&0<e.length&&(t.dialogLayout.togglePopoverParams.isOpen||(t.dialogLayout.togglePopoverParams.isOpen=!0))},!0),u=t.$watch(function(){return t.dialogLayout.togglePopoverParams.isFirstTimeOpen},function(e,a){e&&c()},!0);t.$on("$destroy",function(){g(),u()})}}}s.$inject=["$log","$document"],r.a.directive("togglePopover",s),a.default=s},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){return{restrict:"A",replace:!0,scope:!0,templateUrl:e.templates.userConversationInfoTemplate}}r.$inject=["resources"],i.a.directive("userConversationInfo",r),a.default=r},function(e,a,t){var i={"./chatBarController.js":64,"./chatController.js":65,"./detailsController.js":66,"./dialogController.js":67,"./dialogHeaderController.js":68,"./dialogMessagesController.js":69,"./dialogsController.js":70,"./friendsController.js":71,"./linkCardController.js":72,"./linkCardMessagesController.js":73,"./playTogetherController.js":74,"./userConversationInfoController.js":75};function r(e){var a=s(e);return t(a)}function s(e){var a=i[e];if(a+1)return a;var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}r.keys=function(){return Object.keys(i)},r.resolve=s,(e.exports=r).id=63},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(s,e,a,r){s.cancelSearch=function(){s.chatViewModel.searchTerm="",s.chatLibrary.chatLayout.searchFocus=!1},s.saveChatBarLayoutInCookie=function(){var e={collapsed:s.chatLibrary.chatLayout.collapsed};a.updateStorage(a.storageDictionary.chatBarLayout,e,s.chatLibrary.cookieOption)},s.toggleChatContainer=function(){s.chatLibrary.chatLayout.collapsed=!s.chatLibrary.chatLayout.collapsed,s.updateUnreadConversationCount(),s.chatLibrary.chatLayout.chatBarInitialized=!0,s.saveChatBarLayoutInCookie()},s.isChatDisconnected=function(){var e=s.chatLibrary.chatLayout,a=e.isChatEnabledByPrivacySetting,t=e.errorMaskEnable,i=e.pageDataLoading;return a===r.chatEnabledByPrivacySettingTypes.enabled&&(t||i)},s.isChatEmpty=function(){var e=s.chatLibrary.chatLayout,a=e.isChatEnabledByPrivacySetting,t=e.chatLandingEnabled,i=r.chatEnabledByPrivacySettingTypes;return t||a!==i.enabled},s.search=function(e){var a=s.chatViewModel.searchTerm;if(!a)return!0;var t=e.name,i=e.contact,r=a.toLowerCase();return-1!==t.toLowerCase().indexOf(r)||i&&-1!==i.toLowerCase().indexOf(r)}}r.$inject=["$scope","$log","chatClientStorageUtilityService","chatUtility"],i.a.controller("chatBarController",r),a.default=r},function(e,a,t){"use strict";t.r(a);var N=t(0),R=t(9),i=t(1),B=t.n(i),r=t(2);function z(a){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{},i=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.forEach(function(e){s(a,e,t[e])})}return a}function s(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function n(h,i,r,t,l,m,o,v,f,c,e,s,n,b,a,d,g,u,p,L,y,I,T,D,C,S,P,M){function U(){var e=r.innerWidth()-f.chatLayout.widthOfChat-f.chatLayout.widthOfDialogMinimize,a=f.chatLayout.widthOfDialog+f.chatLayout.spaceOfDialog;h.chatLibrary.chatLayout.availableNumberOfDialogs=Math.floor(e/a),h.chatLibrary.chatLayout.numberOfDialogs=h.chatLibrary.dialogIdList.length,h.chatLibrary.chatLayout.numberOfMinimizedDialogs=h.chatLibrary.minimizedDialogIdList.length,m.debug(" -------------numberOfDialogs = -------------- ".concat(h.chatLibrary.chatLayout.numberOfDialogs)),m.debug(" -------------availableNumberOfDialogs = -------------- ".concat(h.chatLibrary.chatLayout.availableNumberOfDialogs))}function E(e){h.chatLibrary.dialogDict[e.layoutId]&&function(e){h.chatLibrary.dialogDict[e]&&(h.chatLibrary.dialogDict[e].isUpdated=!0,h.chatLibrary.dialogDict[e].updateStatus=f.dialogStatus.REFRESH)}(e.layoutId),!h.chatLibrary.dialogDict[e.layoutId]&&e.displayMessage&&e.displayMessage.content&&h.launchDialog(e.layoutId,!0)}h.dialogsOverflowWindow=function(){var e=r.innerWidth();return h.chatLibrary.chatLayout.numberOfDialogs>=h.chatLibrary.chatLayout.availableNumberOfDialogs&&e>f.chatLayout.thresholdMobile},h.getMessageForConversations=function(e){0<e.length&&o.multiGetLatestMessages(e,f.chatApiParams.pageSizeOfDisplayMessages).then(function(e){e&&0<e.length&&B.a.forEach(e,function(e){var a=e.chatMessages,t=0<a.length?a[0]:{};if(h.chatLibrary.conversationsDict[e.conversationId]){var i=h.chatLibrary.conversationsDict[e.conversationId].layoutId,r=h.chatUserDict[i];r.hasUnreadMessages=r.hasUnreadMessages||n.hasUnreadMessages(r,a),h.chatLibrary.isRespectingMessageTypeEnabled?(v.categorizeMessageType(h.chatLibrary,a,r),r.displayMessage=v.getDisplayMessageForUser(a)):(f.sanitizeMessage(t),r.displayMessage=v.buildDisplayMessage(t)),v.resetConversationUnreadStatus(h.chatUserDict[i],a),v.formatTimestampInConversation(h.chatUserDict[i])}})},function(){m.debug("----- multiGetLatestMessages request is failed ! ------")})},h.updateUnreadConversationCount=function(){o.getUnreadConversationCount().then(function(e){if(e){var a=e.count;h.chatViewModel.unreadConversationCount=a,i.document.title=0<a?"(".concat(a,") ").concat(h.chatLibrary.currentTabTitle):h.chatLibrary.currentTabTitle}},function(){m.debug("----- getUnreadConversationCount request is failed ! ------"),i.document.title=h.chatLibrary.currentTabTitle})};function k(e){var a=[];a.push(e),o.getConversations(a).then(function(e){e&&(h.buildChatUserListByUnreadConversations(e),h.getPlaceDetailsForNewPlaceIds(e))})}function O(e,a,t){v.appendMessages(h.chatLibrary,a,e),u.fetchDataForLinkCard(e,h.chatLibrary),n.hasUnreadMessages(a,e);var i={status:!1,userId:e[0].senderTargetId};if(h.updateConverationTypingStatus(a.id,i),h.updateChatViewModel(a,!0),E(a),!t){!function(e,a){h.chatLibrary.dialogDict[e]&&(h.chatLibrary.dialogDict[e].markAsActive=!0,h.chatLibrary.dialogDict[e].activeType=a)}(a.layoutId,f.activeType.NEWMESSAGE);var r=f.getDataForMarkingSeen(h.chatUserDict);0<r.length&&o.markAsSeen(r)}}function w(e,a){var t=h.getLayoutId(e,f.dialogType.CHAT);B.a.isUndefined(h.chatUserDict[t])?k(e):function(e,a,t,i){var r=[],s=h.chatUserDict[e],n=null;i||(n=(new Date).getTime());o.getMessagesByPageSize(s,t,f.dialogParams.smallestPageSizeOfGetMessages,r,function(e){if(O(r,s,i),e){var a=(new Date).getTime()-e;o.sendPerformanceData(I.performanceMeasurements.messageReceive,a)}},n)}(t,0,null,a)}h.resetDialogLayout=function(t){if(t){var e=z({},f.dialogLayout),a=z({},f.dialogLayoutResetConstant);B.a.forEach(e,function(e,a){B.a.isUndefined(t[a])&&(t[a]=z({},e))}),B.a.forEach(a,function(e,a){t[a]=z({},e)})}},h.retrieveDialogStatus=function(){if(B.a.isDefined(h.preSetChatLibrary)&&B.a.isDefined(h.preSetChatLibrary.dialogIdList)){var e=z({},h.preSetChatLibrary.dialogIdList);if(0===e.length)return h.preSetChatLibrary.dialogDict={},h.preSetChatLibrary.dialogsLayout={},c.removeFromStorage(c.storageDictionary.dialogDict,h.chatLibrary.cookieOption),c.removeFromStorage(c.storageDictionary.dialogsLayout,h.chatLibrary.cookieOption),!1;var t=h.preSetChatLibrary.dialogDict,i=h.preSetChatLibrary.dialogsLayout;B.a.forEach(e,function(e,a){e===f.newGroup.layoutId||h.chatUserDict[e]||(h.preSetChatLibrary.dialogIdList.splice(a,1),delete t[e],delete i[e]),h.resetDialogLayout(i[e])}),h.chatLibrary.dialogIdList=h.preSetChatLibrary.dialogIdList,B.a.forEach(t,function(e,a){e.isUpdated||(e.isUpdated=!0),a===f.newGroup.layoutId&&(h.chatUserDict[f.newGroup.layoutId]=h.newGroup),h.chatLibrary.dialogDict[a]=e,i[a]&&(h.chatLibrary.dialogsLayout[a]=i[a])})}};function G(){return i.innerWidth>=f.chatLayout.thresholdChatBarOpen&&!h.chatLibrary.isTakeOverOn&&!B.a.element("#GamesPageLeftColumn").length}var A;h.setup=function(){h.chatUserDict={},h.dialogType=z({},f.dialogType),h.memberStatus=z({},f.memberStatus),h.userPresenceTypes=z({},f.userPresenceTypes),h.newGroup=z({},d.newGroup),h.selectedFriendIds=[],h.chatLibrary=z({},g.chatLibrary),B.a.isDefined(N.RealTime)&&(A=N.RealTime.Factory.GetClient()),R.isTracerEnabled&&(h.span=R.instrumentation.createAndGetSpan("Chat:InitializeChat"),R.tags.setDefaultTags(h.span))},h.initializePresetData=function(){h.preSetChatLibrary={},c.isStorageDefined(c.storageDictionary.dialogIdList)&&c.isStorageDefined(c.storageDictionary.dialogDict)?h.preSetChatLibrary={dialogIdList:c.getFromStorage(c.storageDictionary.dialogIdList),dialogDict:c.getFromStorage(c.storageDictionary.dialogDict),dialogsLayout:c.isStorageDefined(c.storageDictionary.dialogsLayout)?c.getFromStorage(c.storageDictionary.dialogsLayout):{}}:h.preSetChatLibrary={dialogIdList:[],dialogDict:{},dialogsLayout:{}},c.isStorageDefined(c.storageDictionary.chatBarLayout)&&(h.preSetChatLibrary.chatBarLayout=c.getFromStorage(c.storageDictionary.chatBarLayout)),h.chatApiParams=z({},f.chatApiParams)},h.initializeChatBar=function(){h.chatLibrary.chatLayout.chatBarInitialized||(G()&&!h.preSetChatLibrary.chatBarLayout?h.chatLibrary.chatLayout.collapsed=!1:h.preSetChatLibrary.chatBarLayout?h.chatLibrary.chatLayout.collapsed=h.preSetChatLibrary.chatBarLayout.collapsed:G()||(h.chatLibrary.chatLayout.collapsed=!0),h.chatLibrary.chatLayout.chatBarInitialized=!0),s.logSinglePerformanceMark(f.performanceMarkLabels.chatPageDataLoaded)};function F(e,a){var t=h.chatLibrary.layoutIdList.indexOf(e);a&&-1<t?h.chatLibrary.layoutIdList.splice(t,1):!a&&t<0&&h.chatLibrary.layoutIdList.push(e)}function x(e){return h.chatLibrary.userConversationsDict[e]?h.chatLibrary.userConversationsDict[e]:null}h.removeFriend=function(e){var a=x(e);a=a||h.getLayoutId(e,f.dialogType.FRIEND);var t=h.chatUserDict[a];if(t&&t.isConversation){var i=h.chatUserDict[a].id;h.chatLibrary.conversationsDict[i].remove=!0}else if(t){var r=h.chatLibrary.chatLayoutIds.indexOf(a);-1<r&&(h.chatLibrary.chatLayoutIds.splice(r,1),delete h.chatUserDict[a],F(a,!0))}if(-1<h.chatViewModel.friendsHasConversation.indexOf(e)){var s=h.chatViewModel.friendsHasConversation.indexOf(e);h.chatViewModel.friendsHasConversation.splice(s,1)}-1<h.chatLibrary.chatLayoutIds.indexOf(a)&&h.closeDialog(a),0===h.chatLibrary.chatLayoutIds.length&&(h.chatLibrary.chatLayout.chatLandingEnabled=!0)};h.getAllFriends=function(e,a){S.initializeFriends(h.chatLibrary,h.getFriendsInfo)},h.updateDialogList=function(e,a){for(U();h.chatLibrary.chatLayout.numberOfDialogs+h.chatLibrary.chatLayout.numberOfMinimizedDialogs>=h.chatLibrary.chatLayout.maxOpenDialogs;){var t=h.chatLibrary.dialogIdList[0];h.closeDialog(t),U()}if(h.dialogsOverflowWindow())for(;h.chatLibrary.dialogIdList.length>=h.chatLibrary.chatLayout.availableNumberOfDialogs;){var i=h.chatLibrary.dialogIdList.pop();if(B.a.isUndefined(i))break;h.chatLibrary.dialogDict[i].isUpdated=!0,h.chatLibrary.dialogDict[i].updateStatus=f.dialogStatus.MINIMIZE;var r=h.chatLibrary.minimizedDialogIdList.indexOf(e);-1<r&&(h.chatLibrary.dialogsLayout[e].collapsed&&(h.chatLibrary.dialogsLayout[e].collapsed=!1),h.chatLibrary.minimizedDialogIdList.splice(r,1),delete h.chatLibrary.minimizedDialogData[e])}h.chatLibrary.dialogIdList.indexOf(e)<0&&h.chatLibrary.dialogIdList.push(e);var s=z({},f.dialogInitValue);B.a.isDefined(a)&&a&&(s.autoOpen=!0),h.chatLibrary.dialogDict[e]=s},h.getUserConversations=function(){R.isTracerEnabled&&(h.getUserConversationsSpan=R.instrumentation.createAndGetSpan("Chat:GetUserConversations",{childOf:h.span}),R.tags.setDefaultTags(h.getUserConversationsSpan)),o.getUserConversations(h.chatApiParams.pageNumberOfConversations,h.chatApiParams.pageSizeOfConversations,h.chatLibrary.friendsDict).then(function(e){s.logSinglePerformanceMark(f.performanceMarkLabels.chatConversationsLoaded);var a=[],t=h.chatLibrary.friendsDict;if(e&&0<e.length){var i=h.chatLibrary.friendsDict;a=C.getUserIdsNotInFriendsDict(e,i),h.buildChatUserListByConversations(e,!1),h.chatApiParams.pageNumberOfConversations++,h.retrieveDialogStatus()}return!e||e.length<h.chatApiParams.pageSizeOfConversations?(h.chatApiParams.loadMoreConversations=!1,h.chatApiParams.pageNumberOfConversations=1,e&&0===e.length&&(h.chatLibrary.chatLayout.chatLandingEnabled=!0),h.getAllFriends()):(h.chatLibrary.chatLayout.pageDataLoading&&(h.chatLibrary.chatLayout.pageDataLoading=!1),h.chatApiParams.loadMoreConversations=!0),h.chatLibrary.chatLayout.urlParseInitialized||function(){if(window&&window.location){m.debug("--- -initialzeUrlParser- ---");var e=window.location.search;e&&-1<e.indexOf("?")&&(e=e.substr(1)).split("&").forEach(function(e){var a=e.split("="),t=a[0],i=decodeURIComponent(a[1]);switch(t){case f.urlParamNames.startConversationWithUserId:h.startSpecificConversationFromUserId(i);break;case f.urlParamNames.conversationId:h.chatLibrary.chatLayout.urlParseInitialized=!0,h.startSpecificConversationFromConvId(i)}})}}(),P.getUserContacts(a,t),D.getUserInfo(a,t)}).finally(function(){R.isTracerEnabled&&R.instrumentation.finalizeSpan(h.getUserConversationsSpan)})},h.updateConversationTitle=function(i,r){var e=[i];o.getConversations(e).then(function(e){e&&B.a.forEach(e,function(e){if(e.id===i){var a;a=h.chatLibrary.conversationsDict[i]?h.chatLibrary.conversationsDict[i].layoutId:h.getLayoutId(i,f.dialogType.CHAT);var t=h.chatUserDict[a];f.updateConversationTitle(t,e.title),h.chatLibrary.userId!==r&&(t.actorUsername=h.chatLibrary.friendsDict[r].name,v.buildSystemMessage(f.notificationType.conversationTitleChanged,t))}})},function(){m.debug(" -------- getConversations request failed ------ ")})},h.resetTypingStatusAsReceiver=function(e,a){m.debug("--------- resetTypingStatusAsReceiver has been called-----------");var t=e.typing,i=e.typing.userTypingDict[a],r=e.typing.userIds.indexOf(a);e.typing.userIds.splice(r),e.typing.isTypingFromSender=!1,i.status=!1,i.lastTimeReceiveTypingEvent=null,l.cancel(i.lastTimeReceiveTimer),delete e.typing.userTypingDict[a],l.cancel(t.lastTimeReceiveTimer)},h.typingStatusForReceiverExpirationInterval=function(e,a,t){e.typing.userIds.indexOf(t)<0&&e.typing.userIds.push(t);var i=a||(new Date).getTime(),r=e.typing.userTypingDict[t];r.lastTimeReceiveTypingEvent||(r.lastTimeReceiveTypingEvent=i),(i-r.lastTimeReceiveTypingEvent>h.chatLibrary.typingInChatForReceiverExpirationMs||!r.status)&&h.resetTypingStatusAsReceiver(e,t)},h.updateConverationTypingStatus=function(e,a){var t=h.chatLibrary.conversationsDict[e]?h.chatLibrary.conversationsDict[e].layoutId:h.getLayoutId(e),i=h.chatUserDict[t],r=a.status,s=a.userId,n=h.chatLibrary.dialogsLayout[t];if(n){n.typing.userTypingDict[s]||(n.typing.userTypingDict[s]={}),n.typing.isTypingFromSender=r;var o=n.typing.userTypingDict[s];o.status=r,v.refreshTypingStatus(i,s,r,n),r&&!o.lastTimeReceiveTimer?(m.debug("--------- start a new timer-----------".concat(s)),h.typingStatusForReceiverExpirationInterval(n,null,s),o.lastTimeReceiveTimer=l(function(){return h.typingStatusForReceiverExpirationInterval(n,null,s)},h.chatLibrary.typingInChatForReceiverExpirationMs)):!r&&o.lastTimeReceiveTimer&&(m.debug("--------- cancel timer-----------".concat(s)),h.resetTypingStatusAsReceiver(n,s))}},h.fetchPlaceDetailsIntoPlacesLibrary=function(e,t){e&&0<e.length&&u.multiGetPlaceDetails(e).then(function(e){u.buildPlacesLibrary(h.chatLibrary,e);var a=h.chatLibrary.placesLibrary;B.a.forEach(t,function(e){u.buildButtonLayoutPerConversation(e,a)})})},h.handleChatNotifications=function(a){m.debug("--------- this is ChatNotifications subscription -----------".concat(a.Type));try{var e=a.Type,t=a.ConversationId;switch(e){case f.notificationType.newMessage:w(t);break;case f.notificationType.newMessageBySelf:w(t,!0);break;case f.notificationType.newConversation:case f.notificationType.addedToConversation:case f.notificationType.participantAdded:case f.notificationType.participantLeft:k(t);break;case f.notificationType.removedFromConversation:if(!h.chatLibrary.conversationsDict[t].remove){var i=h.chatLibrary.conversationsDict[t].layoutId;h.chatLibrary.conversationsDict[t].remove=!0,h.closeDialog(i)}break;case f.notificationType.conversationTitleChanged:var r=a.ActorTargetId;h.updateConversationTitle(t,r);break;case f.notificationType.participantTyping:var s={status:a.IsTyping,userId:a.UserId};h.updateConverationTypingStatus(t,s);break;case f.notificationType.conversationUniverseChanged:if(h.chatLibrary.conversationsDict[t]){var n=a.RootPlaceId,o=a.UniverseId,l=(r=a.ActorTargetId,i=h.chatLibrary.conversationsDict[t].layoutId,h.chatUserDict[i]),c=h.chatLibrary.placesLibrary&&h.chatLibrary.placesLibrary[n]?h.chatLibrary.placesLibrary[n].placeName:"",d=h.chatLibrary.placesLibrary&&h.chatLibrary.placesLibrary[n]?h.chatLibrary.placesLibrary[n].encodedPlaceName:"",g={rootPlaceId:n,universeId:o,actorUsername:h.chatLibrary.friendsDict[r].name,userId:a.ActorTargetId,placeName:c,encodedPlaceName:d},u=[n],p=[l];h.fetchPlaceDetailsIntoPlacesLibrary(u,p),L.setPinGameData(l,g),n&&r!==h.chatLibrary.userId&&!h.chatLibrary.isRespectingMessageTypeEnabled&&v.buildSystemMessage(f.notificationType.conversationUniverseChanged,l)}}}catch(e){var y="ChatNotifications:".concat(a.Type,": ");e&&e.message&&(y+=e.message),b.fireEvent(h.chatLibrary.googleAnalyticsEvent.category,h.chatLibrary.googleAnalyticsEvent.action,y)}},h.handleFriendshipNotifications=function(a){m.debug("--------- this is FriendshipNotifications subscription -----------".concat(a.Type));try{switch(a.Type){case f.notificationType.friendshipDestroyed:var e=a.EventArgs;B.a.forEach(e,function(e){e!==h.chatLibrary.userId&&h.$digest(h.removeFriend(e))}),S.initializeFriends(h.chatLibrary,h.getFriendsInfo,!0),r.triggerHandler("Roblox.Friends.CountChanged");break;case f.notificationType.friendshipCreated:S.initializeFriends(h.chatLibrary,h.getFriendsInfo,!0),r.triggerHandler("Roblox.Friends.CountChanged")}}catch(e){var t="FriendshipNotifications:".concat(a.Type,": ");e&&e.message&&(t+=e.message),b.fireEvent(h.chatLibrary.googleAnalyticsEvent.category,h.chatLibrary.googleAnalyticsEvent.action,t)}},h.buildPlayTogetherInConversationFromPresence=function(e,r,s){B.a.forEach(e,function(e){var a=h.chatUserDict[e],t=[r];if(p.sortPlayTogetherIds(a,s),h.fetchPlaceDetailsIntoPlacesLibrary(t,[a]),h.chatLibrary.dialogDict[e]){a.pinGame&&r===a.pinGame.rootPlaceId&&s.userId!==h.chatLibrary.userId&&(a.recentUserIdFromPresence=s.userId,a.recentPlaceIdFromPresence=r,v.buildSystemMessage(f.notificationType.presenceOnline,a));var i=h.chatLibrary.dialogsLayout[e];!i.togglePopoverParams.isOpen&&!a.placeForShown&&a.playTogetherIds&&0<a.playTogetherIds.length&&(i.togglePopoverParams.isOpen=!0)}p.setPlaceForShown(a)})},h.releasePlayerFromActivePlaceLists=function(e,r){B.a.forEach(e,function(e){var t=h.chatUserDict[e],i=[];if(B.a.forEach(t.playTogetherDict,function(e,a){if(a=parseInt(a),-1<e.playerIds.indexOf(r)){var t=e.playerIds.indexOf(r);e.playerIds.splice(t,1),0===e.playerIds.length&&i.push(a)}}),i&&0<i.length&&B.a.forEach(i,function(e){var a=t.playTogetherIds.indexOf(e);t.playTogetherIds.splice(a,1),delete t.playTogetherDict[e]}),p.setPlaceForShown(t),t.pinGame&&t.pinGame.rootPlaceId){var a=t.pinGame.rootPlaceId;u.updateButtonLayoutPerConversation(t,a)}})},h.vanishRootPlaceIdFromPlayTogether=function(r,s,e){B.a.forEach(e,function(e){var t=h.chatUserDict[e],i=[];B.a.forEach(t.playTogetherDict,function(e,a){a=parseInt(a),s===a&&1===e.playerIds.length&&-1<e.playerIds.indexOf(r)&&i.push(a)}),i&&0<i.length&&B.a.forEach(i,function(e){var a=t.playTogetherIds.indexOf(e);t.playTogetherIds.splice(a,1),delete t.playTogetherDict[e]})})},h.updatePresenceInFriendDict=function(e){h.chatLibrary.friendsDict[e.userId].userPresenceType=e.userPresenceType,h.chatLibrary.friendsDict[e.userId].presenceData=e,h.chatLibrary.friendsDict[e.userId].presence=e},h.updatePresenceStatus=function(e){for(var a=0;a<e.length;a++){var t=e[a],i=t.userId;h.chatLibrary.friendsDict[i]||(h.chatLibrary.friendsDict[i]={});var r=t.userPresenceType,s=h.chatLibrary.friendsDict[i].presence,n=null;switch(r){case y.status.inGame:var o=t.rootPlaceId;s&&r===s.userPresenceType&&o===s.rootPlaceId||(n=h.chatLibrary.layoutIdsDictPerUserId[i],s&&s.rootPlaceId&&h.vanishRootPlaceIdFromPlayTogether(i,s.rootPlaceId,n),h.updatePresenceInFriendDict(t),o&&h.buildPlayTogetherInConversationFromPresence(n,o,t));break;default:s&&r===s.userPresenceType||(h.updatePresenceInFriendDict(t),s&&s.userPresenceType===y.status.inGame&&(n=h.chatLibrary.layoutIdsDictPerUserId[i],h.releasePlayerFromActivePlaceLists(n,i)))}}},h.listenToPresenceServiceInWeb=function(){r.on("Roblox.Presence.Update",function(e,a){h.updatePresenceStatus(a)})},h.handlePresenceBulkNotifications=function(a){m.debug("--------- this is PresenceBulkNotifications subscription -----------".concat(a.Type));try{var t=[];B.a.forEach(a,function(e){switch(e.Type){case f.notificationType.presenceChanged:var a=e.UserId;t.push(a)}}),0<t.length&&D.getUserPresence(t,h.chatLibrary.friendsDict).then(function(e){if(e&&e.userPresences){var a=e.userPresences;h.updatePresenceStatus(a)}})}catch(e){var i="PresenceBulkNotifications:".concat(a.Type,": ");e&&e.message&&(i+=e.message),b.fireEvent(h.chatLibrary.googleAnalyticsEvent.category,h.chatLibrary.googleAnalyticsEvent.action,i)}},h.unsubscribeRealTimeForChat=function(){A.Unsubscribe(f.notificationsName.ChatNotifications,h.handleChatNotifications),A.Unsubscribe(f.notificationsName.FriendshipNotifications,h.handleFriendshipNotifications),A.Unsubscribe(f.notificationsName.PresenceBulkNotifications,h.handlePresenceBulkNotifications)},h.handleChatPrivacySetting=function(a){m.debug("--------- this is ChatPrivacySettingNotifications subscription -----------".concat(a.Type));try{switch(a.Type){case f.notificationType.chatEnabled:h.chatLibrary.chatLayout.isChatEnabledByPrivacySetting=h.chatLibrary.chatLayout.chatEnabledByPrivacySettingTypes.enabled,h.handleSignalRSuccess(!0),h.initializeRealTimeSubscriptionsForChat();break;case f.notificationType.chatDisabled:h.chatLibrary.chatLayout.isChatEnabledByPrivacySetting=h.chatLibrary.chatLayout.chatEnabledByPrivacySettingTypes.disabled,h.unsubscribeRealTimeForChat()}}catch(e){var t="ChatPrivacySettingNotifications:".concat(a.Type,": ");e&&e.message&&(t+=e.message),b.fireEvent(h.chatLibrary.googleAnalyticsEvent.category,h.chatLibrary.googleAnalyticsEvent.action,t)}},h.initializeRealTimeSubscriptionsForChatPrivacySetting=function(){B.a.isDefined(A)&&A.Subscribe(f.notificationsName.ChatPrivacySettingNotifications,h.handleChatPrivacySetting)},h.initializeRealTimeSubscriptionsForChat=function(){B.a.isDefined(A)&&(s.logSinglePerformanceMark(f.performanceMarkLabels.chatSignalRInitializing),A.SubscribeToConnectionEvents(h.handleSignalRSuccess,h.handleSignalRSuccess,h.handleSignalRError,f.notificationsName.ChatNotifications),A.Subscribe(f.notificationsName.ChatNotifications,h.handleChatNotifications),A.Subscribe(f.notificationsName.FriendshipNotifications,h.handleFriendshipNotifications),h.chatLibrary.isPresenceServiceInWebEnabled?h.listenToPresenceServiceInWeb():A.Subscribe(f.notificationsName.PresenceBulkNotifications,h.handlePresenceBulkNotifications))},h.handleSignalRSuccess=function(e){if(m.debug(" -------- Signal R is connected ------ "),h.chatLibrary.chatLayout.errorMaskEnable&&h.$apply(function(){h.chatLibrary.chatLayout.errorMaskEnable=!1}),h.chatLibrary.timer&&t.cancel(h.chatLibrary.timer),e||s.logSinglePerformanceMark(f.performanceMarkLabels.chatSignalRSucceeded),h.chatLibrary.chatLayout.pageInitializing)h.chatLibrary.chatLayout.pageInitializing=!1;else try{e&&(h.initializePresetData(),h.initializeChat())}catch(e){var a="handleSignalRSuccess: ";e&&e.message&&(a+=e.message),b.fireEvent(h.chatLibrary.googleAnalyticsEvent.category,h.chatLibrary.googleAnalyticsEvent.action,a)}},h.handleSignalRError=function(){m.debug(" -------- Signal R is disconnected ------ "),h.chatLibrary.timer=t(function(){h.chatLibrary.chatLayout.errorMaskEnable=!0},parseInt(h.chatLibrary.signalRDisconnectionResponseInMilliseconds))},h.onResize=function(){if(h.chatLibrary.chatLayout.numberOfDialogs>h.chatLibrary.chatLayout.availableNumberOfDialogs)for(;h.chatLibrary.dialogIdList.length>h.chatLibrary.chatLayout.availableNumberOfDialogs;){m.debug(" -------------overflow ------ $scope.chatLibrary.dialogIdList.length ------------- ".concat(h.chatLibrary.dialogIdList.length));var e=h.chatLibrary.dialogIdList.pop();if(B.a.isUndefined(e))break;e&&h.chatLibrary.dialogDict[e]&&(h.chatLibrary.dialogDict[e].isUpdated=!0,h.chatLibrary.dialogDict[e].updateStatus=f.dialogStatus.MINIMIZE)}else if(h.chatLibrary.chatLayout.numberOfDialogs<h.chatLibrary.chatLayout.availableNumberOfDialogs)for(;h.chatLibrary.dialogIdList.length<h.chatLibrary.chatLayout.availableNumberOfDialogs;){m.debug(" -------------fit ------ $scope.chatLibrary.dialogIdList.length ------------- ".concat(h.chatLibrary.dialogIdList.length));e=h.chatLibrary.minimizedDialogIdList.pop();if(B.a.isUndefined(e))break;if(e&&h.chatLibrary.minimizedDialogData[e]){delete h.chatLibrary.minimizedDialogData[e],h.chatLibrary.dialogIdList.push(e);var a=z({},f.dialogInitValue);h.chatLibrary.dialogDict[e]=a}}h.chatLibrary.chatLayout.resizing=!1},h.getLayoutId=function(e,a){switch(a){case f.dialogType.FRIEND:return"friend_".concat(e);case f.dialogType.NEWGROUPCHAT:return f.newGroup.dialogType;case f.dialogType.CHAT:case f.dialogType.GROUPCHAT:case f.dialogType.ADDFRIENDS:default:return"conv_".concat(e)}},h.formatUserDataByType=function(e){switch(e.type){case f.participantType.user:e.userId=e.targetId,e.id=e.targetId}},h.getUserInfoForConversation=function(i){if(i.initiator&&h.formatUserDataByType(i.initiator),i.participants){i.userIds=[],i.candidatePlayerIds=[];var r=[];i.participants.forEach(function(e){h.formatUserDataByType(e);var a=e.userId,t=e.name;switch(i.dialogType){case h.dialogType.GROUPCHAT:i.userIds.push(a),a!==h.chatLibrary.userId&&(i.playerIds&&i.playerIds.indexOf(a)<0||!i.playerIds)&&i.candidatePlayerIds.push(a);break;case h.dialogType.CHAT:a!==h.chatLibrary.userId&&(i.userIds.push(a),i.displayUserId=a,i.username=t,(i.playerIds&&i.playerIds.indexOf(a)<0||!i.playerIds)&&i.candidatePlayerIds.push(a));break;default:i.userIds.push(a)}a!==h.chatLibrary.userId&&h.buildPlayTogetherListForEachConveration(e,i),h.chatLibrary.friendsDict[a]||(r.push(a),h.chatLibrary.friendsDict[a]={id:a,name:e.name}),!i.isGroupChat&&h.chatViewModel.friendsHasConversation.indexOf(a)<0&&h.chatViewModel.friendsHasConversation.push(a),h.chatLibrary.layoutIdsDictPerUserId[a]||(h.chatLibrary.layoutIdsDictPerUserId[a]=[]),h.chatLibrary.layoutIdsDictPerUserId[a].indexOf(i.layoutId)<0&&h.chatLibrary.layoutIdsDictPerUserId[a].push(i.layoutId)}),0<r.length&&D.getUserInfo(r,h.chatLibrary.friendsDict).then(function(e){e&&(r.forEach(function(e){var a=h.chatLibrary.friendsDict[e];h.buildPlayTogetherListForEachConveration(a,i),h.getPlaceDetailsForNewPlaceIds([i])}),P.getUserContacts(r,h.chatLibrary.friendsDict))}),p.setPlaceForShown(i)}},h.buildPlayTogetherListForEachConveration=function(e,a){if(!h.chatLibrary.friendsDict)return!1;var t=h.chatLibrary.friendsDict[e.id];t&&t.presence&&t.presence.userPresenceType===y.status.inGame&&p.sortPlayTogetherIds(a,t.presence)},h.updateChatViewModel=function(r,e){switch(r.isGroupChat||r.dialogType!==f.dialogType.CHAT||r.participants.forEach(function(e){var a=e.targetId;if(a!==h.chatLibrary.userId){var t=h.getLayoutId(a,f.dialogType.FRIEND),i=h.chatLibrary.chatLayoutIds.indexOf(t);-1<i&&(h.chatLibrary.chatLayoutIds.splice(i,1),delete h.chatUserDict[t]),F(t,!0),h.chatLibrary.userConversationsDict[a]=r.layoutId}}),r.dialogType){case h.dialogType.GROUPCHAT:case h.dialogType.CHAT:r.name=r.title,h.chatLibrary.allConversationLayoutIdsDict[r.id]=r.layoutId;break;default:B.a.isDefined(r.Username)&&(r.name=r.Username)}h.chatUserDict[r.layoutId]=r;var a=h.chatLibrary.chatLayoutIds.indexOf(r.layoutId);if(-1<a&&h.chatLibrary.chatLayoutIds.splice(a,1),r.isConversation)if(e){var t=h.chatLibrary.chatLayoutIds[0];h.chatUserDict[t];h.chatLibrary.chatLayoutIds.unshift(r.layoutId)}else h.chatLibrary.chatLayoutIds.push(r.layoutId);F(r.layoutId),r.isConversation&&!h.chatLibrary.conversationsDict[r.id]&&(h.chatLibrary.conversationsDict[r.id]=z({},f.conversationInitStatus),h.chatLibrary.conversationsDict[r.id].layoutId=r.layoutId)},h.filterFriends=function(e){var a=[];e=f.sortFriendList(h.chatLibrary,e),h.chatLibrary.friendIds=[],h.chatLibrary.friendLayoutIds=[],e.forEach(function(e){!function(e){if(h.chatLibrary.friendIds.indexOf(e.id)<0&&h.chatLibrary.friendIds.push(e.id),!h.chatLibrary.friendsDict[e.id]){var a=z({},e);h.chatLibrary.friendsDict[e.id]=a}if(h.chatViewModel.friendsHasConversation.indexOf(e.id)<0){var t=h.getLayoutId(e.id,f.dialogType.FRIEND);e.layoutId=t,e.isConversation=!1,e.dialogType=f.dialogType.FRIEND,h.chatLibrary.friendLayoutIds.indexOf(t)<0&&h.chatLibrary.friendLayoutIds.push(t),h.updateChatViewModel(e,!1),h.chatLibrary.chatLayout.chatLandingEnabled&&(h.chatLibrary.chatLayout.chatLandingEnabled=!1),h.buildPlayTogetherListForEachConveration(e,e),p.setPlaceForShown(e)}}(e)}),h.getPlaceDetailsForNewPlaceIds(e),h.chatLibrary.chatLayoutIds.forEach(function(e){h.chatUserDict[e].isConversation&&a.push(e)});var t=a.concat(h.chatLibrary.friendLayoutIds);h.chatLibrary.chatLayoutIds=t},h.updateConversationInLocalStorage=function(e){var a={pageNumber:1,pageSize:h.chatApiParams.pageSizeOfConversations},t=T.getStorageName(T.chatDataName.getUserConversations,a),i=T.getChatDataFromLocalStorage(t);if(i){var r=i.data;r.unshift(e),T.saveChatDataToLocalStorage(t,r)}},h.buildChatUserListByUnreadConversations=function(e,a){e.forEach(function(e){e.isGroupChat=f.conversationType.multiUserConversation===e.conversationType,v.formatTimestampInConversation(e);var a=h.getLayoutId(e.id,f.dialogType.CHAT);if(h.chatUserDict[a]){var t=h.chatUserDict[a];e.hasUnreadMessages&&e.chatMessages&&0<e.chatMessages.length&&(t.hasUnreadMessages=!0,h.chatLibrary.dialogDict[a]&&-1<h.chatLibrary.dialogIdList.indexOf(a)&&(v.processMessages(h.chatLibrary,t,e.chatMessages,h.chatLibrary.friendsDict),u.fetchDataForLinkCard(e.chatMessages,h.chatLibrary)),h.chatLibrary.isRespectingMessageTypeEnabled?t.displayMessage=v.getDisplayMessageForUser(e.chatMessages):(f.sanitizeMessage(e.chatMessages[0]),t.displayMessage=v.buildDisplayMessage(e.chatMessages[0])),h.updateChatViewModel(t,!0)),t.participants=e.participants,h.getUserInfoForConversation(t),E(t)}else h.updateConversationInLocalStorage(e),e.layoutId=a,e.isConversation=!0,e.dialogType=e.isGroupChat?f.dialogType.GROUPCHAT:f.dialogType.CHAT,h.getUserInfoForConversation(e),h.updateChatViewModel(e,!0),E(e)})},h.getPlaceDetailsForNewPlaceIds=function(e){var r=[],s=[];if(e.forEach(function(t){var i=h.chatLibrary.placesLibrary;if(t.pinGame){var e=t.pinGame.rootPlaceId;!f.isPlaceDetailQualifiedInLibrary(i,e)&&r.indexOf(e)<0&&r.push(e)}t.playTogetherIds&&0<t.playTogetherIds.length&&t.playTogetherIds.forEach(function(e){!f.isPlaceDetailQualifiedInLibrary(i,e)&&r.indexOf(e)<0&&r.push(e);var a=t.id;t.placeButtonLayout&&t.placeButtonLayout[e]||!(s.indexOf(a)<0)||s.push(a)})}),0<r.length)h.fetchPlaceDetailsIntoPlacesLibrary(r,e);else if(0<s.length){var a=h.chatLibrary.placesLibrary;B.a.forEach(e,function(e){-1<s.indexOf(e.id)&&u.buildButtonLayoutPerConversation(e,a)})}},h.isConversationExistedInViewModel=function(e){if(e&&e.layoutId){var a=e.layoutId;return h.chatUserDict&&h.chatUserDict[a]}return!1},h.buildChatUserListByConversations=function(e,t){var i=[];e.forEach(function(e){var a=h.getLayoutId(e.id,e.dialogType);i.push(e.id),e.layoutId=a,e.isConversation=!0,h.getUserInfoForConversation(e),h.isConversationExistedInViewModel(e)||h.updateChatViewModel(e,t)}),h.getMessageForConversations(i),h.getPlaceDetailsForNewPlaceIds(e)},h.openConversation=function(e,r){var s=h.chatLibrary.dialogRequestedToOpenParams.layoutId,n=h.chatLibrary.dialogRequestedToOpenParams.autoPop;if(h.chatUserDict[s]&&h.chatUserDict[s].isConversation)h.updateDialogList(s,n);else{var a=e||h.chatUserDict[s].id;r=void 0===r||"boolean"!=typeof r||r,o.startOneToOneConversation(a).then(function(e){var a=h.chatLibrary.chatLayoutIds.indexOf(s);h.chatLibrary.chatLayoutIds.splice(a,1),delete h.chatUserDict[s],F(s,!0);var t=h.getLayoutId(e.id,f.dialogType.CHAT);if(e.layoutId=t,e.isConversation=!0,e.dialogType=f.dialogType.CHAT,e.chatMessages=[],e.isGroupChat=e.conversationType===f.conversationType.multiUserConversation,h.getUserInfoForConversation(e),u.buildButtonLayoutPerConversation(e,h.chatLibrary.placesLibrary),h.updateChatViewModel(e,r),h.updateDialogList(t,n),e.pinGame){var i=e.pinGame.rootPlaceId;h.fetchPlaceDetailsIntoPlacesLibrary([i],[e])}f.updateFocusedDialog(h.chatLibrary,t),v.formatTimestampInConversation(e)},function(){m.debug(" ---- startOneToOneConversation ---- failed!")})}},h.destroyDialogLayout=function(e){var a="#".concat(e);B.a.element(a).empty()},h.deleteLayoutIdFromDialogList=function(e){for(var a=h.chatLibrary.dialogIdList,t=[],i=0;i<a.length;i++)a[i]===e&&t.push(i);if(0<t.length){for(var r=t.length-1;0<=r;r--)h.chatLibrary.dialogIdList.splice(t[r],1);delete h.chatLibrary.dialogDict[e]}},h.expandGameListInConversation=function(e){var a=h.chatUserDict[e];h.chatLibrary.playTogetherLibrary&&h.chatLibrary.playTogetherLibrary[a.id]&&(h.chatLibrary.playTogetherLibrary[a.id].layout.activeGamesList.isCollapsed=!0)},h.launchDialog=function(e,a){if(h.chatLibrary.dialogRequestedToOpenParams.layoutId=e,h.chatLibrary.dialogRequestedToOpenParams.autoPop=a,h.chatLibrary.dialogIdList.indexOf(e)<0&&e===f.newGroup.layoutId)h.updateDialogList(e,a),h.chatUserDict[f.newGroup.layoutId]=h.newGroup;else if(h.chatLibrary.dialogIdList.indexOf(e)<0&&h.chatUserDict[e])h.openConversation(),h.expandGameListInConversation(e),a||f.updateFocusedDialog(h.chatLibrary,e);else if(-1<h.chatLibrary.dialogIdList.indexOf(e)&&h.chatLibrary.dialogsLayout[e]){var t=h.chatLibrary.dialogsLayout[e];t.focusMeEnabled=!0,f.updateFocusedDialog(h.chatLibrary,e),t.collapsed&&(t.collapsed=!1,f.updateDialogsPosition(h.chatLibrary))}},h.closeDialog=function(e){var a,t,i=h.chatUserDict[e];i&&(a=f.getScrollBarSelector(i),t=B.a.element(a));B.a.element("#chat-main");if(h.chatLibrary.chatLayout.focusedLayoutId===e&&f.updateFocusedDialog(h.chatLibrary,null),h.deleteLayoutIdFromDialogList(e),i&&i.dialogType===f.dialogType.NEWGROUPCHAT&&(i.selectedUserIds=[],i.selectedUsersDict={},i.numberOfSelected=0),t&&0<t.length&&t.mCustomScrollbar("destroy"),h.$broadcast("Roblox.Chat.MarkDialogInactive",{layoutId:e}),i){var r=i.id;if(h.chatLibrary.conversationsDict[r]&&h.chatLibrary.conversationsDict[r].remove){var s=h.chatLibrary.chatLayoutIds.indexOf(e);-1<s&&i&&(h.chatLibrary.chatLayoutIds.splice(s,1),delete h.chatUserDict[e],B.a.equals(h.chatUserDict,{})&&(h.chatLibrary.chatLayout.chatLandingEnabled=!0)),F(e,!0)}else v.processMessages(h.chatLibrary,i,null)}if(h.destroyDialogLayout(e),0<h.chatLibrary.minimizedDialogIdList.length){var n=h.chatLibrary.minimizedDialogIdList.shift();delete h.chatLibrary.minimizedDialogData[n],h.chatLibrary.dialogIdList.push(n),h.chatLibrary.dialogDict[n].isUpdated=!0,h.chatLibrary.dialogDict[n].updateStatus=f.dialogStatus.REPLACE}c.updateStorage(c.storageDictionary.dialogIdList,h.chatLibrary.dialogIdList,h.chatLibrary.cookieOption),c.updateStorage(c.storageDictionary.dialogDict,h.chatLibrary.dialogDict,h.chatLibrary.cookieOption),h.chatLibrary.dialogsLayout&&h.chatLibrary.dialogsLayout[e]&&(h.chatLibrary.dialogsLayout[e].collapsed=!1),delete h.chatLibrary.dialogsLayout[e],c.updateStorage(c.storageDictionary.dialogsLayout,h.chatLibrary.dialogsLayout,h.chatLibrary.cookieOption)},h.validLayoutId=function(e,a){if(h.chatUserDict[e])return!0;switch(a){case f.dialogType.FRIEND:h.chatApiParams.loadMoreFriends?h.getAllFriends():h.chatLibrary.chatLayout.urlParseInitialized=!0;break;case f.dialogType.CHAT:default:h.chatApiParams.loadMoreConversations?h.getUserConversations():h.chatLibrary.chatLayout.urlParseInitialized=!0}return!1},h.startSpecificConversationFromUserId=function(e){var a=x(e),t=f.dialogType.CHAT;a||(a=h.getLayoutId(e,f.dialogType.FRIEND),t=f.dialogType.FRIEND),h.validLayoutId(a,t)?(h.chatLibrary.chatLayout.urlParseInitialized=!0,h.launchDialog(a,!0)):(h.chatLibrary.dialogRequestedToOpenParams.layoutId=a,h.chatLibrary.dialogRequestedToOpenParams.autoPop=!0,h.openConversation(e,!1))},h.startSpecificConversationFromConvId=function(e){var a=h.getLayoutId(e,f.dialogType.CHAT);m.debug("--attempting to open specific conversation on load: ".concat(e,"--")),h.validLayoutId(a,f.dialogType.CHAT)&&(h.chatLibrary.chatLayout.urlParseInitialized=!0,h.launchDialog(a))},h.openSettingsPage=function(){window.location.href=a.getAbsoluteUrl(f.linksLibrary.settingLink)},h.getAvatars=function(e){e&&0<e.length&&D.getAvatarHeadshots(e,h.chatLibrary.friendsDict)},h.getFriendsInfo=function(e){t(function(){h.chatLibrary.chatLayout.pageDataLoading&&(h.chatLibrary.chatLayout.pageDataLoading=!1);var t=[];B.a.forEach(e,function(e,a){t.push(a),e.id=parseInt(a),e.userId=parseInt(a),h.chatLibrary.friendsDict[a]||(h.chatLibrary.friendsDict[a]=e)}),h.filterFriends(e),h.getAvatars(t)},0)},h.initializeChat=function(){h.chatUserDict&&h.chatLibrary||h.setup(),s.logSinglePerformanceMark(f.performanceMarkLabels.chatConversationsLoading),h.updateUnreadConversationCount(),h.getUserConversations(),R.isTracerEnabled&&R.instrumentation.finalizeSpan(h.span)},h.initializeEvents=function(){B.a.element(i).bind("resize",function(){!h.chatLibrary.chatLayout.resizing&&(0<h.chatLibrary.dialogIdList.length||0<h.chatLibrary.minimizedDialogIdList.length)&&(h.chatLibrary.chatLayout.resizing=!0,U(),h.dialogsOverflowWindow()||function(){var e=r.innerWidth();return h.chatLibrary.chatLayout.numberOfDialogs<h.chatLibrary.chatLayout.availableNumberOfDialogs&&e>f.chatLayout.thresholdMobile}()?(m.debug(" ------- need to resize -------------- "),h.onResize()):h.chatLibrary.chatLayout.resizing=!1)}),h.$on("Roblox.Chat.destroyChatCookie",function(){c.removeFromStorage(c.storageDictionary.dialogIdList,h.chatLibrary.cookieOption),c.removeFromStorage(c.storageDictionary.dialogDict,h.chatLibrary.cookieOption),c.removeFromStorage(c.storageDictionary.dialogsLayout,h.chatLibrary.cookieOption),c.removeFromStorage(c.storageDictionary.chatBarLayout,h.chatLibrary.cookieOption),c.removeFromStorage(c.storageDictionary.chatFriendsListReloadTime),e.removeLocalStorage(h.chatLibrary.dialogLocalStorageName),T.clearLocalStorage()}),h.$on("Roblox.Chat.LoadUnreadConversationCount",function(){h.updateUnreadConversationCount()}),r.bind("Roblox.Chat.StartChat",function(e,a){h.startSpecificConversationFromUserId(a.userId)})},h.initializeServices=function(e){o.setParams(),v.setParams(e),u.setParams(N.EnvironmentUrls.chatApi,N.EnvironmentUrls.gamesApi),T.setStorageParams(e)},h.initializeLayoutLibrary=function(){var e=M.thumbnailTypes,a=M.avatarHeadshotSize;h.chatLibrary.layoutLibrary={thumbnailTypes:e,avatarHeadshotSize:a}},h.initializeChatLibrary=function(e){var a=N.EnvironmentUrls.domain;h.chatLibrary.chatLayout.chatEnabledByPrivacySettingTypes=f.chatEnabledByPrivacySettingTypes,h.chatLibrary.chatLayout.isChatEnabledByPrivacySetting=e.isChatEnabledByPrivacySetting,h.chatLibrary.chatLayout.languageForPrivacySettingUnavailable=e.languageForPrivacySettingUnavailable,h.chatLibrary.chatLayout.playTogetherGameCardsEnabled=e.isPlayTogetherForGameCardsEnabled,h.chatLibrary.cookieOption={domain:a,path:"/",expires:null},h.chatLibrary.currentTabTitle=i.document.title,h.chatLibrary.dialogLocalStorageName=g.dialogLocalStorageNamePrefix+a,h.chatLibrary.domain=a,h.chatLibrary.isPresenceServiceInWebEnabled=N.PresenceService,h.chatLibrary.isUserUnder13=N.CurrentUser.isUnder13,h.chatLibrary.maxConversationTitleLengthInput=e.maxConversationTitleLength,h.chatLibrary.partyChromeDisplayTimeStampInterval=e.partyChromeDisplayTimeStampInterval,h.chatLibrary.quotaOfGroupChatMembers=e.numberOfMembersForPartyChrome-1,h.chatLibrary.screenHeight=window.screen?window.screen.height:0,h.chatLibrary.signalRDisconnectionResponseInMilliseconds=e.signalRDisconnectionResponseInMilliseconds,h.chatLibrary.typingInChatAsSenderThrottleMs=e.typingInChatFromSenderThrottleMs,h.chatLibrary.typingInChatForReceiverExpirationMs=e.typingInChatForReceiverExpirationMs,h.chatLibrary.userId=parseInt(N.CurrentUser.userId),h.chatLibrary.username=N.CurrentUser.name;var t=b.eventActions.Chat;t+=": ".concat(b.getUserAgent()),h.chatLibrary.googleAnalyticsEvent={category:b.eventCategories.JSErrors,action:t},h.chatLibrary.senderTypesForUnknownMessageTypeError=e.senderTypesForUnknownMessageTypeError,h.chatLibrary.eventStreamParams=z({},f.eventStreamParams),h.chatLibrary.relativeValueToRecordUiPerformance=e.relativeValueToRecordUiPerformance,h.chatLibrary.isUsingCacheToLoadFriendsInfoEnabled=e.isUsingCacheToLoadFriendsInfoEnabled,h.chatLibrary.cachedDataFromLocalStorageExpirationMS=e.cachedDataFromLocalStorageExpirationMS,h.chatLibrary.isInvalidMessageTypeFallbackEnabled=e.isInvalidMessageTypeFallbackEnabled,h.chatLibrary.isRespectingMessageTypeEnabled=e.isRespectingMessageTypeEnabled,h.chatLibrary.validMessageTypesWhiteList=e.validMessageTypesWhiteList,h.chatLibrary.shouldRespectConversationHasUnreadMessageToMarkAsRead=e.shouldRespectConversationHasUnreadMessageToMarkAsRead,h.chatLibrary.isFutureChatEligible=e.isVoiceChatForClientSideEnabled,h.initializeLayoutLibrary()},h.initializeChatViewModel=function(){h.chatViewModel=z({},g.chatViewModel),h.chatViewModel.chatDomain=N.EnvironmentUrls.chatApi},h.bootstrapAllInitialization=function(e){h.initializeChatViewModel(),h.initializeChatLibrary(e),h.initializeServices(e),h.initializeRealTimeSubscriptionsForChatPrivacySetting(),h.initializePresetData(),h.initializeChatBar(),h.chatLibrary.chatLayout.chatEnabledByPrivacySettingTypes&&h.chatLibrary.chatLayout.isChatEnabledByPrivacySetting===h.chatLibrary.chatLayout.chatEnabledByPrivacySettingTypes.enabled&&(h.chatLibrary.chatLayout.pageDataLoading=!0,h.initializeChat(),h.initializeRealTimeSubscriptionsForChat()),h.chatLibrary.chatLayout.pageInitializing&&(h.chatLibrary.chatLayout.pageInitializing=!1)},h.initialize=function(){h.setup(),h.initializeEvents(),h.chatLibrary.chatLayout.pageInitializing=!0,o.getMetaData().then(function(e){h.bootstrapAllInitialization(e)}),P.getContactsMetaData()},h.initialize()}n.$inject=["$scope","$window","$document","$timeout","$interval","$log","chatService","messageService","chatUtility","chatClientStorageUtilityService","localStorageService","performanceService","messageUtility","googleAnalyticsEventsService","urlService","dialogAttributes","libraryInitialization","gameService","playTogetherService","pinGameService","presenceLayout","resources","storageService","usersService","conversationsUtility","chatFriendsService","contactsService","thumbnailConstants"],r.a.controller("chatController",n),a.default=n},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e,a){var t=e.dialogData.initiator,i=e.chatLibrary.userId;e.canConversationRemoveMember=function(){return e.dialogData.dialogType!==e.dialogType.CHAT&&(t&&t.id===i)}}r.$inject=["$scope","$log"],i.a.controller("detailsController",r),a.default=r},function(e,a,t){"use strict";t.r(a);var y=t(0),h=t(9),i=t(1),m=t.n(i),r=t(2);function v(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function s(c,r,s,n,o,i,l,d,g,u,p){c.removeFromConversation=function(e,a){s.removeFromConversation(c.chatLibrary.userId,e),c.chatLibrary.chatLayoutIds&&-1<c.chatLibrary.chatLayoutIds.indexOf(a)&&(c.chatLibrary.conversationsDict[e].remove=!0,c.closeDialog({layoutId:a}))},c.sendPerformanceData=function(e){if(Math.random()<c.chatLibrary.relativeValueToRecordUiPerformance){var a=e.startSendingTime,t=(new Date).getTime()-a;s.sendPerformanceData(g.performanceMeasurements.messageSend,t)}};function a(i){h.isTracerEnabled&&(c.sendMessageSpan=h.instrumentation.createAndGetSpan("Chat:SendMessage"),h.tags.setDefaultTags(c.sendMessageSpan)),s.sendMessage(c.dialogData.id,i.rawContent).then(function(e){if(e){if(i.sendingMessage=!1,i.canResend=!1,c.sendPerformanceData(i),h.isTracerEnabled){c.sendMessageSpan.log({message:"data return",json:e});var a=h.instrumentation.createAndGetSpan("Chat:BuildNewMessage",{childOf:c.sendMessageSpan});h.tags.setDefaultTags(a)}if(e.resultType!==n.resultType.SUCCESS){if(i.sendMessageHasError=!0,i.error=n.errorMessages.default,e.resultType===n.resultType.MODERATED){if(i.error=n.errorMessages.messageContentModerated,i.content=n.hashOutContent(i.content),n.sanitizeMessage(i),i.hasLinkCard)i.linkCardMessages.forEach(function(e){e.isCard||(e.content=n.hashOutContent(e.content))})}else i.canResend=!0}else{var t=e.content;i.sendMessageHasError=!1,m.a.isUndefined(c.dialogData.messagesDict)&&(c.dialogData.messagesDict={}),i.id=e.messageId,i.sent=e.sent,i.messageType=e.messageType,o.buildTimeStamp(i,c.dialogData),o.buildDisplayMessage(i),i.resetClusterMessage=!0,n.sanitizeMessage(e),i.content=e.content,i.pieces=e.pieces,i.filteredForReceivers=e.filteredForReceivers,i.messageType=e.messageType,i.senderType=p.senderTypes.user,o.setClusterMaster(c.dialogData,i),i.hasLinkCard&&i.rawContent!==t&&(e.hasLinkCard?(d.fetchDataForLinkCard([e],c.chatLibrary),i.linkCardMessages=e.linkCardMessages):i.hasLinkCard=!1),c.dialogData.messagesDict[e.messageId]=i}h.isTracerEnabled&&childSpan.finish()}},function(e){if(r.debug(" ------ sendMessage error -------"),h.isTracerEnabled)h.instrumentation.createAndGetSpan("Chat:BuildErrorMessage",{childOf:c.sendMessageSpan});i.sendingMessage=!1,i.sendMessageHasError=!0,i.canResend=!0,e===n.sendMessageErrorCode.textTooLong&&(i.error=n.errorMessages.textTooLong),h.isTracerEnabled&&(h.tags.setDefaultTags(childSpan),h.tags.setErrorTag(childSpan),childSpan.log({message:"request_failed",stack:e}),childSpan.finish())}).finally(function(){h.isTracerEnabled&&h.instrumentation.finalizeSpan(c.sendMessageSpan)})}c.toggleDetails=function(){c.dialogLayout.details.isEnabled=!c.dialogLayout.details.isEnabled,c.saveIntoDialogsLayout()},c.toggleConversationEditor=function(){c.dialogLayout.details.isConversationTitleEditorEnabled=!c.dialogLayout.details.isConversationTitleEditorEnabled,c.dialogLayout.focusMeEnabled=c.dialogLayout.details.isConversationTitleEditorEnabled,c.saveIntoDialogsLayout()},c.toggleAddFriends=function(){c.dialogLayout.details.isAddFriendsEnabled=!c.dialogLayout.details.isAddFriendsEnabled,c.dialogLayout.details.isAddFriendsEnabled?c.addFriends():c.dialogData.addMoreFriends=!1,c.getLimitLinkNameForMemberList(),c.saveIntoDialogsLayout()},c.getLimitLinkNameForMemberList=function(e){var a=c.dialogData.userIds.length;c.dialogData.selectedUserIds&&(a+=c.dialogData.selectedUserIds.length),e&&(a-=e),c.dialogLayout.memberDisplay.linkName=c.dialogLayout.memberDisplay.isAll?c.dialogLayout.memberDisplay.seeLessLink:"".concat(c.dialogLayout.memberDisplay.seeMoreLink," (").concat(a-c.dialogLayout.memberDisplay.defaultLimit,")")},c.toggleMemberList=function(){c.dialogLayout.memberDisplay.isAll=!c.dialogLayout.memberDisplay.isAll,c.dialogLayout.memberDisplay.limitNumber=c.dialogLayout.memberDisplay.isAll?c.dialogData.userIds.length:c.dialogLayout.memberDisplay.defaultLimit,c.getLimitLinkNameForMemberList()},c.toggleFriendsMenu=function(e,a){a&&c.dialogLayout.details.friendIdForMenuOn===e?(c.dialogLayout.details.friendMenuAction={},c.dialogLayout.details.friendIdForMenuOn=null):e&&!a&&(c.dialogLayout.details.friendMenuAction[e]=!c.dialogLayout.details.friendMenuAction[e],c.dialogLayout.details.friendIdForMenuOn=e)},c.updatePopoverParams=function(){var e=c.dialogData,a=e.id,t=e.playTogetherIds,i=c.dialogLayout.togglePopoverParams,r=i.dialogSelectorPrefix,s=i.popoverTriggerSelectorPrefix,n=i.dialogTriggerClassPrefix,o=c.dialogLayout.togglePopoverParams,l={dialogSelect:r+a,triggerSelector:s+a,dialogTriggerClassSelector:n+a,isOpen:!!t&&0<t.length,isFirstTimeOpen:!0};Object.assign(o,l)},c.dialogParams=function(a){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{},i=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.forEach(function(e){v(a,e,t[e])})}return a}({},n.dialogParams),c.userPresenceTypes=n.userPresenceTypes,c.dialogData.messageForSend="",c.dialogLayout.scrollbarElm=n.getScrollBarSelector(c.dialogData,n.scrollBarType.MESSAGE),c.dialogLayout.listenToScrollInitialized=!1,c.friendsScrollbarElm=n.getScrollBarSelector(c.dialogData,n.scrollBarType.FRIENDSELECTION),c.updatePopoverParams(),c.updateDialog=function(){r.debug("---- updateDialog callback ---- Scrollbars updated"),c.dialogLayout.IsdialogContainerVisible||(m.a.element(c.dialogLayout.scrollbarElm).find(".mCustomScrollBox").addClass("dialog-visible"),c.dialogLayout.IsdialogContainerVisible=!0);return!1},c.buildNewMessage=function(e){return{read:!0,content:e,rawContent:e,senderTargetId:c.chatLibrary.userId,sendingMessage:!0,sendMessageHasError:!1,startSendingTime:(new Date).getTime(),messageType:"PlainText",senderType:"User"}},c.sendMessage=function(){if(0<c.dialogData.messageForSend.length){var e=c.buildNewMessage(c.dialogData.messageForSend);n.sanitizeMessage(e),d.fetchDataForLinkCard([e],c.chatLibrary),c.dialogData.messageForSend="",m.a.isUndefined(c.dialogData.chatMessages)&&(c.dialogData.chatMessages=[]),o.setClusterMaster(c.dialogData,e),c.dialogData.displayMessage=e,a(e)}},c.resendMessage=function(e){a(e)},c.keyPressEnter=function(){c.sendMessage(),c.dialogLayout.typing.isTypingAsSender&&(c.dialogLayout.typing.lastTimeTypingAsSender=null,c.dialogLayout.typing.isTypingAsSender=!1)},c.typing=function(e,a,t){if(a){if(e.which!==l.enter){var i=t||(new Date).getTime(),r=c.dialogLayout.typing;(!r.lastTimeTypingAsSender||i-r.lastTimeTypingAsSender>c.chatLibrary.typingInChatAsSenderThrottleMs)&&(r.lastTimeTypingAsSender=i,r.isTypingAsSender=!0,s.updateUserTypingStatus(c.dialogData.id,!0))}c.toggleDialogFocusStatus(!0)}},c.abuseReport=function(e,a){if(c.dialogLayout.isConfirmationOn=!0,e&&(c.dialogLayout.userIdForAbuseReport=e),a&&c.dialogLayout.userIdForAbuseReport){var t=u("formatString")(n.chatLayout.abuseReportUrl,{userId:c.dialogLayout.userIdForAbuseReport,location:escape(window.location),conversationId:c.dialogData.id}),i=y.Endpoints?y.Endpoints.getAbsoluteUrl(t):t;y.AbuseReportDispatcher?y.AbuseReportDispatcher.triggerUrlAction(i):window.location.href=i,c.dialogLayout.userIdForAbuseReport=null,c.dialogLayout.isConfirmationOn=!1}c.saveIntoDialogsLayout()},c.leaveGroupChat=function(e){if(e)c.chatLibrary.conversationsDict[c.dialogData.id].remove=!0,c.removeFromConversation(c.dialogData.id,c.dialogData.layoutId),c.resetConfirmDialog();else{c.dialogLayout.confirmDialog.isOpen=!0;var a=i.negativeAction.leaveChatGroup;c.dialogLayout.confirmDialog.title=a.title,c.dialogLayout.confirmDialog.headerTitle=a.headerTitle,c.dialogLayout.confirmDialog.btnName=a.btnName,c.dialogLayout.confirmDialog.cancelBtnName=a.cancelBtnName,c.dialogLayout.confirmDialog.type=a.type}},c.addFriends=function(){c.dialogData.addMoreFriends=!0,0<c.chatLibrary.friendIds.length&&c.updateFriends(),c.dialogData.scrollBarType=n.scrollBarType.FRIENDSELECTION},c.viewParticipants=function(){c.dialogLayout.lookUpMembers=!c.dialogLayout.lookUpMembers},c.toggleGroupNameEditor=function(){c.dialogLayout.renameEditor.isEnabled=!c.dialogLayout.renameEditor.isEnabled,c.dialogLayout.renameEditor.hasFocus=!c.dialogLayout.renameEditor.hasFocus,c.updateDialogStyle(),c.dialogLayout.focusMeEnabled=!c.dialogLayout.renameEditor.isEnabled},c.renameTitle=function(){var a=c.dialogData.title;s.renameGroupConversation(c.dialogData.id,c.dialogData.name).then(function(e){if(e){switch(e.resultType){case n.resultType.MODERATED:o.buildSystemMessage(n.notificationType.conversationTitleModerated,c.dialogData,!0),n.updateConversationTitle(c.dialogData,a);break;case n.resultType.SUCCESS:n.updateConversationTitle(c.dialogData,e.conversationTitle)}c.toggleConversationEditor()}})},c.removeMember=function(e,a){if(a)c.resetConfirmDialog(),c.getLimitLinkNameForMemberList(1),s.removeFromConversation(e,c.dialogData.id).then(function(){c.isOverLoaded()});else{c.dialogLayout.confirmDialog.isOpen=!0;var t=i.negativeAction.removeUser;c.dialogLayout.confirmDialog.title=t.title,c.dialogLayout.confirmDialog.headerTitle=t.headerTitle,c.dialogLayout.confirmDialog.btnName=t.btnName,c.dialogLayout.confirmDialog.cancelBtnName=t.cancelBtnName,c.dialogLayout.confirmDialog.type=t.type,c.dialogLayout.confirmDialog.params={userId:e}}},c.resetConfirmDialog=function(){Object.assign(c.dialogLayout.confirmDialog,{isOpen:!1,title:"",btnName:"",type:"",params:{}})},c.confirmCallBack=function(){var e=c.dialogLayout.confirmDialog;switch(e.type){case i.negativeAction.removeUser.type:c.removeMember(e.params.userId,!0);break;case i.negativeAction.leaveChatGroup.type:c.leaveGroupChat(!0)}},c.updateDialogHeader=function(e){c.dialogLayout.collapsed&&(c.dialogLayout.hoverOnCollapsed=e)},c.isDialogMainContainerHidden=function(){return c.dialogData.addMoreFriends||c.dialogLayout.details.isEnabled||c.dialogLayout.voiceChatLayout.isLobbyEnabled},s.getMessages(c.dialogData.id,null,c.dialogParams.pageSizeOfGetMessages).then(function(e){e&&0<e.length?(c.dialogData.chatMessages=[],c.dialogData.messagesDict={},o.processMessages(c.chatLibrary,c.dialogData,e,c.chatLibrary.friendsDict),d.fetchDataForLinkCard(e,c.chatLibrary),c.dialogData.scrollBarType=n.scrollBarType.MESSAGE):(c.dialogData.scrollBarType=n.scrollBarType.MESSAGE,c.updateDialog())}),c.$on("elastic:resize",function(e,a,t,i){r.debug("---- oldHeight -----".concat(t,"---- newHeight -----").concat(i)),t!==i&&(e.preventDefault(),e.stopPropagation(),n.setResizeInputLayout(c.chatLibrary,i,c.dialogData,c.dialogLayout))}),c.init=function(){c.getLimitLinkNameForMemberList()},c.init()}s.$inject=["$scope","$log","chatService","chatUtility","messageService","dialogAttributes","keyCode","gameService","resources","$filter","messageHelper"],r.a.controller("dialogController",s),a.default=s},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(t,e,i,r){t.isGameIconAvailable=function(){return t.isPinOrActiveGameAvailable()||t.isMyRecentGameAvailable()},t.isPinOrActiveGameAvailable=function(){return t.dialogData.placeForShown&&t.dialogData.placeForShown.universeId&&t.dialogData.placeForShown.rootPlaceId},t.isMyRecentGameAvailable=function(){return t.chatLibrary.myRecentPlaceId},t.openGameList=function(){var e=i.eventStreamParams.openGameListInPlayTogether,a={conversationId:t.dialogData.id};r.sendEventWithTarget(e,i.eventStreamParams.actions.click,a)},t.init=function(){t.gamesListTemplateUrl=i.templates.gamesList},t.init()}r.$inject=["$scope","$log","resources","eventStreamService"],i.a.controller("dialogHeaderController",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(a,e,t){a.isSenderTypeAllowed=function(e){return-1<a.chatLibrary.senderTypesForUnknownMessageTypeError.indexOf(e.senderType)},a.canRenderMessage=function(e){return!!e.sendingMessage||(!a.chatLibrary.isRespectingMessageTypeEnabled||(e.isSystemMessage||t.isMessageTypeInWhiteList(a.chatLibrary,e)&&t.isMessageTypeLegal(e)&&t.isSenderTypeLegal(e)))},a.shouldShowInvalidMessageTypePrompt=function(e){return a.chatLibrary.isInvalidMessageTypeFallbackEnabled&&a.isSenderTypeAllowed(e)}}r.$inject=["$scope","$log","messageUtility"],i.a.controller("dialogMessagesController",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(1),c=t.n(i),r=t(2);function d(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function s(s,n,o,l,r){s.isNewGroupChat=function(e){return e.dialogType===o.dialogType.NEWGROUPCHAT||e.addMoreFriends&&!e.isGroupChat},s.canAddFriendInExistedConversation=function(e){return e.addMoreFriends&&e.isGroupChat},s.resetPreviousDialog=function(e,a,t){s.chatUserDict[e].selectedUserIds=[],s.chatUserDict[e].selectedUsersDict={},t.preserved?s.chatUserDict[e].addMoreFriends=!1:delete s.chatUserDict[e];var i=s.chatLibrary.dialogIdList.indexOf(e);-1<i&&!t.preserved?(s.destroyDialogLayout(e),delete s.chatLibrary.dialogDict[e],t.isDuplicatedConversation?s.chatLibrary.dialogIdList.splice(i):(s.chatLibrary.dialogIdList[i]=a,s.chatLibrary.dialogDict[a]=function(a){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{},i=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.forEach(function(e){d(a,e,t[e])})}return a}({},o.dialogInitValue))):s.updateDialogList(a,!0)},s.generateDialog=function(e,a,t){var i=t.layoutId,r=s.getLayoutId(e.id,a);e.dialogType=a,i!==r?(s.getUserInfoForConversation(e),e.layoutId=r,e.isConversation=!0,s.updateChatViewModel(e,!0),s.resetPreviousDialog(i,r,t)):(s.getUserInfoForConversation(e),s.updateChatViewModel(e,!0),s.chatLibrary.dialogDict[i].isUpdated=!0,s.chatLibrary.dialogDict[i].updateStatus=o.dialogStatus.REFRESH)},s.createNewGroupChat=function(e,i){if(!s.newGroupChatLocked){s.newGroupChatLocked=!0;var r={layoutId:e},a=i.name;if(i.addMoreFriends&&!i.isGroupChat){var t=i.participants;c.a.forEach(t,function(e){var a=e.targetId;a!==s.chatLibrary.userId&&(i.selectedUserIds&&i.selectedUserIds.indexOf(a)<0&&i.selectedUserIds.push(a),i.selectedUsersDict[a]=c.a.copy(s.chatLibrary.friendsDict[a]),i.selectedUsersDict[a].hiddenFromSelection=!0)}),r.preserved=!0,a=""}n.startGroupConversation(i.selectedUserIds,a).then(function(e){if(e.resultType===o.resultType.SUCCESS){var a=e.conversation,t=s.chatLibrary.allConversationLayoutIdsDict[a.id];t?(r.isDuplicatedConversation=!0,s.resetPreviousDialog(i.layoutId,t,r),s.chatLibrary.dialogIdList.indexOf(t)<0&&s.launchDialog(t,!0)):(a.isGroupChat=a.conversationType===o.conversationType.multiUserConversation,l.formatTimestampInConversation(a),s.generateDialog(a,o.dialogType.GROUPCHAT,r))}s.newGroupChatLocked=!1}).catch(function(e){s.newGroupChatLocked=!1})}},s.sendInvite=function(e){r.debug("------------- sendInvite ------------");var a=s.chatUserDict[e];if(a.dialogType!==o.dialogType.CHAT&&a.dialogType!==o.dialogType.GROUPCHAT||a.addMoreFriends)s.canAddFriendInExistedConversation(a)?n.addToConversation(a.selectedUserIds,a.id).then(function(e){e&&e.resultType===o.resultType.SUCCESS&&e.conversationId&&(a.addMoreFriends=!1,a.selectedUserIds.forEach(function(e){a.userIds.indexOf(e)<0&&a.userIds.push(e)}))}).finally(function(){a.selectedUserIds=[],a.selectedUsersDict={}}):s.isNewGroupChat(a)&&s.createNewGroupChat(e,a);else{var t=a.userIds,i=t.indexOf(s.chatLibrary.userId);-1<i&&t.splice(i,1),a.selectedUserIds=t}}}s.$inject=["$scope","chatService","chatUtility","messageService","$log"],r.a.controller("dialogsController",s),a.default=s},function(e,a,t){"use strict";t.r(a);var s=t(0),i=t(1),n=t.n(i),r=t(2);function o(i,e,a,r){i.dialogLayout.scrollToBottom=!1,i.dialogLayout.IsdialogContainerVisible=!1,i.dialogParams=Object.assign({},e.dialogParams),i.dialogType=Object.assign({},e.dialogType),i.userPresenceTypes=Object.assign({},e.userPresenceTypes),i.friendsScrollbarElm=e.getScrollBarSelector(i.dialogData,e.scrollBarType.FRIENDSELECTION),i.dialogData.scrollBarType=e.scrollBarType.FRIENDSELECTION,i.dialogData.isCreated=!0,i.updateFriendsDictData=function(e){var t=[];n.a.forEach(e,function(e,a){e.id=parseInt(a),i.chatLibrary.friendsDict[a]||(i.chatLibrary.friendsDict[a]=e,t.push(a))}),i.updateFriends(e),t&&0<t.length&&r.getAvatarHeadshots(t,i.chatLibrary.friendsDict)};var t;0<i.chatLibrary.friendIds.length&&i.updateFriends(),t={isEnabled:i.chatLibrary.isUsingCacheToLoadFriendsInfoEnabled,expirationMS:i.chatLibrary.cachedDataFromLocalStorageExpirationMS},s.sharedFriendsService.register(i.updateFriendsDictData,t),i.isOverLoaded()}o.$inject=["$scope","chatUtility","friendsInfoService","usersService"],r.a.controller("friendsController",o),a.default=o},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(n,o,i,r,l,t,c,s,d){n.isLinkCardAvailableAndParsedByClientSide=function(e){return!e.isLinkCard&&e.isCard},n.sendEventStream=function(e,a){var t={placeId:a,conversationId:n.dialogData.id};i.sendEventWithTarget(e,n.chatLibrary.eventStreamParams.actions.click,t)},n.sendLoadLinkCardEvent=function(e){var a={placeId:e,conversationId:n.dialogData.id};i.sendEventWithTarget(n.chatLibrary.eventStreamParams.loadGameLinkCardInChat,n.chatLibrary.eventStreamParams.actions.render,a)},n.sendGamePlayEnvent=function(e){var a=n.chatLibrary.eventStreamParams.context;i.sendGamePlayEvent(a.gamePlayFromLinkCard,e)},n.playGame=function(e,a,t){n.sendEventStream(a,e),n.sendGamePlayEnvent(e),t&&t.privateServerLinkCode?r.playPrivateServerGame(e,t.privateServerLinkCode):n.chatLibrary.chatLayout.playTogetherGameCardsEnabled?r.playTogetherGame(e,n.dialogData.id):r.playRegularGame(e)},n.buyAccess=function(e,a){var t=n.chatLibrary.placesLibrary[e],i=t.gameIconUrl,r=c("formatString")(a.buyAccess.bodyText(),{placeName:t.placeName,creatorName:t.creatorName,price:t.price}),s={titleText:a.buyAccess.title,bodyText:r,imageUrl:i,actionButtonShow:!0,actionButtonText:a.buyAccess.yesButtonText,actionButtonClass:a.buyAccess.yesButtonClass,neutralButtonText:a.buyAccess.noButtonText,closeButtonShow:!0};n.dialogLayout.playTogetherButton.isPlayButtonDisabled=!0,l.open(s).result.then(function(){o.debug("--- purchase ---"),n.dialogLayout.playTogetherButton.isPlayButtonDisabled=!1},function(){o.debug("--- cancel ---"),n.dialogLayout.playTogetherButton.isPlayButtonDisabled=!1})},n.goToPlaceDetails=function(e,a){n.sendEventStream(a,e),t.location.href=n.chatLibrary.placesLibrary[e].placeUrl},n.play=function(e,a,t){switch(n.chatLibrary.placesLibrary[e].buttonLayoutForLinkCard.type){case d.playButtonTypes.play:n.playGame(e,a,t);break;case d.playButtonTypes.buy:n.buyAccess(e,d);break;case d.playButtonTypes.details:n.goToPlaceDetails(e,a)}},n.pinGame=function(e,a){e=parseInt(e),a=parseInt(a);var t="";if(!n.dialogData.pinGame||n.dialogData.pinGame.rootPlaceId!==parseInt(a)){t=n.chatLibrary.eventStreamParams.pinGameInLinkCard,s.sendPinGameEvent(t,a,n.dialogData);var i={rootPlaceId:a,universeId:e,actorUsername:n.chatLibrary.username,userId:n.chatLibrary.userId,placeName:n.chatLibrary.placesLibrary&&n.chatLibrary.placesLibrary[a]?n.chatLibrary.placesLibrary[a].placeName:"",encodedPlaceName:n.chatLibrary.placesLibrary&&n.chatLibrary.placesLibrary[a]?n.chatLibrary.placesLibrary[a].encodedPlaceName:""};s.setPinGameData(n.dialogData,i),s.pinGame(n.dialogData,e),r.buildButtonLayoutPerConversation(n.dialogData,n.chatLibrary.placesLibrary)}}}r.$inject=["$scope","$log","eventStreamService","gameService","modalService","$window","$filter","pinGameService","gameLayout"],i.a.controller("linkCardController",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(1),r=t.n(i),s=t(2);function n(e,a){e.pinGameLayout=r.a.copy(a),e.linkCardMessages=e.message.linkCardMessages}n.$inject=["$scope","pinGameLayout"],s.a.controller("linkCardMessagesController",n),a.default=n},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(u,o,t,l,r,p,s,n,y,i,h,m,c){u.sendEventStream=function(e,a,t){var i={placeId:a,conversationId:u.playTogether.id};t&&(i.gameInstanceId=t),s.sendEventWithTarget(e,u.chatLibrary.eventStreamParams.actions.click,i)},u.sendGamePlayEnvent=function(e){var a=u.chatLibrary.eventStreamParams.context;s.sendGamePlayEvent(a.gamePlayFromPlayTogether,e)},u.buyAccess=function(e,a){var t=u.chatLibrary.eventStreamParams.clickBuyButtonInPlayTogether;u.sendEventStream(t,e),u.dialogLayout.playTogetherButton.isPlayButtonDisabled=!0;var i=u.chatLibrary.placesLibrary[e],r=i.gameIconUrl,s=a.buyAccess.bodyText(i.encodedPlaceName,i.encodedCreatorName,i.price),n={titleText:a.buyAccess.title,bodyText:s,imageUrl:r,actionButtonShow:!0,actionButtonText:a.buyAccess.yesButtonText,actionButtonClass:a.buyAccess.yesButtonClass,neutralButtonText:a.buyAccess.noButtonText,closeButtonShow:!0};l.open(n).result.then(function(){o.debug("--- purchase ---"),u.dialogLayout.playTogetherButton.isPlayButtonDisabled=!1},function(){o.debug("--- cancel ---"),u.dialogLayout.playTogetherButton.isPlayButtonDisabled=!1})},u.goToPlaceDetails=function(e){var a=u.chatLibrary.eventStreamParams.clickViewDetailsButtonInPlayTogether;u.sendEventStream(a,e),t.location.href=u.chatLibrary.placesLibrary[e].placeUrl},u.joinGame=function(e){u.chatLibrary.eventStreamParams.clickJoinButtonInPlayTogether;var a=u.playTogether.playTogetherDict[e].placeId,t=u.playTogether.playTogetherDict[e].gameInstanceId,i=u.playTogether.playTogetherDict[e].playerIds?u.playTogether.playTogetherDict[e].playerIds[0]:null,r=c.buildPlayGameProperties(e,a,t,i),s={placeId:e,conversationId:u.playTogether.id};t&&(s.gameInstanceId=t);var n={eventName:u.chatLibrary.eventStreamParams.clickJoinButtonInPlayTogether,ctx:u.chatLibrary.eventStreamParams.actions.click,properties:s,gamePlayIntentEventCtx:u.chatLibrary.eventStreamParams.context.gamePlayFromPlayTogether};c.launchGame(r,n)},u.playGame=function(e,a){var t=u.chatLibrary.eventStreamParams.clickPlayButtonInPlayTogether;u.sendEventStream(t,e),u.sendGamePlayEnvent(e),r.playTogetherGame(e,a)},u.joinGameFromPlayTogether=function(e){e=parseInt(e);var a=u.playTogether.placeButtonLayout[e].type,t=u.playTogether.id;switch(a){case h.playButtonTypes.join:u.joinGame(e);break;case h.playButtonTypes.play:u.playGame(e,t);break;case h.playButtonTypes.buy:u.buyAccess(e,h);break;case h.playButtonTypes.details:u.goToPlaceDetails(e)}},u.toggleActiveGameList=function(){u.playTogetherLayout.activeGamesList.isCollapsed=!u.playTogetherLayout.activeGamesList.isCollapsed,u.playTogetherLayout.activeGamesList.isCollapsed?(u.playTogetherLayout.activeGamesList.toggleMenuText=u.playTogetherLayout.activeGamesList.showMoreText,u.playTogetherLayout.activeGamesList.limitNumber=u.playTogetherLayout.activeGamesList.minNumberForFit):(u.playTogetherLayout.activeGamesList.toggleMenuText=u.playTogetherLayout.activeGamesList.showLess,u.playTogetherLayout.activeGamesList.limitNumber=u.playTogetherLayout.numberOfActiveGames)},u.hasPinGameAndActiveGames=function(){return!(!u.hasActiveGames()||!u.playTogether.pinGame)&&(1!==u.playTogether.playTogetherIds.length||u.playTogether.playTogetherIds[0]!==u.playTogether.pinGame.rootPlaceId)},u.hasActiveGames=function(){var e=!1;return u.playTogether.playTogetherIds?(u.playTogether.pinGame&&(e=-1<u.playTogether.playTogetherIds.indexOf(u.playTogether.pinGame.rootPlaceId),u.playTogetherLayout.activeGamesList.pinGameIsInActiveGames=e),e?u.playTogether.playTogetherIds.length-1:u.playTogether.playTogetherIds.length):0},u.hasNoPinGameAndNoActiveGame=function(){return!(u.playTogether.pinGame&&u.playTogether.pinGame.rootPlaceId||u.hasActiveGames())},u.isMyRecentAvaliable=function(){return u.hasNoPinGameAndNoActiveGame()&&u.chatLibrary.myRecentPlaceId},u.unPinGame=function(){if(u.playTogether&&u.playTogether.pinGame){var e=u.chatLibrary.eventStreamParams.unpinGameInPlayTogether,a=u.playTogether.pinGame.rootPlaceId;n.sendPinGameEvent(e,a,u.playTogether),n.setPinGameData(u.playTogether),n.unpinGame(u.playTogether),r.updateButtonLayoutPerConversation(u.playTogether,a),i.updateScrollbar(p.gameListScrollListSelector)}},u.pinGame=function(e,a){e=parseInt(e),a=parseInt(a);var t=u.chatLibrary.eventStreamParams.pinGameInPlayTogether;n.sendPinGameEvent(t,a,u.playTogether);var i={rootPlaceId:a,universeId:e,actorUsername:u.chatLibrary.name,userId:u.chatLibrary.userId,placeName:u.chatLibrary.placesLibrary&&u.chatLibrary.placesLibrary[a]?u.chatLibrary.placesLibrary[a].placeName:"",encodedPlaceName:u.chatLibrary.placesLibrary&&u.chatLibrary.placesLibrary[a]?u.chatLibrary.placesLibrary[a].encodedPlaceName:""};n.setPinGameData(u.playTogether,i),n.pinGame(u.playTogether,e),r.updateButtonLayoutPerConversation(u.playTogether,a)},u.initData=function(){if(u.playTogetherLayout=Object.assign({},p),u.gameParameters=Object.assign({},y),u.gameLayout=Object.assign({},h),u.pinGameLayout=Object.assign({},m),u.dialogData){u.playTogether=u.dialogData,u.playTogether.inDialog=!0,u.playTogetherLayout.numberOfActiveGames=u.hasActiveGames();var e=u.playTogetherLayout.numberOfActiveGames,a=u.playTogetherLayout.activeGamesList,t=a.isCollapsed,i=a.pinGameIsInActiveGames,r=a.limitNumber,s=a.minNumberForFit,n=a.maxNumberForFit,o=a.showLess;if(i){var l={limitNumber:r+1,minNumberForFit:s+1,maxNumberForFit:n+1},c=u.playTogetherLayout.activeGamesList;Object.assign(c,l)}var d=e-s;d=0<d?d:0;var g=u.playTogetherLayout.activeGamesList.showMore(d);u.playTogetherLayout.activeGamesList.showMoreText=g,1<u.playTogetherLayout.numberOfActiveGames&&(u.playTogetherLayout.activeGamesList.toggleMenuText=t?g:o)}else u.playTogether=u.chatUser,u.playTogether.inDialog=!1,u.playTogetherLayout.numberOfActiveGames=u.hasActiveGames(),u.playTogetherLayout.activeGamesList.limitNumber=u.playTogetherLayout.numberOfActiveGames;u.chatLibrary.playTogetherLibrary[u.playTogether.id]={layout:u.playTogetherLayout}},u.initData()}r.$inject=["$scope","$log","$window","modalService","gameService","playTogetherLayout","eventStreamService","pinGameService","gameParameters","chatUtility","gameLayout","pinGameLayout","playGameService"],i.a.controller("playTogetherController",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(2);function s(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function r(t,e,i,r){t.hasGameAlbum=function(){var e=0,a=null;return t.chatUser.pinGame&&(e++,a=t.chatUser.pinGame.rootPlaceId),t.chatUser.playTogetherIds&&(a&&-1<t.chatUser.playTogetherIds.indexOf(a)?e=e+t.chatUser.playTogetherIds.length-1:e+=t.chatUser.playTogetherIds.length),1<e},t.isGameAvailableInChat=function(){return t.chatUser.placeForShown&&t.chatUser.placeForShown.universeId&&t.chatUser.placeForShown.rootPlaceId},t.openGameList=function(){if(t.hoverPopoverParams&&!t.hoverPopoverParams.isOpen){var e=i.eventStreamParams.openGameListInPlayTogether,a={conversationId:t.chatUser.id};r.sendEventWithTarget(e,i.eventStreamParams.actions.hover,a)}},t.setupHoverPopover=function(){t.hoverPopoverParams=function(a){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{},i=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.forEach(function(e){s(a,e,t[e])})}return a}({},i.hoverPopoverParams),t.hoverPopoverParams.triggerSelector=".chat-friend-".concat(t.chatUser.id),t.hoverPopoverParams.hoverPopoverSelector=".game-list-".concat(t.chatUser.id)},t.init=function(){t.gamesListTemplateUrl=i.templates.gamesList,t.setupHoverPopover()},t.init()}r.$inject=["$scope","$log","resources","eventStreamService"],i.a.controller("userConversationInfoController",r),a.default=r},function(e,a,t){var i={"./chatClientStorageUtilityService.js":77,"./chatFriendsService.js":78,"./chatService.js":79,"./chatUtilityService.js":80,"./conversationUtilityService.js":81,"./cookieService.js":82,"./dialogAttributesService.js":83,"./gameLayoutService.js":84,"./gameService.js":85,"./gameUtility.js":86,"./libraryInitializationService.js":87,"./messageService.js":88,"./messageUtility.js":89,"./pinGameLayoutService.js":90,"./pinGameService.js":91,"./playTogetherLayoutService.js":92,"./playTogetherService.js":93,"./presenceLayoutService.js":94,"./storageService.js":95,"./systemMessagesService.js":96,"./usersService.js":97};function r(e){var a=s(e);return t(a)}function s(e){var a=i[e];if(a+1)return a;var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}r.keys=function(){return Object.keys(i)},r.resolve=s,(e.exports=r).id=76},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e,i,r){return{storageDictionary:{dialogIdList:"dialogIdList",dialogDict:"dialogDict",dialogsLayout:"dialogsLayout",chatBarLayout:"chatBarLayout",chatFriendsListReloadTime:"chatFriendsListReloadTime"},isStorageDefined:function(e){return void 0!==window.Storage?this.getFromStorage(e):r.isCookieDefined(e)},getFromStorage:function(e){return void 0!==window.Storage?i.getLocalStorage(e):r.retrieveCookie(e)},updateStorage:function(e,a,t){void 0!==window.Storage?i.setLocalStorage(e,a):r.updateCookie(e,a,t)},removeFromStorage:function(e,a){void 0!==window.Storage?i.removeLocalStorage(e):r.destroyCookie(e,a)},updateChatFriendsListReloadTime:function(e){this.updateStorage(this.storageDictionary.chatFriendsListReloadTime,e)}}}r.$inject=["chatUtility","localStorageService","cookieService"],i.a.factory("chatClientStorageUtilityService",r),a.default=r},function(e,a,t){"use strict";t.r(a);var s=t(0),i=(t(1),t(2));function r(e,a){return{initializeFriends:function(e,a,t){t&&(s.sharedFriendsService.isInitialized=!1);var i=e.isUsingCacheToLoadFriendsInfoEnabled,r={isEnabled:!t&&i,expirationMS:e.cachedDataFromLocalStorageExpirationMS};s.sharedFriendsService.register(a,r)}}}r.$inject=["$log","friendsInfoService"],i.a.factory("chatFriendsService",r),a.default=r},function(e,a,t){"use strict";t.r(a);var s=t(0),i=(t(1),t(2));function r(n,l,o,e,i,r,c){return{apiSets:{},setParams:function(){var e=s.EnvironmentUrls.chatApi;this.apiSets.markAsReadApi={url:"".concat(e,"/v2/mark-as-read"),retryable:!1,withCredentials:!0},this.apiSets.markAsSeenApi={url:"".concat(e,"/v2/mark-as-seen"),retryable:!1,withCredentials:!0},this.apiSets.sendMessageApi={url:"".concat(e,"/v2/send-message"),retryable:!1,withCredentials:!0},this.apiSets.conversationsApi={url:"".concat(e,"/v2/get-conversations"),retryable:!0,withCredentials:!0},this.apiSets.userConversationsApi={url:"".concat(e,"/v2/get-user-conversations"),retryable:!0,withCredentials:!0},this.apiSets.getMessagesApi={url:"".concat(e,"/v2/get-messages"),retryable:!0,withCredentials:!0},this.apiSets.multiGetLatestMessagesApi={url:"".concat(e,"/v2/multi-get-latest-messages"),retryable:!0,withCredentials:!0},this.apiSets.getUnreadConversationCountApi={url:"".concat(e,"/v2/get-unread-conversation-count"),retryable:!0,withCredentials:!0},this.apiSets.startOneToOneConversationApi={url:"".concat(e,"/v2/start-one-to-one-conversation"),retryable:!0,withCredentials:!0},this.apiSets.startGroupConversationApi={url:"".concat(e,"/v2/start-group-conversation"),retryable:!1,withCredentials:!0},this.apiSets.addToConversationApi={url:"".concat(e,"/v2/add-to-conversation"),retryable:!0,withCredentials:!0},this.apiSets.removeFromConversationApi={url:"".concat(e,"/v2/remove-from-conversation"),retryable:!0,withCredentials:!0},this.apiSets.renameGroupConversationApi={url:"".concat(e,"/v2/rename-group-conversation"),retryable:!1,withCredentials:!0},this.apiSets.updateUserTypingStatusApi={url:"".concat(e,"/v2/update-user-typing-status"),retryable:!1,withCredentials:!0},this.apiSets.uiPerformanceTrackingApi={url:"".concat(s.EnvironmentUrls.metricsApi,"/v1/performance/send-measurement"),retryable:!1,withCredentials:!0}},getMetaData:function(){return o.httpGet(i.apiSets.getMetaData,{})},getUnreadConversationCount:function(){return o.httpGet(this.apiSets.getUnreadConversationCountApi,null)},getUserConversations:function(e,a,t){var i={pageNumber:e,pageSize:a},r=c.getStorageName(c.chatDataName.getUserConversations,i),s=c.getChatDataFromLocalStorage(r);return s?function(e){var a=n.defer();return a.resolve(e.data),a.promise}(s):o.httpGet(this.apiSets.userConversationsApi,i).then(function(e){return c.saveChatDataToLocalStorage(r,e),e})},getConversations:function(e){var a={conversationIds:e},t={url:s.EnvironmentUrls.chatApi+i.chatUrls.getConversations,withCredentials:!0,retryable:!0};return o.httpGet(t,a).then(function(e){return e.forEach(function(e){r.buildPinGameInConversation(e)}),e})},addToConversation:function(e,a){var t={participantUserIds:e,conversationId:a};return o.httpPost(this.apiSets.addToConversationApi,t)},removeFromConversation:function(e,a){var t={participantUserId:e,conversationId:a};return o.httpPost(this.apiSets.removeFromConversationApi,t)},startOneToOneConversation:function(e){var a={participantUserId:e};return o.httpPost(this.apiSets.startOneToOneConversationApi,a).then(function(e){if(e){var a=e.conversation;return r.buildPinGameInConversation(a),a}})},startGroupConversation:function(e,a){var t={participantUserIds:e,title:a};return o.httpPost(this.apiSets.startGroupConversationApi,t)},getMessages:function(e,a,t){var i={conversationId:e,exclusiveStartMessageId:a,pageSize:t};return o.httpGet(this.apiSets.getMessagesApi,i)},getMessagesByPageSize:function(t,e,i,r,s,n){var o=this;this.getMessages(t.id,e,i).then(function(e){if(e&&0<e.length){var a=2*i;e.forEach(function(e){r.push(e)}),function(e,a){if(!e||!e.chatMessages||e.chatMessages.length<=0)return!1;for(var t=0;t<a.length;t++)if(a[t].id===e.chatMessages[0].id)return!1;return!0}(t,e)&&a<=l.dialogParams.pageSizeOfGetMessages&&e.length===i?o.getMessagesByPageSize(t,e[e.length-1].id,a,r,s,n):s(n)}else e&&0===e.length&&s(n)})},multiGetLatestMessages:function(e,a){var t={conversationIds:e,pageSize:a};return o.httpGet(this.apiSets.multiGetLatestMessagesApi,t)},markAsRead:function(e,a){var t={conversationId:e,endMessageId:a};return o.httpPost(this.apiSets.markAsReadApi,t)},markAsSeen:function(e){var a={conversationsToMarkSeen:e};return o.httpPost(this.apiSets.markAsSeenApi,a)},sendMessage:function(e,a){var t={conversationId:e,message:a};return o.httpPost(this.apiSets.sendMessageApi,t)},renameGroupConversation:function(e,a){var t={conversationId:e,newTitle:a};return o.httpPost(this.apiSets.renameGroupConversationApi,t)},updateUserTypingStatus:function(e,a){var t={conversationId:e,isTyping:a};return o.httpPost(this.apiSets.updateUserTypingStatusApi,t)},sendPerformanceData:function(e,a){var t={featureName:"Chat",measureName:e,value:a};return o.httpPost(this.apiSets.uiPerformanceTrackingApi,t)}}}r.$inject=["$q","chatUtility","httpService","$log","apiParamsInitialization","conversationsUtility","storageService"],i.a.factory("chatService",r),a.default=r},function(e,a,t){"use strict";t.r(a);var f=t(0),i=t(1),b=t.n(i),r=t(2);function s(n,t,d,e,a,i,r,s,o,l,c,g,u,p){function y(e){return b.a.isDefined(f.Linkify)&&"function"==typeof f.Linkify.String?f.Linkify.String(e.escapeHTML()):e}function h(e){return e.replace(/\n/g,"<br>")}function m(e){var a=e.match(u.gameCardRegexs.privateServerLinkCode);if(a&&2==a.length)return{privateServerLinkCode:a[1]}}function v(e,a){return{content:e,isEmoji:a}}return{linksLibrary:b.a.copy(c.linksLibrary),chatLayout:b.a.copy(c.chatLayout),chatApiParams:b.a.copy(g.chatApiParams),dialogParams:b.a.copy(g.dialogParams),dialogLayoutResetConstant:b.a.copy(d.dialogLayoutResetConstant),dialogLayout:b.a.copy(d.dialogLayout),dialogBannerTypes:b.a.copy(d.dialogBannerTypes),userPresenceTypes:b.a.copy(i.userPresenceTypes),dialogType:b.a.copy(d.dialogTypes),newGroup:b.a.copy(d.newGroup),scrollBarType:b.a.copy(d.scrollBarTypes),errorMessages:b.a.copy(c.errors),memberStatus:b.a.copy(d.memberStatus),dialogInitValue:b.a.copy(d.dialogInitValue),dialogStatus:b.a.copy(d.dialogStatus),conversationInitStatus:b.a.copy(d.conversationInitStatus),conversationType:b.a.copy(d.conversationType),participantType:b.a.copy(d.participantType),notificationsName:e,notificationType:a,activeType:b.a.copy(d.activeType),performanceMarkLabels:o.chat,resultType:r,sendMessageErrorCode:s.sendMessageErrorCode,linkCardTypes:b.a.copy(u.linkCardTypes),eventStreamParams:b.a.copy(l.eventStreamParams),urlParamNames:b.a.copy(l.urlParamNames),chatEnabledByPrivacySettingTypes:{disabled:0,enabled:1,unavailable:2},hashOutContent:function(e){return e?e.replace(/\S/g,"#"):e},buildScrollbar:function(e){b.a.element(document.querySelector(e)).mCustomScrollbar({autoExpandScrollbar:!1,scrollInertia:1,contentTouchScroll:1,mouseWheel:{preventDefault:!0}})},updateScrollbar:function(e){b.a.element(document.querySelector(e)).mCustomScrollbar("update")},escapeNewline:h,htmlEntities:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},getAssetDetails:m,buildLinkCard:function(e){var a=y(e),t={content:a,isCard:!1},i=u.messageRegexs;for(var r in i)if(i.hasOwnProperty(r)){var s=i[r],n=e.match(s);n&&2===n.length&&(t={id:n[1],type:r,isCard:!0,content:a,assetDetails:m(e)})}return this.buildEmojiPieces(t),t},buildEmojiPieces:function(e){e.pieces=[];for(var a,t=e.content,i=u.emojiRegex,r=u.zwjRegex,s=u.emojiRepRegex,n="",o=!1,l=0;null!==(a=i.exec(t));){var c=a.index,d=a[0];l!==c?(n&&e.pieces.push(v(n,!0)),e.pieces.push(v(t.slice(l,c),!1)),n=d):null!=d.match(r)?(n+="&zwj;",o=!0):o||null!=d.match(s)?(n+=d,o=!1):(n&&e.pieces.push(v(n,!0)),n=d),l=i.lastIndex}n&&e.pieces.push(v(n,!0)),l<t.length&&e.pieces.push(v(t.slice(l),!1))},buildLinkCardMessages:function(e){var a=e.parsedContent;if(a&&0<a.length){var t=a.split(u.urlRegex);if(!t)return e.hasLinkCard=!1;e.linkCardMessages=[];for(var i=0;i<t.length;i++){var r=t[i],s=null;r.match(u.urlRegex)?s=this.buildLinkCard(r):r&&0<r.length&&!r.match(u.onlyNewLineRegex)&&(s={content:r=y(r=h(r=r.replace(u.removeNewLineRegex,""))),isCard:!1},this.buildEmojiPieces(s)),s&&e.linkCardMessages.push(s)}}return!0},sortFriendList:function(t,e){var a=n("orderBy"),i=[],r=[],s=[];return t.friendIds.forEach(function(e){var a=t.friendsDict[e];0<(a&&a.presence?a.presence.userPresenceType:a.userPresenceType)?i.push(a):r.push(a),s.push(e)}),b.a.forEach(e,function(e){s.indexOf(e.id)<0&&(0<(e&&e.presence?e.presence.userPresenceType:e.userPresenceType)?i.push(e):r.push(e));t.friendIds.indexOf(e.id)<0&&t.friendIds.push(e.id)}),i=a(i,"+name"),r=a(r,"+name"),e=i.concat(r)},getScrollBarSelector:function(e,a){var t=e.layoutId;switch(b.a.isUndefined(a)&&(a=e.scrollBarType),a){case d.scrollBarTypes.FRIENDSELECTION:return"#scrollbar_friend_"+e.dialogType+"_"+t;case d.scrollBarTypes.MESSAGE:default:return"#scrollbar_"+e.dialogType+"_"+t}},hasLinkifyContent:function(e){return b.a.isString(e)&&0<=e.search("<a")&&0<=e.search("href=")&&0<=e.search("text-link")},sanitizeMessage:function(e){if(e&&e.content){var a=e.content,t=e.content=h(e.content);e.content=y(e.content),t!==e.content?(e.parsedContent=a,e.hasLinkCard=!0,e.hasLinkifyMessage=this.hasLinkifyContent(e.content),this.buildLinkCardMessages(e)):this.buildEmojiPieces(e)}},sanitizeMessages:function(e){if(e&&0<e.length)for(var a=0;a<e.length;a++){var t=e[a];this.sanitizeMessage(t)}},getDataForMarkingSeen:function(e){var a=[];return t.document.hasFocus&&t.document.hasFocus()&&b.a.forEach(e,function(e){e.isConversation&&a.push(e.id)}),a},updateConversationTitle:function(e,a){e.title=a,e.name=a},updateDialogStyle:function(e,a,t){var i=a.defaultStyle;i&&i.inputStyle&&this.setResizeInputLayout(t,i.inputStyle.height,e,a)},setResizeInputLayout:function(e,a,t,i){var r,s=e.layout,n=s.topBarHeight,o=function(e,a){return a.maxHeightOfTextInput<e?a.maxHeightOfInput:e}(a,i);s.bannerHeight;r=i.renameEditor.isEnabled?(n+s.renameEditorHeight,n+o+s.renameEditorHeight):n+o;var l=s.dialogHeight-r+"px",c=d.dialogLayoutResetConstant.paddingOfInput/2;i.defaultStyle.dialogStyle={height:l},i.defaultStyle.inputStyle={height:o},i.defaultStyle.inputTextStyle={"padding-top":c}},calculateRightPosition:function(e,a){for(var t=this.chatLayout.widthOfDialog+this.chatLayout.spaceOfDialog,i=this.chatLayout.widthOfCollapsedDialog+this.chatLayout.spaceOfDialog,r=0,s=0;s<a;s++){var n=e.dialogIdList[s];r+=e.dialogsLayout[n].collapsed?i:t}return r},updateDialogsPosition:function(e){for(var a=e.chatLayout,t=a.widthOfChat,i=0;i<e.dialogIdList.length;i++){var r="#"+e.dialogIdList[i],s=b.a.element(document.querySelector(r)).find(this.dialogLayout.dialogContainerClass),n=+t+this.calculateRightPosition(e,i)+a.spaceOfDialog;s.css("right",n)}0<e.minimizedDialogIdList.length&&(e.chatLayout.areDialogsUpdated=!0)},updateFocusedDialog:function(e,a){p.debug(" ------ focused layoutId ------ "+a),e.chatLayout.focusedLayoutId=a},invalidateLinkCardsInMessageDict:function(e,a){e.forEach(function(e){!function(a,e){e[a].linkCardMessages.forEach(function(e){a===e.id&&(e.isCard=!1)})}(e,a)})},invalidatePlaceDetails:function(a,e){e.forEach(function(e){a.placesLibrary[e]||(a.placesLibrary[e]={}),a.placesLibrary[e]={isInvalid:!0}})},isPlaceDetailQualifiedInLibrary:function(e,a){return e[a]&&e[a].reasonProhibited}}}s.$inject=["$filter","$window","dialogAttributes","notificationsName","notificationType","presenceLayout","callBackTypes","httpResponse","performanceMarkLabels","resources","libraryInitialization","apiParamsInitialization","messageHelper","$log"],r.a.factory("chatUtility",s),a.default=s},function(e,a,t){"use strict";t.r(a);var i=t(0),r=t(1),l=t.n(r),s=t(2);function n(e,t,s){function n(e,a){return function(e,a){return a[e]&&l.a.isDefined(a[e].avatarHeadshot)}(e,a)&&function(e,a){return a[e]&&l.a.isDefined(a[e].userPresenceType)}(e,a)}function o(e){if(e.conversationUniverse){var a={rootPlaceId:e.conversationUniverse.rootPlaceId,universeId:e.conversationUniverse.universeId,actorUsername:i.CurrentUser.name,userId:parseInt(i.CurrentUser.userId)};t.setPinGameData(e,a)}return e}return{buildPinGameInConversation:o,getUserIdsNotInFriendsDict:function(e,t){var i=[];if(e&&0<e.length){var a=s.conversationType,r=s.dialogTypes;e.forEach(function(e){e.isGroupChat=e.conversationType===a.multiUserConversation,l.a.forEach(e.participants,function(e){e.userId=e.targetId;var a=e.targetId;i.indexOf(a)<0&&!n(a,t)&&i.push(a),t[a]||(t[a]={id:a,name:e.name})}),e.dialogType||(e.dialogType=e.isGroupChat?r.GROUPCHAT:r.CHAT),o(e)})}return i}}}n.$inject=["$log","pinGameService","dialogAttributes"],s.a.factory("conversationsUtility",n),a.default=n},function(e,a,t){"use strict";t.r(a);var i=t(17),r=t.n(i),s=t(1),n=t.n(s),o=t(2);function l(e){return{isCookieDefined:function(e){return n.a.isDefined(r.a.cookie(e))&&r.a.cookie(e)},updateCookie:function(e,a,t){r.a.cookie(e,JSON.stringify(a),t)},retrieveCookie:function(e){return this.isCookieDefined(e)?JSON.parse(r.a.cookie(e)):[]},destroyCookie:function(e,a){r.a.cookie(e,null,a)}}}l.$inject=["$log"],o.a.factory("cookieService",l),a.default=l},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){var a=e,t={default:-1,member:0,game:1},i={INIT:0,OPEN:1,REPLACE:2,MINIMIZE:3,COLLAPSE:4,REMOVE:5,REFRESH:6},r={maxHeightOfTextInput:64,maxHeightOfInput:80,paddingOfInput:16,typing:{isTypingAsSender:!1,lastTimeTypingAsSender:null,isTypingFromSender:!1,lastTimeReceiveTypingEvent:null,lastTimeReceiveTimer:null,userIds:[],userTypingDict:{}},hoverOnCollapsed:!1,memberDisplay:{limitNumber:3,defaultLimit:3,isAll:!1,linkName:a.get("Label.SeeMore"),seeMoreLink:a.get("Label.SeeMore"),seeLessLink:a.get("Label.SeeLess"),toastText:function(e){return a.get("Message.ToastText",{friendNum:e})},timeoutToast:5e3},playTogetherButton:{buttonType:null,isPlayButtonDisabled:!1},togglePopoverParams:{isOpen:!1,dialogSelector:"",triggerSelector:"",dialogSelectorPrefix:"#dialog-container-",popoverTriggerSelectorPrefix:"#play-together-",pinIconClassName:"pin-icon",dialogTriggerClassSelector:"",dialogTriggerClassPrefix:".chat-friend-",isFirstTimeOpen:!1},layoutId:null,voiceChatLayout:{isLobbyEnabled:!1}},s={FRIEND:-1,CHAT:0,GROUPCHAT:1,NEWGROUPCHAT:2,ADDFRIENDS:6};return{activeType:{NEWMESSAGE:"New message"},conversationInitStatus:{remove:!1},conversationType:{oneToOneConversation:"OneToOneConversation",multiUserConversation:"MultiUserConversation",cloudEditConversation:"CloudEditConversation"},dialogBannerTypes:t,dialogInitValue:{isUpdated:!0,updateStatus:i.INIT,markAsActive:!1,activeType:null,autoOpen:!1},dialogLayout:{lookUpMembers:!1,focusMeEnabled:!0,hasFocus:!1,isFocused:!1,active:!1,isChatLoading:!1,collapsed:!1,isConfirmationOn:!1,isMembersOverloaded:!1,scrollToBottom:!1,IsdialogContainerVisible:!1,inviteBtnDisabled:!0,limitMemberDisplay:6,heightOfInput:32,maxHeightOfTextInput:r.maxHeightOfTextInput,maxHeightOfInput:r.maxHeightOfInput,paddingOfInput:r.paddingOfInput,limitCharacterCount:160,heightOfBanner:40,templateUrl:"chat-dialog",scrollbarElm:null,listenToScrollInitialized:!1,isBannerEnabled:!1,renameEditor:{isEnabled:!1,hasFocus:!1},bannerType:t.default,confirmDialog:{isOpen:!1,title:"",btnName:"",type:""},typing:r.typing,dialogContainerClass:".dialog-container",hoverOnCollapsed:!1,details:{isEnabled:!1,isConversationTitleEditorEnabled:!1,isAddFriendsEnabled:!1,isNegativeConfirmationEnabled:!1,friendMenuAction:{},friendIdForMenuOn:null},memberDisplay:r.memberDisplay,playTogetherButton:r.playTogetherButton,togglePopoverParams:r.togglePopoverParams,voiceChatLayout:r.voiceChatLayout},dialogLayoutResetConstant:r,dialogStatus:i,dialogTypes:s,memberStatus:{PENDING:0,MEMBER:1,LEADER:2},negativeAction:{removeUser:{title:a.get("Heading.RemoveUser"),headerTitle:a.get("Heading.RemoveUser"),btnName:a.get("Action.Remove"),cancelBtnName:a.get("Action.Cancel"),type:"removeUser"},leaveChatGroup:{title:a.get("Heading.ConfirmLeaving"),headerTitle:a.get("Heading.LeaveChatGroup"),btnName:a.get("Action.Leave"),cancelBtnName:a.get("Action.Stay"),type:"leaveChatGroup"}},newGroup:{dialogType:s.NEWGROUPCHAT,layoutId:"newGroup",title:a.get("Heading.NewChatGroup")},participantType:{user:"User"},scrollBarTypes:{MESSAGE:0,FRIENDSELECTION:1},systemMessage:{isSystemMessage:!0,isErrorMsg:!1}}}r.$inject=["languageResource"],i.a.factory("dialogAttributes",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){var s=e;return{playButtonTypes:{play:"play",join:"join",buy:"buy",details:"details",notAvailable:"notAvailable"},playButtons:{play:{type:"play",text:s.get("Label.PlayButton"),className:"btn-primary-xs btn-growth-xs",isPlayable:!0},join:{type:"join",text:s.get("Label.JoinButton"),className:"btn-primary-xs btn-growth-xs",isPlayable:!0},buy:{type:"buy",text:s.get("Label.BuyButton"),className:"btn-control-xs",isPlayable:!1},details:{type:"details",text:s.get("Label.ViewDetailsButton"),className:"btn-control-xs",isPlayable:!1},notAvailable:{type:"notAvailable",text:s.get("Label.GameNotAvailableButton"),isPlayable:!1}},buyAccess:{title:s.get("Heading.BuyItem"),yesButtonText:s.get("Action.BuyAccess"),yesButtonClass:"btn-primary-xs btn-growth-xs",noButtonText:s.get("Action.Cancel"),bodyText:function(e,a,t){var i=function(e){return"<span class='font-bold'>".concat(e,"</span>")}(e),r=function(e){return"<span class='icon-robux-16x16'></span><span class='text-robux'>".concat(e,"</span>")}(t);return s.get("Label.BuyAccessToGameForModal",{placeName:i,creatorName:a,robux:r})}}}}r.$inject=["languageResource"],i.a.factory("gameLayout",r),a.default=r},function(e,a,t){"use strict";t.r(a);var r=t(0),i=t(1),y=t.n(i),s=t(2);function n(o,s,e,i,t,l,n,c,d){var g={};function a(i,r){var e={placeIds:i};return s.httpGet(g.multiGetPlaceDetails,e).then(function(e){if(e&&0<e.length){var a={};e.forEach(function(e){a[e.placeId]=e});var t=[];return i.forEach(function(e){a[e]||(a[e]=null,t.push(e))}),r.forEach(function(e){e&&e.linkCardMessages&&e.linkCardMessages.forEach(function(e){e.isCard&&-1<t.indexOf(e.id)&&(e.isCard=!1)})}),a}})}function u(r,e,s){y.a.forEach(e,function(e,t){if(e){var a;r.placesLibrary[t]&&(a=r.placesLibrary[t]);var i=e.creatorName?e.creatorName:e.builder;if(r.placesLibrary[t]={universeId:e.universeId,placeId:t,rootPlaceId:e.universeRootPlaceId||e.placeId||e.rootPlaceId,placeName:e.name,encodedPlaceName:o.htmlEntities(e.name),creatorName:i,encodedCreatorName:o.htmlEntities(i),creatorId:e.creatorId||e.builderId,gameIconUrl:e.gameIconUrl,placeUrl:e.url||e.placeUrl,reasonProhibited:e.reasonProhibited,description:e.description,price:e.price,isPlayable:e.isPlayable,gameReferralUrl:e.gameReferralUrl},a&&y.a.forEach(a,function(e,a){r.placesLibrary[t][a]||(r.placesLibrary[t][a]=e)}),e.reasonProhibited)switch(e.reasonProhibited){case l.reasonProhibitedMessage.None:case l.reasonProhibitedMessage.Playable:r.placesLibrary[t].buttonLayoutForLinkCard=y.a.copy(n.playButtons.play);break;case l.reasonProhibitedMessage.PurchaseRequired:default:r.placesLibrary[t].buttonLayoutForLinkCard=y.a.copy(n.playButtons.details)}r.universeLibrary[e.universeId]=r.placesLibrary[t]}else!e&&r.placesLibrary[t]&&(r.placesLibrary[t]={isInvalid:!0},s&&o.invalidateLinkCardInPieceOfMessage(t,s))})}function p(a,e){e.forEach(function(e){a.placesLibrary[e]||(a.placesLibrary[e]={}),a.placesLibrary[e]={isInvalid:!0}})}return{apiSets:g,setParams:function(e,a){g.setConversationUniverse={url:e+t.chatUrls.setConversationUniverse,retryable:!1,withCredentials:!0},g.resetConversationUniverse={url:e+t.chatUrls.resetConversationUniverse,retryable:!1,withCredentials:!0},g.multiGetPlaceDetails={url:a+t.gameUrls.multiGetPlaceDetails,retryable:!0,withCredentials:!0},g.GetGamesSorts={url:a+t.gameUrls.GetGamesSorts,retryable:!0,withCredentials:!0},g.GetGamesList={url:a+t.gameUrls.GetGamesList,retryable:!0,withCredentials:!0},g.getGamesByUniverseIds={url:t.gameUrls.getGamesByUniverseIds,retryable:!0,withCredentials:!0},g.multiGetPlayabilityStatus={url:t.gameUrls.multiGetPlayabilityStatus,retryable:!0,withCredentials:!0}},setConversationUniverse:function(e,a){var t={conversationId:e,universeId:a};return s.httpPost(g.setConversationUniverse,t)},resetConversationUniverse:function(e){var a={conversationId:e};return s.httpPost(g.resetConversationUniverse,a)},multiGetPlaceDetailsForLinkCard:a,multiGetPlaceDetails:function(e){var a={placeIds:e};return s.httpGet(g.multiGetPlaceDetails,a).then(function(e){var a={};return y.a.forEach(e,function(e){a[e.placeId]=e}),a})},playRegularGame:function(e,a){a=!0===a,r.GameLauncher.joinMultiplayerGame(e,!0,a)},playTogetherGame:function(e,a){r.GameLauncher.playTogetherGame(e,a)},joinGame:function(e,a){r.GameLauncher.joinGameInstance(e,a,!0,!0)},playPrivateServerGame:function(e,a){r.GameLauncher.joinPrivateGame(e,null,a)},fetchDataForLinkCard:function(e,i){if(!e)return!1;var r=[],s={},n=[];e.forEach(function(t){t.hasLinkCard&&t.linkCardMessages.forEach(function(e){if(e.isCard)switch(e.type){case o.linkCardTypes.gameCard:var a=e.id;o.isPlaceDetailQualifiedInLibrary(i.placesLibrary,a)?i.placesLibrary[a]&&i.placesLibrary[a].isInvalid&&(e.isCard=!1):(n.push(t),r.indexOf(a)<0&&(r.push(a),s[a]=t))}})}),0<r.length&&a(r,n).then(function(e){if(!e)return p(i,r),o.invalidateLinkCardsInMessageDict(r,s),!1;u(i,e,s)},function(){p(i,r),o.invalidateLinkCardsInMessageDict(r,s)})},updateButtonLayoutPerConversation:function(e,a){if(!e.placeButtonLayout||e.placeButtonLayout&&!e.placeButtonLayout[a].isPlayable)return!1;e.pinGame&&e.playTogetherIds&&-1<e.playTogetherIds.indexOf(a)?e.placeButtonLayout[a]=y.a.copy(n.playButtons.join):e.placeButtonLayout[a]=y.a.copy(n.playButtons.play)},buildButtonLayoutPerConversation:function(t,i){var e=[],r=null,s=!0;t.playTogetherIds&&0<t.playTogetherIds.length&&(e=y.a.copy(t.playTogetherIds)),t.pinGame&&(r=t.pinGame.rootPlaceId,e.indexOf(r)<0&&(s=!1,e.push(r))),t.placeButtonLayout||(t.placeButtonLayout={}),y.a.forEach(e,function(e){var a=i[e];if(a)switch(a.reasonProhibited){case l.reasonProhibitedMessage.None:case l.reasonProhibitedMessage.Playable:t.placeButtonLayout[e]=s||e!==r?y.a.copy(n.playButtons.join):y.a.copy(n.playButtons.play);break;case l.reasonProhibitedMessage.PurchaseRequired:t.placeButtonLayout[e]=y.a.copy(n.playButtons.details);break;default:t.placeButtonLayout[e]=y.a.copy(n.playButtons.notAvailable)}})},buildPlacesLibrary:u,getRecentGame:function(){return s.httpGet(g.GetGamesSorts).then(function(e){var a,i;if(e&&e.sorts&&(e.sorts.forEach(function(e){if(e.name===l.sortNames.myRecent)return a=e.token,i=e.name,!1}),a)){var t={sortToken:a,maxRows:l.maxRowsOfMyRecentGames};return s.httpGet(g.GetGamesList,t).then(function(e){if(e&&e.games&&0<e.games.length){var a=e.games,t=[];return y.a.forEach(a,function(e){e.gameReferralUrl=function(e,a){var t=c.getGameDetailReferralUrls().chat;return d("formatString")(t,{sortName:a,placeId:e.placeId})}(e,i),t.push(e.universeId)}),a}})}})},getGames:function(e){var a={universeIds:e},t={};return t.getGamesInfo=s.httpGet(g.getGamesByUniverseIds,a),t.getPlayabilityStatus=s.httpGet(g.multiGetPlayabilityStatus,a),i.all(t).then(function(e){if(e&&e.getGamesInfo&&e.getPlayabilityStatus){var a=e.getGamesInfo.data,r=e.getPlayabilityStatus,s={},n={};return y.a.forEach(a,function(e,a){var t=e.rootPlaceId,i=r[a].universeId;s[t]=e,s[t].universeId=i,s[t].placeId=t,s[t].isPlayable=r[a].isPlayable,s[t].reasonProhibited=r[a].playabilityStatus,s[t].placeUrl=function(e){var a=c.getAbsoluteUrl(l.gameUrl);return d("formatString")(a,{placeId:e.placeId})}(s[t]),n[i]=s[t]}),s}})}}}n.$inject=["chatUtility","httpService","$log","$q","apiParamsInitialization","gameParameters","gameLayout","urlService","$filter"],s.a.factory("gameService",n),a.default=n},function(e,a,t){"use strict";t.r(a);var i=t(1),r=t.n(i),s=t(2);function n(e){return{isGameExistedInPlacesLibrary:function(e,a){var t=null;return r.a.forEach(e,function(e){if(e.universeId===a)return t=e.placeId,!1}),t}}}n.$inject=["$log"],s.a.factory("gameUtility",n),a.default=n},function(e,a,t){"use strict";t.r(a);var r=t(0),i=t(2);function s(e){var a=e,t={scrollbarClassName:"#chat-friend-list",chatContentSelector:"#chat-main",collapsed:!0,pageInitializing:!1,pageDataLoading:!1,chatBarInitialized:!1,isChatLoading:!1,widthOfChatCollapsed:112,widthOfChat:286,widthOfDialog:260,widthOfCollapsedDialog:160,spaceOfDialog:6,widthOfDialogMinimize:200,numberOfDialogOpen:0,defaultChatZIndex:1060,errorMaskEnable:!1,isFriendListEmpty:!1,isUserConversationEmpty:!1,chatLandingEnabled:!1,thresholdMobile:543,thresholdChatBarOpen:1748,resizing:!1,defaultTitleForMessage:a.get("Message.DefaultTitleForMsg"),urlParseInitialized:!1,noConnectionMsg:a.get("Message.NoConnectionMsg"),isChatEnabledByPrivacySetting:1,focusedDialogId:null,areDialogsUpdated:!1,maxOpenDialogs:12,conversationTitleChangedText:a.get("Message.conversationTitleChangedText"),abuseReportUrl:"/abusereport/chat?id={userId}&redirectUrl={location}&conversationId={conversationId}"},i={default:a.get("Message.DefaultErrorMsg"),conversationTitleModerated:a.get("Message.ConversationTitleModerated"),messageContentModerated:a.get("Message.MessageContentModerated"),messageFilterForReceivers:a.get("Message.MessageFilterForReceivers"),textTooLong:a.get("Message.TextTooLong"),unknownMessageType:a.get("Message.UnknownMessageType")};return{chatLayout:t,chatLibrary:{chatLayout:t,chatLayoutIds:[],conversationsDict:{},currentTabTitle:null,dialogIdList:[],dialogDict:{},dialogScopeLib:{},dialogsLayout:{},dialogRequestedToOpenParams:{layoutId:null,autoPop:!1},errors:i,friendIds:[],friendLayoutIds:[],friendsDict:{},isTakeOverOn:angular.element(document.querySelector("#wrap")).data("gutter-ads-enabled"),layout:{bannerHeight:40,playTogetherBannerHeight:102,dialogHeight:360,inputHeight:32,renameEditorHeight:32,searchHeight:32,topBarHeight:32,detailsActionHeight:48,detailsInputHeight:32},layoutIdList:[],minimizedDialogIdList:[],minimizedDialogData:{},userConversationsDict:{},allConversationLayoutIdsDict:{},placesLibrary:{},playTogetherLibrary:{},layoutIdsDictPerUserId:{},gamesPageLink:"".concat(r.EnvironmentUrls.websiteUrl,"/games"),senderTypesForUnknownMessageTypeError:[],isInvalidMessageTypeFallbackEnabled:!1,isMetaDataLoaded:!1,universeLibrary:{},voiceChatInDialog:{},voiceChannelMapToConversation:{}},chatViewModel:{chatDomain:null,friendsDict:{},friendsHasConversation:[],chatUserDict:{}},dialogLocalStorageNamePrefix:"dialogLibrary_",errors:i,linksLibrary:{settingTabName:"Settings",settingLink:"/my/account#!/privacy"}}}s.$inject=["languageResource"],i.a.factory("libraryInitialization",s),a.default=s},function(e,a,t){"use strict";t.r(a);var i=t(1),T=t.n(i),r=t(2);function s(a,c,u,y,p,s,t,h,d,g,m,n,v){var r=3e4;function f(e){e.sent&&!e.parsedTimestamp&&(e.parsedTimestamp=new Date(e.sent).getTime())}function o(e,a,t){var i=e.parsedTimestamp,r=T.a.isDefined(t)?t:new Date,s=new Date(r-864e5),n=new Date(i),o=n.toDateString(),l=Math.round(Math.abs(r.getTime()-n.getTime())/864e5),c=n.getDay(),d=r.getFullYear(),g=n.getFullYear(),u="h:mm a";if(r.toDateString()===o){var p=y("date")(i,u);a?e.briefTimeStamp=p:e.displayTimeStamp=p}else s.toDateString()===o?a?e.briefTimeStamp="Yesterday":e.displayTimeStamp="Yesterday | ".concat(y("date")(i,u)):l<=c?a?(u="EEE",e.briefTimeStamp=y("date")(i,u)):(u="EEE | ".concat(u),e.displayTimeStamp=y("date")(i,u)):d===g?a?(u="MMM d",e.briefTimeStamp=y("date")(i,u)):(u="MMM d | ".concat(u),e.displayTimeStamp=y("date")(i,u)):a?(u="MMM d, yyyy",e.briefTimeStamp=y("date")(i,u)):(u="MMM d, yyyy | "+u,e.displayTimeStamp=y("date")(i,u))}function b(t,e,i){if(e&&0<e.length){for(var a=[],r=e.length-1;0<=r;r--){var s=e[r];s.linkCardMessages=[];var n=h.messageTypes;switch(s.messageType){case n.link.name:s.hasLinkCard=!0;var o=s.link.game.universeId;d.isGameExistedInPlacesLibrary(t.placesLibrary,o)||a.push(o);var l={universeId:o,isLinkCard:!0};s.linkCardMessages.push(l);break;case n.eventBased.name:s.isSystemMessageFromApi=!0,m.setSystemMessage(s);break;case n.plainText.name:c.sanitizeMessage(s)}}t.isRespectingMessageTypeEnabled&&0<a.length&&g.getGames(a).then(function(e){g.buildPlacesLibrary(t,e);var a=t.placesLibrary;g.buildButtonLayoutPerConversation(i,a)})}}var i,l,L=(l=!(i={}),{queueMessageToMarkRead:function(e,a){!(i[e.id]={conversation:e,latestMessageId:a})===l&&(l=!0,t(I,1e3))}});function I(){for(var e in i){var t=i[e];a.markAsRead(e,t.latestMessageId).then(function(e){if(e){var a=t.conversation;a.hasUnreadMessages=!1,a.unreadMessageIds=[],a.unreadMessageTimestamps=[],null!==t.latestMessageId&&a.pendingUnreadMessageId.splice(t.latestMessageId,1),u.$broadcast("Roblox.Chat.LoadUnreadConversationCount")}},function(){p.debug("----- markAsRead request is failed ! ------")})}l=!(i={})}return{setParams:function(e){r=parseInt(e.partyChromeDisplayTimeStampInterval)},setFallbackClusterMaster:function(e,a,t){T.a.isUndefined(e.chatMessages)&&(e.chatMessages=[]);var i=e.chatMessages.length-1;a.displayTimeStamp&&(a.isClusterMaster=!0),0<e.chatMessages.length&&e.chatMessages[i].senderTargetId!==a.senderTargetId&&(e.chatMessages[i].isClusterMaster=!0),e.chatMessages.push(a)},setClusterMaster:function(e,a){T.a.isUndefined(e.chatMessages)&&(e.chatMessages=[]),(0<e.chatMessages.length&&e.chatMessages[0].senderTargetId!==a.senderTargetId||a.displayTimeStamp)&&(a.isClusterMaster=!0),a.resetClusterMessage||e.chatMessages.unshift(a)},buildFallbackTimeStamp:function(e,a,t){if(!e.sent)return!1;f(e);var i=e.parsedTimestamp;(!a.startTimeStamp||i+r<a.startTimeStamp)&&(o(e,!1,t),a.startTimeStamp=i)},buildTimeStamp:function(e,a,t){if(!e.sent)return!1;f(e);var i=e.parsedTimestamp;return a.previousTimeStamp||(a.startTimeStamp=i),(!a.previousTimeStamp||i-r>a.previousTimeStamp)&&(o(e,!1,t),a.previousTimeStamp=i),!0},updateContentForInvalidMessageType:function(a,e){T.a.forEach(e,function(e){m.isMessageTypeInWhiteList(a,e)||(e.content=a.errors.unknownMessageType)})},preProcessMessages:function(e,a,t){this.updateContentForInvalidMessageType(e,t),e.isRespectingMessageTypeEnabled?b(e,t,a):c.sanitizeMessages(t)},processMessages:function(e,a,t,i){this.preProcessMessages(e,a,t),this.manipulateMessages(a,t,i)},manipulateMessages:function(e,a,t){if(a||(e.messagesDict={},e.unreadMessageIds=[],e.unreadMessageTimestamps=[]),T.a.isUndefined(e.messagesDict)&&(e.messagesDict={}),T.a.isUndefined(e.unreadMessageIds)&&(e.unreadMessageIds=[],e.unreadMessageTimestamps=[]),a&&0<a.length){var i=a.length,r=[];e.previousTimeStamp=null;for(var s=i-1;0<=s;s--){var n=a[s];if(this.buildTimeStamp(n,e),e.messagesDict[n.id]||(e.messagesDict[n.id]=n,this.setClusterMaster(e,n),n.read||(e.unreadMessageIds.push(n.id),e.unreadMessageTimestamps.push(n.parsedTimestamp))),d=t,g=r,(c=n).senderType===h.senderTypes.user&&d&&!d[c.senderTargetId]&&g.indexOf(c.senderTargetId)<0){var o=n.senderTargetId;p.debug(" ----- new friend information for this message, trying to get now -----"+o);var l=[o];r.push(o),v.getUserInfo(l,t)}}0<e.unreadMessageIds.length&&u.$broadcast("Roblox.Chat.LoadUnreadConversationCount")}var c,d,g},formatTimestampInConversation:function(e){e.briefTimeStamp||(e.parsedTimestamp=new Date(e.lastUpdated).getTime(),o(e,!0))},appendMessages:function(e,a,t){if(!t)return!1;if(T.a.isUndefined(a.unreadMessageIds)&&(a.unreadMessageIds=[],a.unreadMessageTimestamps=[]),this.updateContentForInvalidMessageType(e,t),e.isRespectingMessageTypeEnabled?b(e,t,a):c.sanitizeMessages(t),a.chatMessages&&0!==a.chatMessages.length){if(a.chatMessages){var i={};for(o=0;o<a.chatMessages.length;o++){var r=a.chatMessages[o];if(!r.isSystemMessage&&!r.sendMessageHasError&&!r.resetClusterMessage){f(i=a.chatMessages[o]);break}}for(o=t.length-1;0<=o;o--){f(l=t[o]);var s=l.id===i.id||i.id&&"string"!=typeof i.id&&i.id.toString()===l.id,n=!T.a.isUndefined(a.messagesDict)&&!T.a.isUndefined(l.id)&&!T.a.isUndefined(a.messagesDict[l.id]);!(T.a.equals({},i)||l.parsedTimestamp>i.parsedTimestamp)||s||n||(this.buildTimeStamp(l,a),this.setClusterMaster(a,l),a.messagesDict[l.id]=l),l.read||(a.hasUnreadMessages=!0,a.unreadMessageIds.push(l.id),a.unreadMessageTimestamps.push(l.parsedTimestamp))}}}else{for(var o=t.length-1;0<=o;o--){var l=t[o];this.buildTimeStamp(l,a),this.setClusterMaster(a,l)}a.chatMessages=t}a.displayMessage=this.getDisplayMessageForUser(t),0<a.unreadMessageIds.length&&u.$broadcast("Roblox.Chat.LoadUnreadConversationCount")},markMessagesAsRead:function(e,a){if(e.chatMessages&&e.unreadMessageIds){var t=e.chatMessages,i=t.length;if(0<e.unreadMessageTimestamps.length&&e.unreadMessageTimestamps[0]>=t[i-1].parsedTimestamp){var r=e.unreadMessageIds.length,s=e.unreadMessageIds[r-1];T.a.isUndefined(e.pendingUnreadMessageId)&&(e.pendingUnreadMessageId=[]),e.pendingUnreadMessageId.indexOf(s)<0&&(e.pendingUnreadMessageId.push(s),L.queueMessageToMarkRead(e,s))}}else e.unreadMessageIds&&0===e.unreadMessageIds.length&&a&&e.hasUnreadMessages&&L.queueMessageToMarkRead(e,null)},buildSystemMessage:function(e,a,t){var i=T.a.copy(n.systemMessage);switch(m.setSystemMessage(i,t),e){case c.notificationType.conversationTitleModerated:i.content=c.errorMessages.conversationTitleModerated;break;case c.notificationType.conversationTitleChanged:var r=c.htmlEntities(a.title);i.content=y("formatString")(c.chatLayout.conversationTitleChangedText,{userName:a.actorUsername,groupName:r});break;case c.notificationType.conversationUniverseChanged:i.content=s.playTogether.pinGameUpdate(a.pinGame.actorUsername,a.pinGame.encodedPlaceName);break;case c.notificationType.presenceOnline:i.content=s.playTogether.playGameUpdate,i.hasParams=!0}T.a.isUndefined(a.chatMessages)&&(a.chatMessages=[]),f(i),this.setClusterMaster(a,i)},resetConversationUnreadStatus:function(e,a){0===a.length&&e.hasUnreadMessages&&L.queueMessageToMarkRead(e,null)},getDisplayMessageForUser:function(e){var a={};if(e)for(var t=e.length,i=0;i<t;i++)if(e[i].senderType===h.senderTypes.user)return a=e[i],a=this.buildDisplayMessage(a);return a},buildDisplayMessage:function(e,a){return f(e),o(e,!0,a),e},refreshTypingStatus:function(e,a,t,i){if(e&&t&&e.conversationType===c.conversationType.multiUserConversation){var r=e.chatMessages;if(r&&0<r.length)for(var s=i.typing.userTypingDict[a],n={},o=0;o<r.length;o++){var l=r[o];if(l.isClusterMaster&&l.senderTargetId===a&&(!n[a]||n[a].messageId!==l.id)){s.messageId=l.id;break}}}},categorizeMessageType:b}}s.$inject=["chatService","chatUtility","$rootScope","$filter","$log","systemMessages","$timeout","messageHelper","gameUtility","gameService","messageUtility","dialogAttributes","usersService"],r.a.factory("messageService",s),a.default=s},function(e,a,t){"use strict";t.r(a);var i=t(1),s=t.n(i),r=t(2);function n(e,i,r){return{isMessageTypeInWhiteList:function(e,a){return-1<e.validMessageTypesWhiteList.indexOf(a.messageType)},isMessageTypeLegal:function(a){var t=!1;return s.a.forEach(i.messageTypes,function(e){if(e.name===a.messageType)return!(t=!0)}),t},isSenderTypeLegal:function(a){var t=!1;return s.a.forEach(i.senderTypes,function(e){if(e===a.senderType)return!(t=!0)}),t},setSystemMessage:function(t,e){t?s.a.forEach(r.systemMessage,function(e,a){t[a]=e}):t=s.a.copy(r.systemMessage),e&&(t.isErrorMsg=!0);var a=new Date;t.sent=a.toISOString()},hasUnreadMessages:function(e,a){return e.hasUnreadMessages||a.some(function(e){return!e.read}),e.hasUnreadMessages}}}n.$inject=["$log","messageHelper","dialogAttributes"],r.a.factory("messageUtility",n),a.default=n},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){var a=e;return{tooltipForPinGame:a.get("Label.PinGameTooltip"),tooltipForUnPinGame:a.get("Label.UnpinGameTooltip"),titleForPinGame:a.get("Label.PinnedGame")}}r.$inject=["languageResource"],i.a.factory("pinGameLayout",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e,i,t,r,s){return{sendPinGameEvent:function(e,a,t){var i={placeId:a,conversationId:t.id};r.sendEventWithTarget(e,s.eventStreamParams.actions.click,i)},setPinGameData:function(e,a){if(a&&a.universeId){var t=a.rootPlaceId;e.pinGame={universeId:a.universeId,rootPlaceId:t,placeName:a.placeName,encodedPlaceName:a.encodedPlaceName,actorUsername:a.actorUsername,userId:a.userId},i.setPlaceForShown(e)}else e.pinGame=null,i.setPlaceForShown(e)},pinGame:function(e,a){e&&a&&t.setConversationUniverse(e.id,a)},unpinGame:function(e){e&&t.resetConversationUniverse(e.id)}}}r.$inject=["$log","playTogetherService","gameService","eventStreamService","resources"],i.a.factory("pinGameService",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){var a=e;return{numberOfMembers:{inPinnedGame:3,inActiveGame:4},gameListScrollListSelector:"#active-game-list",activeGamesList:{maxNumberForFit:4,minNumberForFit:1,limitNumber:1,showMore:function(e){return a.get("Label.ShowMoreGames",{count:e})},showMoreText:"",showLess:a.get("Label.ShowLessGames"),toggleMenuText:"",isCollapsed:!0,pinGameIsInActiveGames:!1},recommendedLabel:a.get("Label.RecommendedGames")}}r.$inject=["languageResource"],i.a.factory("playTogetherLayout",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(0),r=t(1),c=t.n(r),s=t(2);function n(e){return{isPlacePlayersOnlyMe:function(e,a){if(e.playTogetherDict&&e.playTogetherDict[a]){var t=e.playTogetherDict[a].playerIds;if(t&&1===t.length&&t[0]===parseInt(i.CurrentUser.userId))return!0}return!1},setPlaceForShown:function(e){if(e.playTogetherIds&&0<e.playTogetherIds.length){var a=e.playTogetherIds[0];if(!this.isPlacePlayersOnlyMe(e,a)){var t=e.playTogetherDict[a].universeId;e.placeForShown={rootPlaceId:a,universeId:t}}}else if(e.pinGame){var i=e.pinGame,r=i.rootPlaceId,s=i.universeId;e.placeForShown={rootPlaceId:r,universeId:s}}else e.placeForShown=null},sortPlayTogetherIds:function(r,e){if(!r||!e||!e.rootPlaceId)return!1;var s=parseInt(e.rootPlaceId),a=parseInt(e.placeId),t=e.gameId,n=parseInt(e.userId),i=parseInt(e.universeId),o=e.lastOnline;if(o=o&&new Date(o).getTime(),!r.playTogetherIds){r.playTogetherIds=[s],r.playTogetherDict={};return!(r.playTogetherDict[s]={playerIds:[n],gameInstanceId:t,lastSeen:o,placeId:a,universeId:i})}if(r.playTogetherDict[s]?r.playTogetherDict[s].placeId!==a&&(r.playTogetherDict[s].placeId=a):r.playTogetherDict[s]={playerIds:[n],gameInstanceId:t,lastSeen:o,placeId:a,universeId:i},r.playTogetherDict[s].playerIds.indexOf(n)<0&&r.playTogetherDict[s].playerIds.push(n),r.playTogetherDict[s]){var l=r.playTogetherDict[s].playerIds.length;c.a.forEach(r.playTogetherIds,function(e,a){var t=r.playTogetherDict[e].playerIds;if(-1<t.indexOf(n)&&s!==e){var i=t.indexOf(n);r.playTogetherDict[e].playerIds.splice(i,1)}if(r.playTogetherDict[e].playerIds.length<l)return r.playTogetherIds.splice(a,0,s),!1}),r.playTogetherIds.indexOf(s)<0&&r.playTogetherIds.push(s)}r.playTogetherDict[s].lastSeen<o&&(r.playTogetherDict[s].gameInstanceId=t,r.playTogetherDict[s].lastSeen=o),r.recentPlaceIdFromPresence=e.rootPlaceId,r.recentUserIdFromPresence=e.userId}}}n.$inject=["$log"],s.a.factory("playTogetherService",n),a.default=n},function(e,a,t){"use strict";t.r(a);var i=t(2);function r(e){var a=e;return{userPresenceTypes:[{className:"",title:a.get("Label.Offline")},{className:"online",title:a.get("Label.Online")},{className:"game",title:a.get("Label.InGame")},{className:"studio",title:a.get("Label.InStudio")}],status:{offline:0,online:1,inGame:2,inStudio:3}}}r.$inject=["languageResource"],i.a.factory("presenceLayout",r),a.default=r},function(e,a,t){"use strict";t.r(a);var i=t(1),s=t.n(i),r=t(2);function n(i,e,t){var r=!1,a=1e4;return{chatDataName:{getUserConversations:"getUserConversations",getConversations:"getConversations",getMessages:"getMessages"},setStorageParams:function(e){r=e.IsChatDataFromLocalStorageEnabled,a=1e3*e.ChatDataFromLocalStorageExpirationSeconds},getStorageName:function(e,a){var t=i.chatDataLSNamePrefix+"."+e;return s.a.forEach(a,function(e){t=t+"."+e}),t},saveChatDataToLocalStorage:function(e,a){r&&t.saveDataByTimeStamp(e,a)},getChatDataFromLocalStorage:function(e){return r&&t.fetchNonExpiredCachedData(e,a),null},clearLocalStorage:function(){var e=t.storage();if(e)for(var a in e)a&&-1<a.search(i.chatDataLSNamePrefix)&&t.removeLocalStorage(a)}}}n.$inject=["resources","$log","localStorageService"],r.a.factory("storageService",n),a.default=n},function(e,a,t){"use strict";t.r(a);t(1);var i=t(2);function r(e){var t=e;return{playTogether:{pinGameUpdate:function(e,a){return t.get("Message.PinGameUpdate",{userName:e,gameName:a})},playGameUpdate:t.get("Message.PlayGameUpdate")}}}r.$inject=["languageResource"],i.a.factory("systemMessages",r),a.default=r},function(e,a,t){"use strict";t.r(a);var n=t(0),i=t(1),o=t.n(i),r=t(2);function s(i,r,s){return{getAvatarHeadshots:function(e,t){var a=r.apiSets.multiGetAvatarHeadshots;return s.buildBatchPromises(a,e,50,"userIds").then(function(e){if(e&&0<e.length){var a=[];return o.a.forEach(e,function(e){a=a.concat(e.data)}),o.a.forEach(a,function(e){var a=e.targetId;t[a]||(t[a]={}),t[a].avatarHeadshot=e}),a}return null})},getUserPresence:function(e,i){var a=r.apiSets.multiGetPresence;return s.buildBatchPromises(a,e,100,"userIds","POST").then(function(e){if(e&&0<e.length){var t=[];return o.a.forEach(e,function(e){var a=e.userPresences;t=t.concat(a)}),t.forEach(function(e){var a=e.userId;i[a]||(i[a]={}),i[a].presence=e,n.Endpoints&&(i[a].profileUrl=n.Endpoints.generateAbsoluteUrl("/users/{id}/profile",{id:a},!0))}),t}return null})},getUserInfo:function(e,a){var t={avatarHeadshots:this.getAvatarHeadshots(e,a),presences:this.getUserPresence(e,a)};return i.all(t).then(function(e){return e})}}}s.$inject=["$q","apiParamsInitialization","httpService"],r.a.factory("usersService",s),a.default=s},function(e,a,t){var i={"./directives/templates/addFriends.html":99,"./directives/templates/chatAbuseReport.html":100,"./directives/templates/chatAvatarHeadshot.html":101,"./directives/templates/chatBar.html":102,"./directives/templates/chatBase.html":103,"./directives/templates/chatDialog.html":104,"./directives/templates/chatGameIcon.html":105,"./directives/templates/chatGroupDialog.html":106,"./directives/templates/chatPlaceholder.html":107,"./directives/templates/confirmNegativeAction.html":108,"./directives/templates/conversationTitle.html":109,"./directives/templates/conversationTitleEditor.html":110,"./directives/templates/createChatGroup.html":111,"./directives/templates/details.html":112,"./directives/templates/dialogHeader.html":113,"./directives/templates/dialogMinimize.html":114,"./directives/templates/displayMessage.html":115,"./directives/templates/gamesList.html":116,"./directives/templates/linkCard.html":117,"./directives/templates/selectFriends.html":118,"./directives/templates/systemMessage.html":119,"./directives/templates/userConversationInfo.html":120};function r(e){var a=s(e);return t(a)}function s(e){var a=i[e];if(a+1)return a;var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}r.keys=function(){return Object.keys(i)},r.resolve=s,(e.exports=r).id=98},function(e,a){e.exports='<div class="details-container add-friends-container" ng-class="{\'collapsed\': dialogLayout.collapsed}" ng-show="dialogLayout.details.isAddFriendsEnabled" ng-controller="friendsController"> <div class="chat-windows-header" ng-mouseenter="updateDialogHeader(true)" ng-mouseleave="updateDialogHeader(false)" ng-class="{\'hover\': dialogLayout.hoverOnCollapsed}"> <div class="chat-header-back" ng-click="toggleAddFriends()"> <span class="icon-chat-back"></span> </div> <div class="chat-header-label chat-header-create-group" ng-click="toggleDialogContainer()"> <span class="font-bold font-caption-header" ng-bind="\'Label.AddFriends\' | translate"></span> </div> <div class="chat-header-action"> <span class="icon-chat-close-white" ng-click="closeDialog({layoutId: dialogData.layoutId})"></span> </div> </div> <div select-friends></div> <div class="details-btns-fixed select-friends-btns"> <button id="select-friends-cancel" ng-click="toggleAddFriends()" ng-bind="\'Action.Cancel\' | translate" class="btn-fixed-width btn-control-sm details-btn-cancel select-friends-cancel"></button> <button id="select-friends-save" class="btn-fixed-width btn-secondary-sm btn-cta-sm details-btn-save select-friends-save" ng-bind="\'Action.Add\' | translate" ng-disabled="dialogLayout.inviteBtnDisabled" ng-click="sendInvite(); toggleAddFriends()"></button> </div> </div>'},function(e,a){e.exports='<div class="details-confirmation-container" ng-show="dialogLayout.isConfirmationOn"> <div class="dialog-report-content"> <div class="chat-windows-header"> <div class="chat-header-back" ng-click="dialogLayout.isConfirmationOn = false"> <span class="icon-chat-back"></span> </div> <div class="chat-header-label details-dialog-title" ng-click="toggleDialogContainer()"> <span ng-bind="\'Action.Report\'|translate" class="font-caption-header">Report</span> </div> <div class="chat-header-action"> <span class="icon-chat-close-white" ng-click="closeDialog({layoutId: dialogData.layoutId})"></span> </div> </div> <div class="details-negative-confirmation-body"> <span ng-bind="\'Heading.ContinueToReport\'|translate" class="small text details-negative-confirmation-text">Continue to report?</span> <div class="details-btns-fixed select-friends-btns"> <button class="btn-control-sm details-btn-cancel" ng-bind="\'Action.Cancel\'|translate" ng-click="dialogLayout.isConfirmationOn = false"></button> <button id="chat-abuse-report-btn" class="btn-alert-sm details-btn-save" ng-bind="\'Action.Report\'|translate" ng-click="abuseReport(null, true)"></button> </div> </div> </div> </div>'},function(e,a){e.exports='<thumbnail-2d thumbnail-target-id="userId" thumbnail-type="layoutLibrary.thumbnailTypes.avatarHeadshot" thumbnail-options="{size: layoutLibrary.avatarHeadshotSize.size48}" class="{{className}}" title="{{layoutLibrary.thumbnailTypes.avatarHeadshot}}"> </thumbnail-2d>'},function(e,a){e.exports='<div id="chat-main" class="chat-main" ng-controller="chatBarController" ng-class="{\'chat-main-empty\': isChatEmpty() }" ng-cloak> <div id="chat-header" class="chat-windows-header chat-header"> <div class="chat-header-label" ng-click="toggleChatContainer()"> <span class="font-caption-header chat-header-title" ng-bind="\'Heading.Chat\' | translate"></span> </div> <div class="chat-header-action"> <span class="xsmall notification-red notification" ng-show="chatLibrary.chatLayout.collapsed && chatViewModel.unreadConversationCount > 0" ng-cloak>{{chatViewModel.unreadConversationCount}}</span> <span> <span id="chat-group-create" class="icon-chat-group-create" ng-hide="chatLibrary.chatLayout.collapsed || chatLibrary.chatLayout.errorMaskEnable || chatLibrary.chatLayout.chatLandingEnabled || chatLibrary.chatLayout.pageDataLoading || chatLibrary.chatLayout.isChatDisabledByPrivacySetting" ng-click="launchDialog(newGroup.layoutId)" uib-tooltip="{{\'Label.SpanTitle.CreateGroupNeeds2More\' | translate}}" tooltip-placement="bottom-right" ng-cloak></span> </span> </div> </div> <div id="chat-body" class="chat-body" ng-show="!chatLibrary.chatLayout.errorMaskEnable && !chatLibrary.chatLayout.pageDataLoading && !chatLibrary.chatLayout.pageInitializing" ng-if="!(chatLibrary.chatLayout.chatLandingEnabled || chatLibrary.chatLayout.isChatEnabledByPrivacySetting !== chatLibrary.chatLayout.chatEnabledByPrivacySettingTypes.enabled)"> <div class="border-bottom chat-search" ng-class="{\'chat-search-focus\': chatLibrary.chatLayout.searchFocus}"> <span> <input type="text" placeholder="{{\'Label.InputPlaceHolder.SearchForFriends\' | translate }}" class="input-field chat-search-input font-caption-body" ng-model="chatViewModel.searchTerm" ng-focus="chatLibrary.chatLayout.searchFocus = true"/> </span> <span class="icon-chat-search"></span> <span class="icon-chat-search-cancel" ng-click="cancelSearch()"></span> </div> <div id="chat-friend-list" class="rbx-scrollbar chat-friend-list" lazy-load> <ul id="chat-friends" class="chat-friends"> <li ng-repeat="chatUser in chatUserDict | orderList: chatLibrary.chatLayoutIds | filter : search" class="chat-friend chat-friend-{{chatUser.id}}"> <div ng-if="chatUser.dialogType === dialogType.CHAT && chatUser.isConversation" class="chat-friend-container" ng-click="launchDialog(chatUser.layoutId)"> <div class="avatar avatar-headshot-sm card-plain chat-friend-avatar" ng-click="launchDialog(chatUser.layoutId)"> <span class="chat-avatar-headshort" class-name="avatar-card-image chat-avatar" chat-avatar-headshot user-id="{{chatUser.displayUserId}}" layout-library="chatLibrary.layoutLibrary"> </span> <div class="avatar-status chat-friend-status" ng-class="userPresenceTypes[chatLibrary.friendsDict[chatUser.displayUserId].presence.userPresenceType][\'className\']"> </div> </div> <div user-conversation-info></div> </div> <div ng-if="chatUser.dialogType === dialogType.GROUPCHAT && chatUser.isConversation" class="chat-friend-container chat-friend-groups" ng-click="launchDialog(chatUser.layoutId)"> <div class="chat-friend-avatar" ng-click="launchDialog(chatUser.layoutId)"> <ul class="avatar-group card-plain chat-avatar-groups" ng-class="{\'avatar-double\': chatUser.userIds.length === 2,\'avatar-triple\' : chatUser.userIds.length === 3,\'avatar-all\' : chatUser.userIds.length>= 4}"> <li ng-repeat="userId in chatUser.userIds | limitTo : 4" class="avatar-item chat-avatar"> <span class="chat-avatar-headshort" class-name="avatar-card-image" chat-avatar-headshot user-id="{{userId}}" layout-library="chatLibrary.layoutLibrary"> </span> </li> </ul> </div> <div user-conversation-info></div> </div> <div ng-if="!chatUser.isConversation" class="chat-friend-container" ng-click="launchDialog(chatUser.layoutId)"> <div class="avatar avatar-headshot-sm card-plain chat-friend-avatar"> <span class="chat-avatar-headshort" class-name="avatar-card-image chat-avatar" chat-avatar-headshot user-id="{{chatUser.id}}" layout-library="chatLibrary.layoutLibrary"> </span> <div class="avatar-status chat-friend-status" ng-class="userPresenceTypes[chatLibrary.friendsDict[chatUser.id].presence.userPresenceType][\'className\']"> </div> </div> <div user-conversation-info></div> </div> </li> </ul> <div class="chat-loading loading-bottom" ng-show="chatLibrary.chatLayout.isChatLoading"> <span class="spinner spinner-sm" title="{{\'Label.SpanTitle.Loading\' | translate}}"></span> </div> </div> </div> <div id="chat-disconnect" class="chat-disconnect" ng-show="isChatDisconnected()" ng-cloak> <p class="text-info" ng-show="chatLibrary.chatLayout.errorMaskEnable">{{chatLibrary.chatLayout.noConnectionMsg}} </p> <span><span class="spinner spinner-default" title="{{\'Label.SpanTitle.Loading\' | translate}}"></span></span> </div> <div id="chat-empty-list" class="chat-disconnect" ng-hide="chatLibrary.chatLayout.errorMaskEnable" ng-if="isChatEmpty()"> <span class="icon-chat-friends"></span> <p ng-show="chatLibrary.chatLayout.isChatEnabledByPrivacySetting === chatLibrary.chatLayout.chatEnabledByPrivacySettingTypes.enabled" class="text-info small font-caption-body text-default" ng-bind="\'Message.MakeFriendsToChatNPlay\' | translate"></p> <a id="find-game" ng-bind="\'Label.PlayGames\' | translate" class="btn-primary-sm btn-cta-sm" ng-show="chatLibrary.chatLayout.isChatEnabledByPrivacySetting === chatLibrary.chatLayout.chatEnabledByPrivacySettingTypes.enabled" ng-href="{{chatLibrary.gamesPageLink}}"></a> <p ng-show="chatLibrary.chatLayout.isChatEnabledByPrivacySetting === chatLibrary.chatLayout.chatEnabledByPrivacySettingTypes.disabled" class="text-info small" ng-click="openSettingsPage()"> <span ng-bind-html="\'Message.ChatPrivacySetting\' | translate:{frontLink: \'<span class=text-link>\', endLink: \'</span>\'}"></span> </p> <p ng-show="chatLibrary.chatLayout.isChatEnabledByPrivacySetting === chatLibrary.chatLayout.chatEnabledByPrivacySettingTypes.unavailable" class="text-info small">{{chatLibrary.chatLayout.languageForPrivacySettingUnavailable}}</p> <span class="icon-logo-tagline logo-tagline-chat"></span> </div> </div>'},function(e,a){e.exports='<div ng-controller="chatController" ng-class="{\'collapsed\': chatLibrary.chatLayout.collapsed, \'future-enabled\': chatLibrary.isFutureChatEligible}" ng-cloak> <div chat-bar></div> <div id="dialogs" class="dialogs" ng-controller="dialogsController" ng-hide="chatLibrary.chatLayout.isChatEnabledByPrivacySetting !== chatLibrary.chatLayout.chatEnabledByPrivacySettingTypes.enabled"> <div dialog id="{{chatLayoutId}}" dialog-data="chatUserDict[chatLayoutId]" chat-library="chatLibrary" close-dialog="closeDialog(chatLayoutId)" send-invite="sendInvite(chatLayoutId)" ng-repeat="chatLayoutId in chatLibrary.layoutIdList"></div> <div dialog id="{{newGroup.layoutId}}" dialog-data="newGroup" chat-library="chatLibrary" close-dialog="closeDialog(\'newGroup\')" send-invite="sendInvite(newGroup.layoutId)" ng-if="newGroup"></div> <div id="dialogs-minimize" class="dialogs-minimize" dialog-minimize chat-library="chatLibrary"> </div> <div class="chat-placeholder" chat-placeholder> </div> </div> </div>'},function(e,a){e.exports='<div id="dialog-container-{{dialogData.id}}" class="dialog-container" ng-class="{\'collapsed\': dialogLayout.collapsed,\'active\': dialogLayout.active && dialogData.layoutId !== chatLibrary.chatLayout.focusedLayoutId,\'focused\': !dialogLayout.collapsed && dialogData.layoutId === chatLibrary.chatLayout.focusedLayoutId}" ng-controller="dialogController"> <div class="dialog-main" ng-hide="isDialogMainContainerHidden()"> <div class="chat-windows-header dialog-header" ng-mouseenter="updateDialogHeader(true)" ng-mouseleave="updateDialogHeader(false)" ng-class="{\'hover\': dialogLayout.hoverOnCollapsed}"> <div class="chat-header-label" ng-click="toggleDialogContainer()"> <span class="font-caption-header text-overflow chat-header-title dialog-header-title"> {{dialogData.name}} </span> </div> <div dialog-header></div> </div> <div id="scrollbar_{{dialogData.dialogType}}_{{dialogData.layoutId}}" class="rbx-scrollbar dialog-body" ng-style="dialogLayout.defaultStyle.dialogStyle" focus-model="toggleDialogFocusStatus(true)" dialog-lazy-load> <ul class="dialog-messages" ng-controller="dialogMessagesController"> <li class="dialog-message-container" ng-repeat="message in dialogData.chatMessages | reverse" ng-class="{\'message-inbound\': message.senderTargetId != chatLibrary.userId && !message.isSystemMessage,\'system-message\': message.isSystemMessage,\'message-cluster-master\': message.isClusterMaster}" ng-if="canRenderMessage(message) || shouldShowInvalidMessageTypePrompt(message)" on-finish-render="ngRepeatFinished"> <div class="indicated-message" ng-hide="!message.displayTimeStamp"> <span class="font-footer text-muted indicated-message-bubble">{{message.displayTimeStamp}}</span> </div> <a ng-href="{{chatLibrary.friendsDict[message.senderTargetId].profileUrl}}" ng-hide="message.isSystemMessage" class="avatar avatar-headshot-sm dialog-message-avatar-link"> <span ng-if="message.senderTargetId != chatLibrary.userId" class="chat-avatar-headshort" class-name="avatar-card-image dialog-message-avatar" chat-avatar-headshot user-id="{{message.senderTargetId}}" layout-library="chatLibrary.layoutLibrary"></span> </a> <div class="dialog-message-body"> <div class="dialog-message dialog-message-content dialog-triangle" ng-class="{\'message-is-sending\': message.sendingMessage}" ng-hide="message.isSystemMessage" ng-if="!message.hasLinkCard && canRenderMessage(message)"> <span class="message-piece font-caption-body text-emphasis" ng-repeat="piece in message.pieces" ng-bind-html="piece.content"></span> <span ng-show="message.canResend" ng-click="resendMessage(message)" class="icon-chat-resend"></span> </div> <div ng-if="message.hasLinkCard" link-card></div> <div class="xsmall text-date-hint dialog-sending" ng-show="message.filteredForReceivers" ng-bind="chatLibrary.errors.messageFilterForReceivers"></div> <div class="xsmall text-error dialog-sending" ng-show="message.sendMessageHasError" ng-bind="message.error || (\'Message.Error\' | translate)"></div> </div> <div class="indicated-message" system-message></div> </li> <li class="dialog-message-container message-inbound typing-indicator" ng-show="dialogLayout.typing.isTypingFromSender"> <a ng-href="{{chatLibrary.friendsDict[dialogLayout.typing.userIds[0]].profileUrl}}" class="avatar avatar-headshot-sm dialog-message-avatar-link"> <span class="chat-avatar-headshort" class-name="avatar-card-image dialog-message-avatar" chat-avatar-headshot user-id="{{dialogLayout.typing.userIds[0]}}" layout-library="chatLibrary.layoutLibrary"></span> </a> <div class="small dialog-message dialog-triangle"> <span class="typing"></span> </div> </li> </ul> </div> <div class="chat-loading loading-top" ng-show="dialogLayout.isChatLoading"> <span class="spinner spinner-sm" title="{{\'Label.SpanTitle.Loading\' | translate}} ..."></span> </div> <div class="border-top dialog-input-container" ng-class="{\'disabled\': chatLibrary.chatLayout.errorMaskEnable}" ng-style="dialogLayout.defaultStyle.inputStyle"> <textarea id="dialog-input" msd-elastic dialog-input rows="1" focus-me="{{dialogLayout.focusMeEnabled && dialogData.layoutId === chatLibrary.chatLayout.focusedLayoutId}}" placeholder="{{\'Label.InputPlaceHolder.SendMessage\' | translate}}" ng-model="dialogData.messageForSend" enter-escape-shift="keyPressEnter($event)" ng-keypress="typing($event, true)" ng-blur="typing($event, false)" class="dialog-input" input-max-length="{{dialogLayout.limitCharacterCount}}" ng-disabled="chatLibrary.chatLayout.errorMaskEnable" ng-style="dialogLayout.defaultStyle.inputTextStyle" hinteractive hinteractive-domain="chat"></textarea> </div> </div> <div abuse-report></div> <div details></div> <div places></div> </div>'},function(e,a){e.exports='<thumbnail-2d class="{{className}}" thumbnail-target-id="universeId" thumbnail-type="layoutLibrary.thumbnailTypes.gameIcon"> </thumbnail-2d>'},function(e,a){e.exports='<div id="dialog-container-{{dialogData.id}}" class="dialog-container group-dialog" ng-class="{\'group-has-banner\': dialogLayout.renameEditor.isEnabled,\'collapsed\': dialogLayout.collapsed,\'active\': dialogLayout.active && dialogData.layoutId !== chatLibrary.chatLayout.focusedLayoutId,\'focused\': !dialogLayout.collapsed && dialogData.layoutId === chatLibrary.chatLayout.focusedLayoutId}" ng-controller="dialogController"> <div class="dialog-main" ng-hide="dialogLayout.isConfirmationOn || isDialogMainContainerHidden()"> <div class="chat-windows-header dialog-header" ng-mouseenter="updateDialogHeader(true)" ng-mouseleave="updateDialogHeader(false)" ng-class="{\'hover\': dialogLayout.hoverOnCollapsed}"> <div class="chat-header-label" ng-click="toggleDialogContainer()"> <span id="group-chat-title" class="font-caption-header text-overflow dialog-header-title max-width" title="{{dialogData.title}}">{{dialogData.title}}</span> </div> <div dialog-header></div> </div> <div id="scrollbar_{{dialogData.dialogType}}_{{dialogData.layoutId}}" ng-style="dialogLayout.defaultStyle.dialogStyle" class="rbx-scrollbar dialog-body" dialog-lazy-load focus-model="toggleDialogFocusStatus(true)"> <ul class="dialog-messages" ng-controller="dialogMessagesController"> <li class="dialog-message-container" ng-repeat="message in dialogData.chatMessages | reverse" ng-class="{\'message-inbound\': message.senderTargetId != chatLibrary.userId && !message.isSystemMessage,\'system-message\': message.isSystemMessage,\'message-cluster-master\': message.isClusterMaster}" ng-if="canRenderMessage(message) || shouldShowInvalidMessageTypePrompt(message)" on-finish-render="ngRepeatFinished"> <div class="indicated-message" ng-hide="!message.displayTimeStamp"> <span class="font-footer text-muted indicated-message-bubble"> {{message.displayTimeStamp}} </span> </div> <a ng-href="{{chatLibrary.friendsDict[message.senderTargetId].profileUrl}}" ng-hide="message.isSystemMessage" class="avatar avatar-headshot-sm dialog-message-avatar-link"> <span ng-if="message.senderTargetId != chatLibrary.userId" class="chat-avatar-headshort" class-name="avatar-card-image dialog-message-avatar" chat-avatar-headshot user-id="{{message.senderTargetId}}" layout-library="chatLibrary.layoutLibrary"> </span> </a> <div class="dialog-message-body" ng-if="canRenderMessage(message)"> <div ng-if="chatLibrary.friendsDict[message.senderTargetId]" ng-show="message.isClusterMaster && message.senderTargetId != chatLibrary.userId" class="xxsmall dialog-message-author"> <span class="font-footer text-muted" ng-bind="chatLibrary.friendsDict[message.senderTargetId].name"></span> <span class="font-footer text-muted text-overflow" alias="chatLibrary.friendsDict[message.senderTargetId].contact"></span> <span class="typing" ng-show="message.id == dialogLayout.typing.userTypingDict[message.senderTargetId].messageId"></span> </div> <div class="dialog-message dialog-triangle" ng-class="{\'message-is-sending\': message.sendingMessage}" ng-hide="message.isSystemMessage" ng-if="!message.hasLinkCard"> <span class="dialog-message-content"> <span class="message-piece" ng-repeat="piece in message.pieces" ng-bind-html="piece.content"></span> </span> <span ng-show="message.canResend" ng-click="resendMessage(message)" class="icon-chat-resend"></span> </div> <div ng-if="message.hasLinkCard" link-card></div> <div class="xsmall text-date-hint dialog-sending" ng-show="message.filteredForReceivers" ng-bind="chatLibrary.errors.messageFilterForReceivers"></div> <div class="text-error dialog-sending" ng-show="message.sendMessageHasError" ng-bind="message.error || (\'Message.Error\'|translate)"></div> </div> <div class="indicated-message" system-message></div> </li> </ul> </div> <div class="chat-loading loading-top" ng-show="dialogLayout.isChatLoading"> <span class="spinner spinner-sm" title="{{\'Label.SpanTitle.Loading\'|translate}}"></span> </div> <div class="border-top dialog-input-container" ng-class="{\'disabled\': chatLibrary.chatLayout.errorMaskEnable}" ng-style="dialogLayout.defaultStyle.inputStyle"> <textarea msd-elastic focus-me="{{dialogLayout.focusMeEnabled && dialogData.layoutId === chatLibrary.chatLayout.focusedLayoutId}}" placeholder="{{\'Label.InputPlaceHolder.SendMessage\'|translate}}" ng-model="dialogData.messageForSend" enter-escape-shift="keyPressEnter($event)" ng-keypress="typing($event, true)" ng-blur="typing($event, false)" class="dialog-input" rows="1" input-max-length="{{dialogLayout.limitCharacterCount}}" ng-disabled="chatLibrary.chatLayout.errorMaskEnable" ng-style="dialogLayout.defaultStyle.inputTextStyle" hinteractive hinteractive-domain="chat"></textarea> </div> </div> <div abuse-report></div> <div confirm-negative-action chat-library="chatLibrary" dialog-layout="dialogLayout" confirm-callback="confirmCallBack()"></div> <div details></div> </div>'},function(e,a){e.exports='<div class="chat-placeholder-container" ng-show="chatLibrary.chatPlaceholderEnabled"> <div class="chat-placeholder-header"></div> <span class="icon-chat-placeholder"></span> </div>'},function(e,a){e.exports='<div class="confirm-negative-action details-confirmation-container" ng-show="dialogLayout.confirmDialog.isOpen"> <div class="confirm-negative-action-container"> <div class="chat-windows-header"> <div class="chat-header-back" ng-click="dialogLayout.confirmDialog.isOpen = false"> <span class="icon-chat-back"></span> </div> <div class="chat-header-label details-dialog-title" ng-click="toggleDialogContainer()"> <span class="font-caption-header">{{dialogLayout.confirmDialog.headerTitle}}</span> </div> <div class="chat-header-action"> <span class="icon-chat-close-white" ng-click="closeDialog({layoutId: dialogData.layoutId})" data-toggle="tooltip" title="{{\'Label.Close\'|translate}}"></span> </div> </div> <div class="details-negative-confirmation-body"> <span class="small text details-negative-confirmation-text">{{dialogLayout.confirmDialog.title}}</span> <div class="details-btns-fixed select-friends-btns"> <button class="btn-control-sm details-btn-cancel" ng-click="dialogLayout.confirmDialog.isOpen = false"> {{dialogLayout.confirmDialog.cancelBtnName}} </button> <button id="negative-action-confirm-btn" class="btn-alert-sm details-btn-save" ng-click="confirmCallback()"> {{dialogLayout.confirmDialog.btnName}} </button> </div> </div> </div> </div>'},function(e,a){e.exports='<div class="details-header-container conversation-title-container"> <div class="details-label conversation-title-icon"> <span class="icon-chat-group-name" ng-show="dialogData.dialogType === dialogType.NEWGROUPCHAT"></span> <ul class="avatar-group card-plain chat-avatar-groups" ng-show="dialogData.dialogType != dialogType.NEWGROUPCHAT" ng-class="{\'avatar-double\': dialogData.userIds.length === 2,\'avatar-triple\' : dialogData.userIds.length === 3,\'avatar-all\' : dialogData.userIds.length >= 4}"> <li ng-repeat="userId in dialogData.userIds | limitTo : 4" class="avatar-item chat-avatar"> <span class="chat-avatar-headshort" class-name="avatar-card-image" chat-avatar-headshot user-id="{{userId}}" layout-library="chatLibrary.layoutLibrary"> </span> </li> </ul> </div> <div class="border-bottom small details-input-container" ng-show="dialogData.dialogType == dialogType.NEWGROUPCHAT"> <input type="text" focus-me="{{dialogLayout.focusMeEnabled}}" class="small details-input conversation-title-input" placeholder="{{\'Label.NameYourChatGroup\'|translate}}" ng-model="dialogData.name" maxlength="{{chatLibrary.maxConversationTitleLengthInput}}"> </div> <div class="details-title conversation-title-content" ng-click="toggleConversationEditor()" ng-show="dialogData.dialogType != dialogType.NEWGROUPCHAT"> <span class="small text conversation-title-label text-overflow" ng-bind="dialogData.title"></span> <span class="icon-chat-arrow-right"></span> </div> </div>'},function(e,a){e.exports='<div class="details-container conversation-title-editor-container" ng-show="dialogLayout.details.isConversationTitleEditorEnabled"> <div class="chat-windows-header" ng-mouseenter="updateDialogHeader(true)" ng-mouseleave="updateDialogHeader(false)" ng-class="{\'hover\': dialogLayout.hoverOnCollapsed}"> <div class="chat-header-back" ng-click="toggleConversationEditor()"> <span class="icon-chat-back"></span> </div> <div class="chat-header-label details-dialog-title" ng-click="toggleDialogContainer()"> <span class="font-caption-header" ng-bind="\'Label.ChatGroupName\' | translate"></span> </div> <div class="chat-header-action"> <span class="icon-chat-close-white" ng-click="closeDialog({layoutId: dialogData.layoutId})"></span> </div> </div> <div class="details-container conversation-title-editor-body"> <div ng-bind="\'Label.ChangeChatGroupName\' | translate" class="font-caption-body text conversation-title-editor-title"> </div> <div class="conversation-title-editor-content"> <textarea auto-resize rows="1" maxlength="{{chatLibrary.maxConversationTitleLengthInput}}" focus-me="{{dialogLayout.focusMeEnabled}}" class="font-caption-body input-field details-input conversation-title-editor-textarea" key-press-enter="renameTitle()" ng-model="dialogData.name">\r\n            </textarea> <span class="font-footer text-subheader conversation-title-editor-count">{{dialogData.name.length}}/{{chatLibrary.maxConversationTitleLengthInput}}</span> </div> <div class="details-btns-fixed select-friends-btns"> <button id="select-friends-cancel" ng-bind="\'Action.Cancel\'|translate" ng-click="toggleConversationEditor()" class="btn-fixed-width btn-control-sm details-btn-cancel"></button> <button id="select-friends-save" ng-bind="\'Action.Save\'|translate" class="btn-fixed-width btn-secondary-sm details-btn-save" ng-click="renameTitle()"></button> </div> </div> </div>'},function(e,a){e.exports='<div class="dialog-container create-chat-container" ng-class="{\'collapsed\': dialogLayout.collapsed}" ng-controller="friendsController"> <div class="chat-windows-header"> <div class="chat-header-label chat-header-create-group" ng-click="toggleDialogContainer()"> <span class="font-caption-header">{{dialogLayout.title}}</span> </div> <div class="chat-header-action"> <span class="icon-chat-close-white" ng-click="closeDialog({layoutId: dialogData.layoutId})"></span> </div> </div> <div conversation-title></div> <div select-friends></div> <div class="details-btns-fixed select-friends-btns"> <button id="select-friends-cancel" ng-bind="\'Action.Cancel\'|translate" ng-click="closeDialog({layoutId: dialogData.layoutId})" class="btn-fixed-width btn-control-sm details-btn-cancel select-friends-cancel"> </button> <button id="select-friends-save" ng-bind="\'Action.Create\'|translate" class="btn-fixed-width btn-secondary-sm btn-cta-sm details-btn-save select-friends-save" ng-disabled="dialogLayout.inviteBtnDisabled" ng-click="sendInvite()"> </button> </div> </div>'},function(e,a){e.exports='<div class="details-dialog-container" ng-show="dialogLayout.details.isEnabled" ng-controller="detailsController"> <div class="details-dialog" ng-class="{\'collapsed\': dialogLayout.collapsed}" ng-hide="dialogLayout.details.isAddFriendsEnabled || dialogLayout.details.isConversationTitleEditorEnabled"> <div class="chat-windows-header" ng-mouseenter="updateDialogHeader(true)" ng-mouseleave="updateDialogHeader(false)" ng-class="{\'hover\': dialogLayout.hoverOnCollapsed}"> <div class="chat-header-back" ng-click="toggleDetails()"> <span class="icon-chat-back"></span> </div> <div class="chat-header-label details-dialog-title" ng-click="toggleDialogContainer()"> <span ng-bind="\'Label.ChatDetails\'| translate" class="font-caption-header"></span> </div> <div class="chat-header-action"> <span class="icon-chat-close-white" ng-click="closeDialog({layoutId: dialogData.layoutId})"></span> </div> </div> <div id="scrollbar_details_{{dialogData.layoutId}}" class="rbx-scrollbar details-container details-scrollbar" details-scrollbar> <div class="xsmall border-bottom text-secondary details-general-label" ng-if="dialogData.isGroupChat" ng-bind="\'Label.General\'|translate"> </div> <div conversation-title ng-if="dialogData.isGroupChat"></div> <div class="xsmall border-top border-bottom text-secondary details-members-label font-footer text-muted" ng-bind="\'Label.Members\' | translate"></div> <div class="details-members-container"> <div class="add-friends-option"> <div class="add-friends-icon" ng-click="toggleAddFriends()"> <div class="add-friends-cirle-container"> <span class="icon-chat-add-friends"></span> </div> </div> <div class="small border-bottom text-sec add-friends-label" ng-bind="\'Label.AddFriends\' | translate" ng-click="toggleAddFriends()"> </div> </div> <div id="group-members" class="participant-list"> <ul class="friends-list-container participant-list-container"> <li ng-repeat="userId in dialogData.userIds | limitTo: dialogLayout.memberDisplay.limitNumber" class="friend-item" id="member-list-{{userId}}"> <div class="friend-container"> <a ng-href="{{chatLibrary.friendsDict[userId].profileUrl}}" class="avatar avatar-headshot-sm friend-avatar"> <span class="chat-avatar-headshort" class-name="avatar-card-image avatar" chat-avatar-headshot user-id="{{userId}}" layout-library="chatLibrary.layoutLibrary"> </span> <div class="avatar-status avatar-status" ng-class="userPresenceTypes[chatLibrary.friendsDict[userId].presence.userPresenceType][\'className\']"> </div> </a> <div class="border-bottom friend-info-action"> <div class="friend-info"> <div class="friend-username dynamic-overflow-container no-wrap"> <div class="small text-overflow text-sec friend-name dynamic-ellipsis-item"> {{chatLibrary.friendsDict[userId].name}}</div> <div class="small text-overflow text-sec friend-alias dynamic-ellipsis-item" alias="chatLibrary.friendsDict[userId].contact"></div> </div> <div class="xsmall text-overflow friend-status"> {{userPresenceTypes[chatLibrary.friendsDict[userId].presence.userPresenceType].title}} </div> </div> <div class="friend-action" ng-show="userId !== chatLibrary.userId"> <div class="friend-action-more-option more-options-{{dialogData.layoutId}}" click-outside="toggleFriendsMenu(userId, true)" ng-click="toggleFriendsMenu(userId)"> <span class="icon-chat-more-options"></span> </div> <div class="friend-menu" ng-class="{\'three-items\': canConversationRemoveMember() }" ng-show="dialogLayout.details.friendIdForMenuOn == userId && dialogLayout.details.friendMenuAction[userId]"> <ul class="dropdown-menu" role="menu" ng-show="dialogLayout.details.friendIdForMenuOn == userId && dialogLayout.details.friendMenuAction[userId]"> <li> <a id="add-friends-{{userId}}" ng-href="{{chatLibrary.friendsDict[userId].profileUrl}}" ng-click="toggleFriendsMenu(userId)" ng-bind="\'Label.ViewProfile\' | translate" class="font-caption-header"></a> </li> <li> <a id="abuse-report-{{userId}}" ng-click="abuseReport(userId, false); toggleFriendsMenu(userId)" class="font-caption-header" ng-bind="\'Action.Report\' | translate"></a> </li> <li ng-if="canConversationRemoveMember()"> <a id="remove-member-{{userId}}" ng-click="removeMember(userId, false); toggleFriendsMenu(userId)" class="font-caption-header" ng-bind="\'Action.Remove\' | translate"></a> </li> </ul> </div> </div> </div> </div> </li> <li class="participant-list-action" ng-show="dialogData.userIds.length > dialogLayout.memberDisplay.defaultLimit"> <a class="small text-link" ng-click="toggleMemberList()">{{dialogLayout.memberDisplay.linkName}}</a> </li> </ul> </div> </div> <div class="details-btns"> <button id="leave-group" ng-click="leaveGroupChat(false)" class="btn-full-width btn-alert-sm select-friends-cancel" ng-if="dialogData.dialogType !== dialogType.CHAT && dialogData.isGroupChat" ng-bind="\'Label.LeaveChatGroup\' | translate"></button> </div> </div> </div> <div add-friends></div> <div conversation-title-editor></div> </div>'},function(e,a){e.exports='<div class="chat-header-action" ng-controller="dialogHeaderController"> <span class="icon-chat-close-white" ng-click="closeDialog({layoutId: dialogData.layoutId})"></span> <span class="icon-chat-info-white" id="dialog-info" uib-tooltip="{{\'Label.ChatDetails\'| translate}}" tooltip-placement="bottom" ng-click="toggleDetails()" ng-hide="dialogLayout.collapsed || chatLibrary.chatLayout.errorMaskEnable"></span> <span class="dialog-future-chat" ng-show="chatLibrary.isFutureChatEligible" future-chat-icon></span> <span id="play-together-{{dialogData.id}}" class="cursor-pointer dialog-header-active-game" ng-if="isPinOrActiveGameAvailable()" ng-hide="dialogLayout.collapsed || chatLibrary.chatLayout.errorMaskEnable" ng-click="openGameList()" popover-trigger=" \'none\' " popover-class="game-list-in-dialog" popover-placement="bottom-right" popover-append-to-body="false" popover-is-open="dialogLayout.togglePopoverParams.isOpen" uib-popover-template="\'{{gamesListTemplateUrl}}\'" toggle-popover> <span chat-game-icon class-name="dialog-header-active-game-image" ng-if="dialogData.placeForShown.universeId" universe-id="{{dialogData.placeForShown.universeId}}" layout-library="chatLibrary.layoutLibrary"></span> </span> <span id="play-together-{{dialogData.id}}" class="cursor-pointer dialog-header-active-game" ng-if="!isPinOrActiveGameAvailable() && isMyRecentGameAvailable()" ng-hide="dialogLayout.collapsed || chatLibrary.chatLayout.errorMaskEnable" ng-click="openGameList()" popover-trigger=" \'none\' " popover-class="game-list-in-dialog" popover-placement="bottom-right" popover-append-to-body="false" popover-is-open="dialogLayout.togglePopoverParams.isOpen" uib-popover-template="\'{{gamesListTemplateUrl}}\'" toggle-popover> <span chat-game-icon class-name="dialog-header-active-game-image" ng-if="chatLibrary.placesLibrary[chatLibrary.myRecentPlaceId].universeId" universe-id="{{chatLibrary.placesLibrary[chatLibrary.myRecentPlaceId].universeId}}" layout-library="chatLibrary.layoutLibrary"></span> </span> </div>'},function(e,a){e.exports='<div id="dialogs-minimize-container" class="dialogs-minimize-container" ng-show="hasMinimizedDialogs" data-toggle="popover" data-bind="dialogs"> <span class="icon-chat-more-dialogs"></span> <span class="font-header-2 minimize-count">{{chatLibrary.minimizedDialogIdList.length}}</span> <div class="rbx-popover-content" data-toggle="dialogs"> <ul class="dropdown-menu minimize-list" role="menu"> <li ng-repeat="dialogLayoutId in chatLibrary.minimizedDialogIdList" class="minimize-item" id="{{dialogLayoutId}}" minimize-item> <a class="text-overflow minimize-title"> <span> {{chatLibrary.minimizedDialogData[dialogLayoutId].name}} </span> </a> <span class="icon-chat-close-black minimize-close"></span> </li> </ul> </div> </div>'},function(e,a){e.exports='<div> <span ng-show="chatUser.displayMessage.messageType === messageHelper.messageTypes.link.name" ng-bind="chatLibrary.universeLibrary[chatUser.displayMessage.link.game.universeId].placeUrl"> </span> <span ng-show="chatUser.displayMessage.messageType === messageHelper.messageTypes.plainText.name && !chatUser.displayMessage.hasLinkifyMessage" title="{{chatUser.displayMessage.messageType}}" ng-bind-html="chatUser.displayMessage.content"></span> <span ng-show="chatUser.displayMessage.messageType === messageHelper.messageTypes.plainText.name && chatUser.displayMessage.hasLinkifyMessage" title="{{chatUser.displayMessage.messageType}}" ng-bind="chatUser.displayMessage.parsedContent"></span> </div>'},function(e,a){e.exports='<div ng-controller="playTogetherController"> <div class="game-item-container pinned-game-container" ng-class="{\'has-active-game\': hasPinGameAndActiveGames()}" ng-show="playTogether.pinGame && playTogether.pinGame.rootPlaceId"> <a ng-href="{{chatLibrary.placesLibrary[playTogether.pinGame.rootPlaceId].placeUrl}}" class="text-title game-link"> <span chat-game-icon class-name="game-icon" layout-library="chatLibrary.layoutLibrary" ng-if="chatLibrary.placesLibrary[playTogether.pinGame.rootPlaceId].universeId" universe-id="{{chatLibrary.placesLibrary[playTogether.pinGame.rootPlaceId].universeId}}" title="{{chatLibrary.placesLibrary[playTogether.pinGame.rootPlaceId].placeName}}"></span> </a> <div class="game-details pinned-game-details"> <div class="pinned-game-header"> <span class="pin-icon icon-chat-unpin" ng-click="unPinGame()" uib-tooltip="{{pinGameLayout.tooltipForUnPinGame}}" tooltip-placement="bottom-right"></span> </div> <div class="text-overflow small text-title game-name"> <a ng-href="{{chatLibrary.placesLibrary[playTogether.pinGame.rootPlaceId].placeUrl}}" class="text-title game-link"> {{chatLibrary.placesLibrary[playTogether.pinGame.rootPlaceId].placeName}} </a> </div> <div class="game-info pinned-game-info"> <ul class="game-players"> <li ng-repeat="userId in playTogether.playTogetherDict[playTogether.pinGame.rootPlaceId].playerIds | limitTo: playTogetherLayout.numberOfMembers.inPinnedGame" class="avatar avatar-headshot-sm card-plain game-player" title="{{chatLibrary.friendsDict[userId].name}}"> <span uib-tooltip="{{chatLibrary.friendsDict[userId].name}}" tooltip-placement="bottom" tooltip-append-to-body="true" class="avatar-card-image game-player-avatar" class="chat-avatar-headshort" chat-avatar-headshot user-id="{{userId}}" layout-library="chatLibrary.layoutLibrary"> </span> <div class="avatar-status game-player-presence" ng-class="userPresenceTypes[chatLibrary.friendsDict[userId].presence.userPresenceType][\'className\']"> </div> </li> <li ng-show="playTogether.playTogetherDict[playTogether.pinGame.rootPlaceId].playerIds.length > playTogetherLayout.numberOfMembers.inPinnedGame" class="font-caption-body text-secondary game-player-plus" ng-cloak> +{{playTogether.playTogetherDict[playTogether.pinGame.rootPlaceId].playerIds.length - playTogetherLayout.numberOfMembers.inPinnedGame}} </li> </ul> <button type="button" class="{{playTogether.placeButtonLayout[playTogether.pinGame.rootPlaceId].className}} game-btn" ng-class="{\'invisible\' : !playTogether.placeButtonLayout[playTogether.pinGame.rootPlaceId]}" ng-click="joinGameFromPlayTogether(playTogether.pinGame.rootPlaceId)" ng-if="playTogether.placeButtonLayout[playTogether.pinGame.rootPlaceId].type != gameLayout.playButtonTypes.notAvailable"> {{playTogether.placeButtonLayout[playTogether.pinGame.rootPlaceId].text}} </button> <span class="xsmall text-label game-non-available" ng-if="playTogether.placeButtonLayout[playTogether.pinGame.rootPlaceId].type == gameLayout.playButtonTypes.notAvailable"> {{playTogether.placeButtonLayout[playTogether.pinGame.rootPlaceId].text}} </span> </div> </div> </div> <div class="game-list-container" ng-class="{\'has-pin-game-above\': hasPinGameAndActiveGames(),\'overflow\': (playTogetherLayout.activeGamesList.limitNumber >= playTogetherLayout.activeGamesList.maxNumberForFit)}" ng-show="hasActiveGames()"> <ul id="active-game-list" ng-class="{\'rbx-scrollbar\': playTogether.inDialog}" class="active-game-list"> <li ng-repeat="placeId in playTogether.playTogetherIds | limitTo: playTogetherLayout.activeGamesList.limitNumber" ng-if="placeId != playTogether.pinGame.rootPlaceId" repeat-done class="game-item-container active-game-container"> <a ng-href="{{chatLibrary.placesLibrary[placeId].placeUrl}}" class="text-title game-link"> <div chat-game-icon class="chat-game-icon" class-name="game-icon" layout-library="chatLibrary.layoutLibrary" ng-if="chatLibrary.placesLibrary[placeId].universeId" universe-id="{{chatLibrary.placesLibrary[placeId].universeId}}" title="{{chatLibrary.placesLibrary[placeId].placeName}}"></div> </a> <div class="border-bottom game-details active-game-details"> <div class="game-title-container"> <div class="text-overflow small text-title game-name"> <a ng-href="{{chatLibrary.placesLibrary[placeId].placeUrl}}"> {{chatLibrary.placesLibrary[placeId].placeName}} </a> </div> <span class="pin-icon active-game-pin-icon icon-chat-pin" ng-click="pinGame(chatLibrary.placesLibrary[placeId].universeId, chatLibrary.placesLibrary[placeId].rootPlaceId)" uib-tooltip="Pin Game" tooltip-placement="bottom-right"></span> </div> <div class="game-info active-game-info"> <ul class="game-players"> <li ng-repeat="userId in playTogether.playTogetherDict[placeId].playerIds | limitTo: playTogetherLayout.numberOfMembers.inActiveGame" class="avatar avatar-headshot-sm card-plain game-player" title="{{chatLibrary.friendsDict[userId].name}}"> <div uib-tooltip="{{chatLibrary.friendsDict[userId].name}}" tooltip-placement="bottom" tooltip-append-to-body="true" class="chat-avatar-headshort" class-name="avatar-card-image game-player-avatar" chat-avatar-headshot user-id="{{userId}}" layout-library="chatLibrary.layoutLibrary"> </div> <div class="avatar-status game-player-presence" ng-class="userPresenceTypes[chatLibrary.friendsDict[userId].presence.userPresenceType][\'className\']"> </div> </li> <li ng-show="playTogether.playTogetherDict[placeId].playerIds.length > playTogetherLayout.numberOfMembers.inActiveGame" class="font-caption-body text-secondary game-player-plus" ng-cloak> +{{playTogether.playTogetherDict[placeId].playerIds.length - playTogetherLayout.numberOfMembers.inActiveGame}} </li> </ul> <button type="button" class="{{playTogether.placeButtonLayout[placeId].className}} game-btn" ng-class="{\'invisible\' : !playTogether.placeButtonLayout[placeId]}" ng-if="playTogether.placeButtonLayout[placeId].type != gameLayout.playButtonTypes.notAvailable" ng-click="joinGameFromPlayTogether(placeId)"> {{playTogether.placeButtonLayout[placeId].text}} </button> <span class="xsmall text-label game-non-available" ng-if="playTogether.placeButtonLayout[placeId].type == gameLayout.playButtonTypes.notAvailable"> {{playTogether.placeButtonLayout[placeId].text}} </span> </div> </div> </li> </ul> <div class="cursor-pointer border-top is-exclusive-click active-game-toggle-menu" ng-click="toggleActiveGameList()" ng-if="playTogetherLayout.numberOfActiveGames > 1" ng-class="{\'collapsed\': playTogetherLayout.activeGamesList.isCollapsed}"> <span class="xsmall text is-exclusive-click toggle-menu-text">{{playTogetherLayout.activeGamesList.toggleMenuText}}</span> </div> </div> <div class="game-list-container" ng-show="isMyRecentAvaliable()"> <div class="game-item-container recommended-game-container"> <a ng-href="{{chatLibrary.placesLibrary[chatLibrary.myRecentPlaceId].gameReferralUrl}}" class="text-title game-link"> <span chat-game-icon class-name="game-icon" layout-library="chatLibrary.layoutLibrary" ng-if="chatLibrary.placesLibrary[chatLibrary.myRecentPlaceId].universeId" universe-id="{{chatLibrary.placesLibrary[chatLibrary.myRecentPlaceId].universeId}}" title="{{chatLibrary.placesLibrary[chatLibrary.myRecentPlaceId].placeName}}"></span> </a> <div class="game-details recommended-game-details"> <div class="game-title-container"> <a class="text-overflow small text-title game-name" ng-href="{{chatLibrary.placesLibrary[chatLibrary.myRecentPlaceId].gameReferralUrl}}"> {{chatLibrary.placesLibrary[chatLibrary.myRecentPlaceId].placeName}} </a> <span class="small text-label font-caption-body">{{playTogetherLayout.recommendedLabel}}</span> </div> <div class="game-info recommended-game-info"> <button type="button" class="{{chatLibrary.placesLibrary[chatLibrary.myRecentPlaceId].buttonLayoutForMe.className}} game-btn" ng-class="{\'invisible\' : !chatLibrary.placesLibrary[chatLibrary.myRecentPlaceId].buttonLayoutForMe}" ng-click="playGame(chatLibrary.myRecentPlaceId)"> {{chatLibrary.placesLibrary[chatLibrary.myRecentPlaceId].buttonLayoutForMe.text}} </button> </div> </div> </div> </div> </div>'},function(e,a){e.exports='<div id="link-card" ng-controller="linkCardMessagesController"> <div class="link-card-msg-wrap" ng-repeat="pieceOfMessage in linkCardMessages" ng-controller="linkCardController" ng-init="sendLoadLinkCardEvent(pieceOfMessage.id)"> <div class="dialog-message dialog-message-content dialog-triangle" ng-class="{\'message-is-sending\': message.sendingMessage}" ng-hide="pieceOfMessage.isLinkCard" ng-if="!pieceOfMessage.isCard || (pieceOfMessage.isCard && chatLibrary.placesLibrary[pieceOfMessage.id].isInvalid)"> <span class="message-piece font-caption-body text-emphasis" ng-repeat="piece in pieceOfMessage.pieces" ng-bind-html="piece.content"></span> </div> <div class="cursor-pointer border dialog-triangle link-card-container" ng-if="isLinkCardAvailableAndParsedByClientSide(pieceOfMessage) && (chatLibrary.placesLibrary[pieceOfMessage.id] || !chatLibrary.placesLibrary[pieceOfMessage.id].isInvalid)"> <div class="link-card-top-container"> <div class="small font-caption-header text-title text-overflow link-card-title" title="{{chatLibrary.placesLibrary[pieceOfMessage.id].placeName}}" ng-bind="chatLibrary.placesLibrary[pieceOfMessage.id].placeName" ng-click="goToPlaceDetails(pieceOfMessage.id, chatLibrary.eventStreamParams.clickLinkCardInChat)"> </div> <span class="link-card-pin-icon icon-chat-pin" ng-class="{\'on\': pieceOfMessage.id == dialogData.pinGame.rootPlaceId}" ng-click="pinGame(chatLibrary.placesLibrary[pieceOfMessage.id].universeId, pieceOfMessage.id)" uib-tooltip="{{pinGameLayout.tooltipForPinGame}}" tooltip-placement="bottom-right"></span> </div> <div class="link-card-details" ng-click="goToPlaceDetails(pieceOfMessage.id, chatLibrary.eventStreamParams.clickLinkCardInChat)"> <span chat-game-icon class="chat-game-icon link-card-thumb" layout-library="chatLibrary.layoutLibrary" universe-id="{{chatLibrary.placesLibrary[pieceOfMessage.id].universeId}}" ng-if="chatLibrary.placesLibrary[pieceOfMessage.id].universeId"></span> <p class="xsmall text-secondary link-card-description" ng-bind="chatLibrary.placesLibrary[pieceOfMessage.id].description"></p> </div> <button class="{{chatLibrary.placesLibrary[pieceOfMessage.id].buttonLayoutForLinkCard.className}} btn-full-width link-card-btn" ng-class="{\'invisible\' : !chatLibrary.placesLibrary[pieceOfMessage.id].buttonLayoutForLinkCard}" ng-click="play(pieceOfMessage.id, chatLibrary.eventStreamParams.clickPlayFromLinkCardInChat, pieceOfMessage.assetDetails)" ng-disabled="dialogLayout.playTogetherButton.isPlayButtonDisabled"> {{chatLibrary.placesLibrary[pieceOfMessage.id].buttonLayoutForLinkCard.text}} </button> </div> <div class="cursor-pointer border dialog-triangle link-card-container" ng-if="pieceOfMessage.isLinkCard && chatLibrary.universeLibrary[pieceOfMessage.universeId]"> <div class="link-card-top-container"> <div class="small font-caption-header text-title text-overflow link-card-title" title="{{chatLibrary.universeLibrary[pieceOfMessage.universeId].placeName}}" ng-bind="chatLibrary.universeLibrary[pieceOfMessage.universeId].placeName" ng-click="goToPlaceDetails(chatLibrary.universeLibrary[pieceOfMessage.universeId].placeId, chatLibrary.eventStreamParams.clickLinkCardInChat)"> </div> <span class="link-card-pin-icon icon-chat-pin" ng-class="{\'on\': chatLibrary.universeLibrary[pieceOfMessage.universeId].placeId == dialogData.pinGame.rootPlaceId}" ng-click="pinGame(pieceOfMessage.universeId, chatLibrary.universeLibrary[pieceOfMessage.universeId].placeId)" uib-tooltip="{{pinGameLayout.tooltipForPinGame}}" tooltip-placement="bottom-right"></span> </div> <div class="link-card-details" ng-click="goToPlaceDetails(chatLibrary.universeLibrary[pieceOfMessage.universeId].placeId, chatLibrary.eventStreamParams.clickLinkCardInChat)"> <span chat-game-icon class="chat-game-icon link-card-thumb" ng-if="pieceOfMessage.universeId" layout-library="chatLibrary.layoutLibrary" universe-id="{{pieceOfMessage.universeId}}"></span> <p class="xsmall text-secondary link-card-description" ng-bind="chatLibrary.universeLibrary[pieceOfMessage.universeId].description"></p> </div> <button class="{{chatLibrary.universeLibrary[pieceOfMessage.universeId].buttonLayoutForLinkCard.className}} btn-full-width link-card-btn" ng-class="{\'invisible\' : !chatLibrary.universeLibrary[pieceOfMessage.universeId].buttonLayoutForLinkCard}" ng-click="play(chatLibrary.universeLibrary[pieceOfMessage.universeId].placeId, chatLibrary.eventStreamParams.clickPlayFromLinkCardInChat)" ng-disabled="dialogLayout.playTogetherButton.isPlayButtonDisabled"> {{chatLibrary.universeLibrary[pieceOfMessage.universeId].buttonLayoutForLinkCard.text}} </button> </div> </div> </div>'},function(e,a){e.exports='<div class="select-friends-container"> <div class="border-bottom details-header-container select-friends-header"> <div class="details-label select-friends-label"> <span class="icon-chat-group-label"></span> </div> <div class="small details-input-container select-friends-search" ng-class="{\'group-select-container\' : dialogData.selectedUserIds.length > 0}" select-friends-resize> <ul class="friends-selected-list" ng-show="dialogData.selectedUserIds.length > 0"> <li class="friends-selected-item friends-selected-placeholder invisible"> </li> <li class="avatar avatar-headshot-sm card-plain friends-selected-item" ng-repeat="userId in dialogData.selectedUserIds" ng-click="selectFriends(userId)" ng-hide="dialogData.selectedUsersDict[userId].hiddenFromSelection" title="{{dialogData.selectedUsersDict[userId].name}}"> <span class="chat-avatar-headshort" class-name="avatar-card-image avatar" chat-avatar-headshot user-id="{{userId}}" layout-library="chatLibrary.layoutLibrary"> </span> <div class="friends-selected-mask"> <span class="icon-chat-close-white"></span> </div> </li> </ul> <input type="text" placeholder="{{\'Label.InputPlaceHolder.SearchForFriends\'|translate}}" class="small details-input select-friends-input" ng-model="dialogData.searchTerm"/> <span class="xsmall text-secondary select-friends-count" ng-if="dialogData.dialogType === dialogType.GROUPCHAT"> ({{(dialogData.selectedUserIds.length)}}/{{chatLibrary.quotaOfGroupChatMembers - dialogData.userIds.length + 1}}) </span> <span class="xsmall text-secondary select-friends-count" ng-if="dialogData.dialogType === dialogType.NEWGROUPCHAT || dialogData.dialogType === dialogType.CHAT"> ({{(dialogData.selectedUserIds.length)}}/{{chatLibrary.quotaOfGroupChatMembers - dialogData.userIds.length}}) </span> </div> </div> <div> <div id="scrollbar_friend_{{dialogData.dialogType}}_{{dialogData.layoutId}}" class="rbx-scrollbar select-friends-list" friends-lazy-load> <ul class="friends-list-container"> <li ng-repeat="friend in chatLibrary.friendsDict | orderList: dialogData.friendIds  | filter: search" class="friend-item" id="friend-{{friend.id}}"> <div class="friend-container chat-friend-select"> <div class="avatar avatar-headshot-sm card-plain friend-avatar" ng-click="toggleFriendSelection(friend.id)"> <span class="chat-avatar-headshort" class-name="avatar-card-image avatar" chat-avatar-headshot user-id="{{friend.id}}" layout-library="chatLibrary.layoutLibrary"> </span> <div class="avatar-status avatar-status" ng-class="userPresenceTypes[friend.presence.userPresenceType][\'className\']"></div> </div> <div class="border-bottom friend-info-action" ng-click="toggleFriendSelection(friend.id)"> <div class="text-overflow friend-info"> <div class="dynamic-overflow-container no-wrap"> <div class="small text-overflow text-sec friend-name dynamic-ellipsis-item"> {{friend.name}}</div> <div class="small text-overflow text-sec friend-alias dynamic-ellipsis-item" alias="friend.contact"></div> </div> <div class="xsmall text-overflow text-secondary friend-status"> {{userPresenceTypes[friend.presence.userPresenceType].title}}</div> </div> <div class="checkbox friend-action"> <input id="checkbox-select-{{dialogData.layoutId}}-{{friend.id}}" type="checkbox" ng-click="toggleFriendSelection(friend.id, $event)" ng-checked="dialogData.selectedUsersDict[friend.id]"> <label for="checkbox-select-{{dialogData.layoutId}}-{{friend.id}}"> </label> </div> </div> </div> </li> </ul> </div> <div toast toast-layout="toastLayout"></div> </div> </div>'},function(e,a){e.exports='<div> <span class="indicated-message-bubble system-message-content" ng-show="message.isSystemMessageFromApi"> <div class="font-footer text-muted" ng-if="message.eventBased.type === messageHelper.messageTypes.eventBased.setConversationUniverse" ng-bind="\'Message.PinGameUpdate\' | translate:{userName: chatLibrary.friendsDict[message.eventBased.setConversationUniverse.actorUserId].name, \r\n                                                                    gameName: chatLibrary.universeLibrary[message.eventBased.setConversationUniverse.universeId].placeName}"> </div> </span> <div ng-hide="message.isSystemMessageFromApi"> <span class="font-footer text-muted indicated-message-bubble system-message-content" ng-show="message.isSystemMessage && !message.hasParams" ng-bind-html="message.content"></span> <span class="font-footer text-muted indicated-message-bubble system-message-content" ng-show="message.isSystemMessage && message.hasParams">{{chatLibrary.friendsDict[dialogData.recentUserIdFromPresence].name}}{{message.content}}{{chatLibrary.placesLibrary[dialogData.recentPlaceIdFromPresence].placeName}}</span> </div> </div>'},function(e,a){e.exports='<div ng-controller="userConversationInfoController"> <div class="border-bottom chat-friend-info" ng-class="{\'has-universe\': isGameAvailableInChat()}"> <div class="chat-friend-info-top dynamic-overflow-container"> <span class="small text-title text-overflow font-caption-header chat-friend-name dynamic-ellipsis-item" ng-class="{\'unread\': chatUser.hasUnreadMessages, \'read\': !chatUser.hasUnreadMessages}" ng-bind="chatUser.title  || chatUser.name "></span> <span class="text-overflow chat-alias-name dynamic-ellipsis-item" ng-class="{\'unread\': chatUser.hasUnreadMessages, \'read\': !chatUser.hasUnreadMessages}" alias="chatLibrary.friendsDict[chatUser.displayUserId].contact"></span> </div> <span class="xsmall text-info chat-brief-timestamp" ng-class="{\'font-bold secondary unread\': chatUser.hasUnreadMessages, \'read\': !chatUser.hasUnreadMessages}" ng-if="!isGameAvailableInChat()" ng-bind="chatUser.displayMessage.briefTimeStamp || chatUser.briefTimeStamp"></span> <span class="xsmall text-overflow text-info font-caption-body chat-friend-message" ng-class="{\'unread\': chatUser.hasUnreadMessages, \'read\': !chatUser.hasUnreadMessages}" display-message ng-if="chatUser.isConversation && chatUser.displayMessage"></span> <span class="xsmall text-overflow text-info font-caption-body chat-friend-message" ng-if="!chatUser.isConversation">{{userPresenceTypes[chatUser.presence.userPresenceType].title}}</span> </div> <div class="border-bottom chat-conversation-universe" ng-if="isGameAvailableInChat()" title="{{chatLibrary.placesLibrary[chatUser.placeForShown.rootPlaceId].placeName}}" ng-class="{\'album\': hasGameAlbum()}" ng-mouseover="openGameList()" popover-trigger=" \'none\' " popover-class="game-list-per-conversation game-list-{{chatUser.id}}" popover-placement="left-bottom" popover-append-to-body="true" popover-is-open="hoverPopoverParams.isOpen" hover-popover-params="hoverPopoverParams" hover-popover uib-popover-template="\'{{gamesListTemplateUrl}}\'"> <span chat-game-icon class-name="universe-image" layout-library="chatLibrary.layoutLibrary" ng-if="chatUser.placeForShown.universeId" universe-id="{{chatUser.placeForShown.universeId}}"></span> </div> </div>'}]);
//# sourceMappingURL=https://js.rbxcdn.com/911899d191b08621e483-chat.js.map

/* Bundle detector */
window.Roblox && window.Roblox.BundleDetector && window.Roblox.BundleDetector.bundleDetected("Chat");